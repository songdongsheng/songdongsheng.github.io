<!DOCTYPE html>
<html lang=zh>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="keywords" content="">
  
    <link rel="icon" href="">
  
    
  <title>Cross-build NetBSD Program in Linux | 上下未形，何由考之？冥昭瞢暗，誰能極之？馮翼惟象，何以識之？</title>
  <meta name="description" content="">
  
<link rel="stylesheet" href="/style.css">

  
<link rel="stylesheet" href="/lib/jquery.fancybox.min.css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>上下未形，何由考之？冥昭瞢暗，誰能極之？馮翼惟象，何以識之？</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
      <section class="content markdown-body">
        <h1>
          Cross-build NetBSD Program in Linux
        </h1>
        <div class='post-meta'>
          <i class="fa fa-calendar"
            aria-hidden="true"></i> <time>
            2021/09/12</time>
          
          | <i class="fa fa-folder-open-o"
            aria-hidden="true"></i>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/Operating-system/">Operating system</a>/ <a class="article-category-link" href="/categories/Operating-system/NetBSD/">NetBSD</a>
  </div>



          
          
          |
          
          <i class="fa fa-tags"
            aria-hidden="true"></i>
          
          
  <a href="/tags/#Operating%20system" class='tag'>Operating system</a>

  <a href="/tags/#NetBSD" class='tag'>NetBSD</a>


          
        </div>
        <h1 id="Rust-on-NetBSD"><a href="#Rust-on-NetBSD" class="headerlink" title="Rust on NetBSD"></a>Rust on NetBSD</h1><h2 id="The-First-Steps-on-NetBSD"><a href="#The-First-Steps-on-NetBSD" class="headerlink" title="The First Steps on NetBSD"></a>The First Steps on NetBSD</h2><h3 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ vi /etc/myname</span><br><span class="line">    netbsd-9</span><br></pre></td></tr></table></figure>

<h3 id="hvn0"><a href="#hvn0" class="headerlink" title="hvn0"></a>hvn0</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ dmesg | grep hvn</span><br><span class="line">[     1.299320] hvn0 at vmbus0: Hyper-V NetVSC</span><br><span class="line">[     1.299320] hvn0: NVS 5.0 NDIS 6.30</span><br><span class="line">[     1.299320] hvn0: Ethernet address 60:33:d9:6d:64:12</span><br><span class="line"></span><br><span class="line">root@netbsd-9:~ vi /etc/ifconfig.hvn0</span><br><span class="line">up</span><br><span class="line">media manual</span><br></pre></td></tr></table></figure>

<h3 id="disk"><a href="#disk" class="headerlink" title="disk"></a>disk</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ <span class="built_in">df</span> -h</span><br><span class="line">Filesystem         Size       Used      Avail %Cap Mounted on</span><br><span class="line">/dev/dk1            60G       2.2G        55G   3% /</span><br><span class="line">tmpfs              512M       244K       511M   0% /tmp</span><br><span class="line">kernfs             1.0K       1.0K         0B 100% /kern</span><br><span class="line">ptyfs              1.0K       1.0K         0B 100% /dev/pts</span><br><span class="line">procfs             4.0K       4.0K         0B 100% /proc</span><br><span class="line">tmpfs              512M       4.0K       512M   0% /var/shm</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ <span class="built_in">cat</span> /proc/mounts</span><br><span class="line">/dev/dk1 / ffs rw 0 0</span><br><span class="line">tmpfs /tmp tmpfs rw 0 0</span><br><span class="line">kernfs /kern kernfs rw 0 0</span><br><span class="line">ptyfs /dev/pts ptyfs rw 0 0</span><br><span class="line">procfs /proc proc rw 0 0</span><br><span class="line">tmpfs /var/shm tmpfs rw 0 0</span><br></pre></td></tr></table></figure>

<h3 id="rc-conf"><a href="#rc-conf" class="headerlink" title="rc.conf"></a>rc.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:/etc vi /etc/rc.conf</span><br><span class="line"><span class="comment"># Add local overrides below.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">dhcpcd=YES</span><br><span class="line">dhcpcd_flags=<span class="string">&quot;-qM hvn0&quot;</span></span><br><span class="line">sshd=YES</span><br><span class="line">ntpd=YES</span><br><span class="line">ntpdate=YES</span><br><span class="line">mdnsd=YES</span><br><span class="line">wscons=YES</span><br></pre></td></tr></table></figure>

<h3 id="sshd"><a href="#sshd" class="headerlink" title="sshd"></a>sshd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ vi /etc/ssh/sshd_config</span><br><span class="line">    PermitRootLogin <span class="built_in">yes</span></span><br><span class="line">    PasswordAuthentication <span class="built_in">yes</span></span><br><span class="line">    UseDNS no</span><br><span class="line"></span><br><span class="line">root@netbsd-9:~ /etc/rc.d/sshd reload</span><br></pre></td></tr></table></figure>

<h3 id="repositories-conf"><a href="#repositories-conf" class="headerlink" title="repositories.conf"></a>repositories.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/pkg/etc/pkgin/repositories.conf</span></span><br><span class="line"><span class="string">https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.2/All/</span></span><br><span class="line"><span class="string">https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.1/All/</span></span><br><span class="line"><span class="string">https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.0/All/</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="pkg"><a href="#pkg" class="headerlink" title="pkg"></a>pkg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ vi ~/.profile</span><br><span class="line"><span class="comment"># export PS1=&quot;\u@\h:\w \\$ &quot;</span></span><br><span class="line"><span class="built_in">export</span> PS1=`<span class="built_in">whoami</span>`@`hostname -s`:<span class="variable">$&#123;PWD&#125;</span><span class="string">&quot; $ &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PKG_PATH=https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.2/All</span><br><span class="line"><span class="built_in">export</span> PKG_PATH=<span class="string">&quot;<span class="variable">$&#123;PKG_PATH&#125;</span>;https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.2/All&quot;</span></span><br><span class="line"><span class="built_in">export</span> PKG_PATH=<span class="string">&quot;<span class="variable">$&#123;PKG_PATH&#125;</span>;https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.1/All&quot;</span></span><br><span class="line"><span class="built_in">export</span> PKG_PATH=<span class="string">&quot;<span class="variable">$&#123;PKG_PATH&#125;</span>;https://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/x86_64/9.0/All&quot;</span></span><br><span class="line"></span><br><span class="line">. <span class="string">&quot;<span class="variable">$HOME</span>/.cargo/env&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pkg_admin fetch-pkg-vulnerabilities</span><br><span class="line">pkg_add -uv tmux pkgin curl ca-certificates</span><br><span class="line"></span><br><span class="line">pkg_info tmux</span><br><span class="line"></span><br><span class="line">pkg_delete -r jpeg</span><br><span class="line"></span><br><span class="line">pkgin update</span><br></pre></td></tr></table></figure>

<h3 id="cc"><a href="#cc" class="headerlink" title="cc"></a>cc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9# <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF | cc -std=c11 -march=haswell -O2 -s -o hello -x c -</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">int main()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    printf(&quot;Hello, World!\n&quot;);</span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">root@netbsd-9# <span class="built_in">du</span> -ks hello</span><br><span class="line">6       hello</span><br><span class="line"></span><br><span class="line">root@netbsd-9# file hello</span><br><span class="line">hello: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /usr/libexec/ld.elf_so, <span class="keyword">for</span> NetBSD 9.2, stripped</span><br><span class="line"></span><br><span class="line">root@netbsd-9# readelf -hld hello | grep -E <span class="string">&quot;NEEDED|interpreter&quot;</span></span><br><span class="line">      [Requesting program interpreter: /usr/libexec/ld.elf_so]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so.12]</span><br><span class="line"></span><br><span class="line">root@netbsd-9# ldd hello</span><br><span class="line">hello:</span><br><span class="line">        -lc.12 =&gt; /usr/lib/libc.so.12</span><br></pre></td></tr></table></figure>

<h3 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9# <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF | c++ -std=c++17 -march=haswell -O2 -s -o hello.c++ -x c++ -</span></span><br><span class="line"><span class="string">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="string">int main()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    std::cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">root@netbsd-9# <span class="built_in">du</span> -ks hello.c++</span><br><span class="line">8       hello.c++</span><br><span class="line"></span><br><span class="line">root@netbsd-9# file hello.c++</span><br><span class="line">hello.c++: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /usr/libexec/ld.elf_so, <span class="keyword">for</span> NetBSD 9.2, stripped</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@netbsd-9# readelf -hld hello.c++  | grep -E <span class="string">&quot;NEEDED|interpreter&quot;</span></span><br><span class="line">      [Requesting program interpreter: /usr/libexec/ld.elf_so]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.9]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libm.so.0]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so.12]</span><br><span class="line"></span><br><span class="line">root@netbsd-9# ldd hello.c++</span><br><span class="line">hello.c++:</span><br><span class="line">        -lstdc++.9 =&gt; /usr/lib/libstdc++.so.9</span><br><span class="line">        -lm.0 =&gt; /usr/lib/libm.so.0</span><br><span class="line">        -lc.12 =&gt; /usr/lib/libc.so.12</span><br><span class="line">        -lgcc_s.1 =&gt; /usr/lib/libgcc_s.so.1</span><br></pre></td></tr></table></figure>

<h2 id="Copy-NetBSD-Library-Files-to-Linux"><a href="#Copy-NetBSD-Library-Files-to-Linux" class="headerlink" title="Copy NetBSD Library Files to Linux"></a>Copy NetBSD Library Files to Linux</h2><p>We can copy all files under <strong>&#x2F;lib</strong> and <strong>&#x2F;usr&#x2F;lib</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:/ <span class="built_in">du</span> -ms /lib /usr/lib /usr/include</span><br><span class="line">10      /lib</span><br><span class="line">287     /usr/lib</span><br><span class="line">25      /usr/include</span><br></pre></td></tr></table></figure>

<p>or a few of them:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@linux:/opt <span class="built_in">du</span> -ms x86_64-unknown-netbsd</span><br><span class="line">35      x86_64-unknown-netbsd/</span><br><span class="line">3       x86_64-unknown-netbsd/lib</span><br><span class="line">5       x86_64-unknown-netbsd/usr/lib</span><br><span class="line">27      x86_64-unknown-netbsd/usr/include</span><br><span class="line"></span><br><span class="line">root@linux:/opt/x86_64-unknown-netbsd $ find . ! -<span class="built_in">type</span> d | xargs <span class="built_in">du</span> -ks</span><br><span class="line">0       ./lib/libc.so</span><br><span class="line">2032    ./lib/libc.so.12.213</span><br><span class="line">0       ./lib/libgcc_s.so</span><br><span class="line">96      ./lib/libgcc_s.so.1.0</span><br><span class="line">0       ./lib/libm.so</span><br><span class="line">204     ./lib/libm.so.0.12</span><br><span class="line">0       ./lib/libpthread.so</span><br><span class="line">92      ./lib/libpthread.so.1.4</span><br><span class="line">0       ./lib/libutil.so</span><br><span class="line">124     ./lib/libutil.so.7.24</span><br><span class="line">27380   ./usr/include</span><br><span class="line">4       ./usr/lib/crt0.o</span><br><span class="line">4       ./usr/lib/crtbegin.o</span><br><span class="line">4       ./usr/lib/crtbeginS.o</span><br><span class="line">0       ./usr/lib/crtbeginT.o</span><br><span class="line">4       ./usr/lib/crtend.o</span><br><span class="line">0       ./usr/lib/crtendS.o</span><br><span class="line">4       ./usr/lib/crti.o</span><br><span class="line">4       ./usr/lib/crtn.o</span><br><span class="line">8       ./usr/lib/gcrt0.o</span><br><span class="line">4648    ./usr/lib/libc.a</span><br><span class="line">96      ./usr/lib/libpthread.a</span><br><span class="line">32      ./usr/lib/librt.a</span><br><span class="line">0       ./usr/lib/librt.so</span><br><span class="line">16      ./usr/lib/librt.so.1.1</span><br><span class="line">224     ./usr/lib/libutil.a</span><br></pre></td></tr></table></figure>

<h3 id="Archive-Library-Files-on-NetBSD"><a href="#Archive-Library-Files-on-NetBSD" class="headerlink" title="Archive Library Files on NetBSD"></a>Archive Library Files on NetBSD</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@netbsd-9:~ tar --no-acls --no-xattrs --no-fflags -cvzf x86_64-unknown-netbsd_9.2-STABLE-rust.tar.gz \</span><br><span class="line">    /lib/libc.so \</span><br><span class="line">    /lib/libc.so.12.213 \</span><br><span class="line">    /lib/libgcc_s.so \</span><br><span class="line">    /lib/libgcc_s.so.1.0 \</span><br><span class="line">    /lib/libm.so \</span><br><span class="line">    /lib/libm.so.0.12 \</span><br><span class="line">    /lib/libpthread.so \</span><br><span class="line">    /lib/libpthread.so.1.4 \</span><br><span class="line">    /lib/libutil.so \</span><br><span class="line">    /lib/libutil.so.7.24 \</span><br><span class="line">    /usr/include \</span><br><span class="line">    /usr/lib/crt0.o \</span><br><span class="line">    /usr/lib/crtbegin.o \</span><br><span class="line">    /usr/lib/crtbeginS.o \</span><br><span class="line">    /usr/lib/crtbeginT.o \</span><br><span class="line">    /usr/lib/crtend.o \</span><br><span class="line">    /usr/lib/crtendS.o \</span><br><span class="line">    /usr/lib/crti.o \</span><br><span class="line">    /usr/lib/crtn.o \</span><br><span class="line">    /usr/lib/gcrt0.o \</span><br><span class="line">    /usr/lib/libc.a \</span><br><span class="line">    /usr/lib/libpthread.a \</span><br><span class="line">    /usr/lib/librt.a \</span><br><span class="line">    /usr/lib/librt.so \</span><br><span class="line">    /usr/lib/librt.so.1.1 \</span><br><span class="line">    /usr/lib/libutil.a</span><br></pre></td></tr></table></figure>

<h3 id="Extract-NetBSD-Library-Files-on-Linux"><a href="#Extract-NetBSD-Library-Files-on-Linux" class="headerlink" title="Extract NetBSD Library Files on Linux"></a>Extract NetBSD Library Files on Linux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@linux:~ <span class="built_in">mkdir</span> -p /opt/x86_64-unknown-netbsd</span><br><span class="line">root@linux:~ ssh root@netbsd-9.local <span class="string">&#x27;cat x86_64-unknown-netbsd_9.2-STABLE-rust.tar.gz&#x27;</span> | tar -xvz -C /opt/x86_64-unknown-netbsd</span><br></pre></td></tr></table></figure>

<h2 id="Install-clang-and-lld-on-Linux"><a href="#Install-clang-and-lld-on-Linux" class="headerlink" title="Install clang and lld on Linux"></a>Install clang and lld on Linux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install -y clang lld</span><br></pre></td></tr></table></figure>

<h2 id="Install-Rust-on-Linux"><a href="#Install-Rust-on-Linux" class="headerlink" title="Install Rust on Linux"></a>Install Rust on Linux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@linux:~ curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"></span><br><span class="line">root@linux:~ . <span class="string">&quot;<span class="variable">$HOME</span>/.cargo/env&quot;</span></span><br><span class="line"></span><br><span class="line">root@linux:~ cargo --verbose --version</span><br><span class="line">cargo 1.55.0 (32da73ab1 2021-08-23)</span><br><span class="line">release: 1.55.0</span><br><span class="line">commit-hash: 32da73ab19417aa89686e1d85c1440b72fdf877d</span><br><span class="line">commit-date: 2021-08-23</span><br><span class="line"></span><br><span class="line">root@linux:~ rustc --version</span><br><span class="line">rustc 1.55.0 (c8dfcfe04 2021-09-06)</span><br></pre></td></tr></table></figure>

<h2 id="Cargo’s-Configuration-on-Linux"><a href="#Cargo’s-Configuration-on-Linux" class="headerlink" title="Cargo’s Configuration on Linux"></a>Cargo’s Configuration on Linux</h2><p>Cargo allows local configuration for a particular package as well as global configuration. It looks for configuration files in the <strong>current directory</strong> and <strong>all parent directories</strong>.</p>
<ul>
<li>.cargo&#x2F;config.toml</li>
<li>(<strong>all parent directories</strong>)&#x2F;.cargo&#x2F;config.toml</li>
<li>$CARGO_HOME&#x2F;config.toml which defaults to:<ul>
<li>Windows: %USERPROFILE%.cargo\config.toml</li>
<li>Unix: $HOME&#x2F;.cargo&#x2F;config.toml, ${CARGO_HOME:-${HOME}&#x2F;.cargo}&#x2F;config.toml</li>
</ul>
</li>
</ul>
<p>Now we can make rust target <strong>x86_64-unknown-netbsd</strong> use directory <strong>&#x2F;opt&#x2F;x86_64-unknown-netbsd</strong> as <strong>sysroot</strong>:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[http]</span></span><br><span class="line"><span class="attr">ssl-version</span> = <span class="string">&quot;tlsv1.3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">lto</span> = <span class="string">&quot;fat&quot;</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="string">&quot;s&quot;</span></span><br><span class="line"><span class="attr">codegen-units</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="section">[target.&#x27;cfg(target_arch = &quot;x86_64&quot;)&#x27;]</span></span><br><span class="line"><span class="attr">rustflags</span> = [<span class="string">&quot;-Ctarget-cpu=x86-64-v3&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[target.&#x27;cfg(any(target_family = &quot;windows&quot;, target_env = &quot;msvc&quot;, target_env = &quot;musl&quot;)&#x27;]</span></span><br><span class="line"><span class="attr">rustflags</span> = [<span class="string">&quot;-Ctarget-feature=+crt-static&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[target.x86_64-unknown-netbsd]</span></span><br><span class="line">    <span class="comment"># cargo build -v --release --target x86_64-unknown-netbsd</span></span><br><span class="line">    <span class="comment"># NetBSD 9.2_STABLE amd64, gcc 7.5.0</span></span><br><span class="line">    <span class="attr">linker</span>=<span class="string">&quot;clang&quot;</span></span><br><span class="line">    <span class="attr">rustflags</span> = [<span class="string">&quot;-Clink-arg=-s&quot;</span>, <span class="string">&quot;-Clink-arg=-v&quot;</span>, <span class="string">&quot;-Clink-arg=-fuse-ld=lld&quot;</span>, <span class="string">&quot;-Clink-arg=--target=x86_64-unknown-netbsd&quot;</span>,</span><br><span class="line"><span class="string">&quot;-Clink-arg=--sysroot=/opt/x86_64-unknown-netbsd&quot;</span>, <span class="string">&quot;-Clink-arg=-L/opt/x86_64-unknown-netbsd/lib&quot;</span>, <span class="string">&quot;-Clink-arg=-L/opt/x86_64-unknown-netbsd/usr/lib&quot;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="Cross-build-NetBSD-Program-in-Linux"><a href="#Cross-build-NetBSD-Program-in-Linux" class="headerlink" title="Cross-build NetBSD Program in Linux"></a>Cross-build NetBSD Program in Linux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@linux:~ <span class="built_in">uname</span> -msr</span><br><span class="line">Linux 5.10.0-8-amd64 x86_64</span><br><span class="line"></span><br><span class="line">root@linux:~ cargo build -v --release --target x86_64-unknown-netbsd</span><br><span class="line">...</span><br><span class="line">    Finished release [optimized] target(s) <span class="keyword">in</span> 11.59s</span><br><span class="line"></span><br><span class="line">root@linux:~ <span class="built_in">du</span> -ks target/x86_64-unknown-netbsd/release/hello</span><br><span class="line">240     target/x86_64-unknown-netbsd/release/hello</span><br><span class="line"></span><br><span class="line">root@linux:~ file target/x86_64-unknown-netbsd/release/hello</span><br><span class="line">target/x86_64-unknown-netbsd/release/hello: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /libexec/ld.elf_so, <span class="keyword">for</span> NetBSD 9.2, stripped</span><br><span class="line"></span><br><span class="line">root@linux:~ readelf -ld target/x86_64-unknown-netbsd/release/hello | grep -E <span class="string">&quot;interpreter:|NEEDED&quot;</span></span><br><span class="line">      [Requesting program interpreter: /libexec/ld.elf_so]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.1]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so.12]</span><br><span class="line"></span><br><span class="line">root@linux:~ scp target/x86_64-unknown-netbsd/release/hello root@netbsd-9.local:/tmp/</span><br><span class="line"></span><br><span class="line">root@linux:~ ssh root@netbsd-9.local /tmp/hello</span><br><span class="line">Hello, world!</span><br><span class="line"></span><br><span class="line">root@linux:~ ssh root@netbsd-9.local <span class="built_in">uname</span> -msr</span><br><span class="line">NetBSD 9.2_STABLE amd64</span><br></pre></td></tr></table></figure>

      </section>
    </article>
    
    
  </div>
  <aside>
    
    <div class="toc-container">
      <h1>
        catalog
      </h1>
      <div class="content">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Rust-on-NetBSD"><span class="toc-number">1.</span> <span class="toc-text">Rust on NetBSD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-First-Steps-on-NetBSD"><span class="toc-number">1.1.</span> <span class="toc-text">The First Steps on NetBSD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hostname"><span class="toc-number">1.1.1.</span> <span class="toc-text">hostname</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hvn0"><span class="toc-number">1.1.2.</span> <span class="toc-text">hvn0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#disk"><span class="toc-number">1.1.3.</span> <span class="toc-text">disk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rc-conf"><span class="toc-number">1.1.4.</span> <span class="toc-text">rc.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sshd"><span class="toc-number">1.1.5.</span> <span class="toc-text">sshd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#repositories-conf"><span class="toc-number">1.1.6.</span> <span class="toc-text">repositories.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pkg"><span class="toc-number">1.1.7.</span> <span class="toc-text">pkg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cc"><span class="toc-number">1.1.8.</span> <span class="toc-text">cc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c"><span class="toc-number">1.1.9.</span> <span class="toc-text">c++</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Copy-NetBSD-Library-Files-to-Linux"><span class="toc-number">1.2.</span> <span class="toc-text">Copy NetBSD Library Files to Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Archive-Library-Files-on-NetBSD"><span class="toc-number">1.2.1.</span> <span class="toc-text">Archive Library Files on NetBSD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extract-NetBSD-Library-Files-on-Linux"><span class="toc-number">1.2.2.</span> <span class="toc-text">Extract NetBSD Library Files on Linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-clang-and-lld-on-Linux"><span class="toc-number">1.3.</span> <span class="toc-text">Install clang and lld on Linux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-Rust-on-Linux"><span class="toc-number">1.4.</span> <span class="toc-text">Install Rust on Linux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cargo%E2%80%99s-Configuration-on-Linux"><span class="toc-number">1.5.</span> <span class="toc-text">Cargo’s Configuration on Linux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cross-build-NetBSD-Program-in-Linux"><span class="toc-number">1.6.</span> <span class="toc-text">Cross-build NetBSD Program in Linux</span></a></li></ol></li></ol>
      </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy;
      2024 | Powered by <a href="https://hexo.io"
        target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath"
        target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

<script src="/lib/ScrollMagic.min.js"></script>


<script src="/lib/lodash.min.js"></script>

<script>
  document.body.addEventListener('touchstart', function () { });

  // 文章图片预览
  $("article img").each(function () {
    var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
    $(this).wrapAll(strA);
  });

  // 目录联动
  let tocLinkList = $('.toc-link')

  let controller = new ScrollMagic.Controller({
    globalSceneOptions: {
      triggerHook: 0.01
    }
  })

  tocLinkList.each(function (index, elem) {
    let href = $(this).attr("href");
    let nextHref = tocLinkList.eq(index + 1).attr("href");
    let height = href && nextHref ? $(nextHref).offset().top - $(href).offset().top : 0

    new ScrollMagic.Scene({ triggerElement: href })
      .duration(height)
      .setClassToggle(".toc [href='" + href + "']", 'active')
      .addTo(controller)
  })

  window.addEventListener('load', function () {
    // 目录联动 图片加载完成后从新计算
    tocLinkList.each(function (index, elem) {
      let href = $(this).attr("href");
      let nextHref = tocLinkList.eq(index + 1).attr("href");
      let height = href && nextHref ? $(nextHref).offset().top - $(href).offset().top : 0

      new ScrollMagic.Scene({ triggerElement: href })
        .duration(height)
        .setClassToggle(".toc [href='" + href + "']", 'active')
        .addTo(controller)
    })
  })
</script>

<script src="/lib/jquery.fancybox.min.js"></script>



</body>
</html>
