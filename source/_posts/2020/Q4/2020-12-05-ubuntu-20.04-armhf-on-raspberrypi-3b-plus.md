---
title: Ubuntu 20.04 armhf on Raspberry Pi 3B+
description: Ubuntu 20.04 armhf on Raspberry Pi 3B+
date: 2020-12-06 21:40:18
tags:
    - Operating system
    - Linux
categories: [Operating system, Linux]
permalink: ubuntu-20.04-armhf-on-raspberrypi-3b-plus
---

# Ubuntu 20.04 armhf on Raspberry Pi 3B+

## Download Ubuntu image

### Reference

-   https://www.raspberrypi.org/documentation/configuration/uart.md
-   https://www.raspberrypi.org/documentation/usage/gpio/
-   https://www.debian.org/distrib/packages
-   http://manpages.ubuntu.com/manpages/focal/en/man5/netplan.5.html
-   http://manpages.ubuntu.com/manpages/focal/en/man8/netplan.8.html
-   https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz
-   https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz
-   https://cdimage.ubuntu.com/releases/20.10/release/ubuntu-20.10-preinstalled-server-arm64+raspi.img.xz
-   https://cdimage.ubuntu.com/releases/20.10/release/ubuntu-20.10-preinstalled-server-arm64+raspi.img.xz

### Download command

```shell
$ cat << EOF | aria2c -i -
https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz
https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz
EOF
```

### Integrity check

```shell
cat << EOF | sha256sum -c
aadc64a1d069c842e56a4289fe1a6b4b5a0af4efcf95bcce78eb2a80fe5270f4 ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz
bfd1eee56f7e346e1645666fc184af854c536b3ab4e1ce49d06c266f21b1ee46 ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz
EOF
```

## Write image to MicroSD card

### MicroSD card

```shell
$ dmesg -w
[    0.586996] mmc0: SDHCI controller on PCI [0000:03:00.0] using ADMA
[ 3985.428729] mmc0: new high speed SDXC card at address 5048
[ 3985.439979] mmcblk0: mmc0:5048 SD64G 58.2 GiB
```

### Write image

```shell
$ cat ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz \
        | xz -cd \
        | sudo /usr/bin/time -f "\nreal\t%es\nuser\t%Us\nsys\t%Ss\n" dd of=/dev/mmcblk0 bs=4M oflag=sync status=progress
0+45620 records in
0+45620 records out
2947279872 bytes (2.9 GB, 2.7 GiB) copied, 275.276 s, 10.7 MB/s

real	275.27s
user	0.16s
sys	11.29s
```

### parted

```shell
$ sudo partprobe /dev/mmcblk0

$ sudo partx -uv /dev/mmcblk0
partition: none, disk: /dev/mmcblk0, lower: 0, upper: 0
/dev/mmcblk0: partition table type 'dos' detected
/dev/mmcblk0: partition #1 added
/dev/mmcblk0: partition #2 added

$ sudo parted /dev/mmcblk0 print
Model: SD SD64G (sd/mmc)
Disk /dev/mmcblk0: 62.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  269MB   268MB   primary  fat32        boot, lba
 2      269MB   2947MB  2678MB  primary  ext4
```

### gdisk

```shell
$ sudo gdisk -l /dev/mmcblk0
GPT fdisk (gdisk) version 1.0.5

Partition table scan:
  MBR: MBR only
  BSD: not present
  APM: not present
  GPT: not present


***************************************************************
Found invalid GPT and valid MBR; converting MBR to GPT format
in memory.
***************************************************************

Disk /dev/mmcblk0: 122093568 sectors, 58.2 GiB
Sector size (logical/physical): 512/512 bytes
Disk identifier (GUID): 6CA65902-4EA6-4CFC-9FCD-4009C672069D
Partition table holds up to 128 entries
Main partition table begins at sector 2 and ends at sector 33
First usable sector is 34, last usable sector is 122093534
Partitions will be aligned on 2048-sector boundaries
Total free space is 116339177 sectors (55.5 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          526335   256.0 MiB   0700  Microsoft basic data
   2          526336         5756371   2.5 GiB     8300  Linux filesystem
```

### fdisk

```shell
$ sudo fdisk -l /dev/mmcblk0
Disk /dev/mmcblk0: 58.22 GiB, 62511906816 bytes, 122093568 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xcca9935b

Device         Boot  Start     End Sectors  Size Id Type
/dev/mmcblk0p1 *      2048  526335  524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2      526336 5756371 5230036  2.5G 83 Linux
```

### filesystem label

```shell
$ sudo fsck.vfat -a /dev/mmcblk0p1
fsck.fat 4.1 (2017-01-24)
/dev/mmcblk0p1: 254 files, 114833/516190 clusters

$ sudo dosfslabel /dev/mmcblk0p1
system-boot

$ sudo e2fsck -p /dev/mmcblk0p2
writable: clean, 74619/163520 files, 440102/653754 blocks

$ sudo e2label /dev/mmcblk0p2
writable
```

### mmcblk

```shell
$ dmesg -w
[ 7620.298084] mmc0: new high speed SDXC card at address 5048
[ 7620.298269] mmcblk0: mmc0:5048 SD64G 58.2 GiB
[ 7620.323051]  mmcblk0: p1 p2
[ 7620.635590] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)
```

### blkid

```shell
$ sudo blkid --info /dev/mmcblk0*
/dev/mmcblk0: MINIMUM_IO_SIZE="512" PHYSICAL_SECTOR_SIZE="512" LOGICAL_SECTOR_SIZE="512"
/dev/mmcblk0p1: MINIMUM_IO_SIZE="512" PHYSICAL_SECTOR_SIZE="512" LOGICAL_SECTOR_SIZE="512"
/dev/mmcblk0p2: MINIMUM_IO_SIZE="512" PHYSICAL_SECTOR_SIZE="512" LOGICAL_SECTOR_SIZE="512"
```

### df

```shell
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/mmcblk0p2  2.4G  1.6G  691M  71% /media/dongsheng/writable
/dev/mmcblk0p1  253M   57M  196M  23% /media/dongsheng/system-boot
```

### Boot configuration

```shell
$ cat /boot/firmware/cmdline.txt
net.ifnames=0 dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=LABEL=writable rootfstype=ext4 rootwait fixrtc earlycon=pl011,mmio32,0x3f201000

$ cat /boot/firmware/config.txt
[all]
arm_64bit=1
kernel=vmlinuz
cmdline=cmdline.txt
initramfs initrd.img followkernel

# Enable the audio output, I2C and SPI interfaces on the GPIO header
dtparam=audio=on
dtparam=i2c_arm=on
dtparam=spi=on

# Enable the serial pins
enable_uart=1
#dtoverlay=disable-bt
dtoverlay=miniuart-bt
core_freq=400
```

## UART with USB-TTL

### Pin Connectors

![Raspberry Pi 3 B+ Pins](raspberry_pi_pins.png)

### dmesg

```shell
$ dmesg -w
[ 7483.528344] usb 2-2: new full-speed USB device number 4 using xhci_hcd
[ 7483.685373] usb 2-2: New USB device found, idVendor=1a86, idProduct=7523, bcdDevice= 2.64
[ 7483.685378] usb 2-2: New USB device strings: Mfr=0, Product=2, SerialNumber=0
[ 7483.685380] usb 2-2: Product: USB Serial
[ 7483.713970] usbcore: registered new interface driver usbserial_generic
[ 7483.713978] usbserial: USB Serial support registered for generic
[ 7483.716746] usbcore: registered new interface driver ch341
[ 7483.716759] usbserial: USB Serial support registered for ch341-uart
[ 7483.716776] ch341 2-2:1.0: ch341-uart converter detected
[ 7483.718195] usb 2-2: ch341-uart converter now attached to ttyUSB0
```

### udev

```shell
$ cat /lib/udev/rules.d/60-serial.rules
    # /dev/serial/by-path/, /dev/serial/by-id/ for USB devices
    KERNEL!="ttyUSB[0-9]*|ttyACM[0-9]*", GOTO="serial_end"

$ /bin/udevadm info /dev/ttyUSB0
P: /devices/pci0000:00/0000:00:14.0/usb2/2-2/2-2:1.0/ttyUSB0/tty/ttyUSB0
N: ttyUSB0
L: 0
S: serial/by-id/usb-1a86_USB_Serial-if00-port0
S: serial/by-path/pci-0000:00:14.0-usb-0:2:1.0-port0
E: DEVPATH=/devices/pci0000:00/0000:00:14.0/usb2/2-2/2-2:1.0/ttyUSB0/tty/ttyUSB0
E: DEVNAME=/dev/ttyUSB0
E: MAJOR=188
E: MINOR=0
E: SUBSYSTEM=tty
E: USEC_INITIALIZED=2833769
E: ID_BUS=usb
E: ID_VENDOR_ID=1a86
E: ID_MODEL_ID=7523
E: ID_PCI_CLASS_FROM_DATABASE=Serial bus controller
E: ID_PCI_SUBCLASS_FROM_DATABASE=USB controller
E: ID_PCI_INTERFACE_FROM_DATABASE=XHCI
E: ID_VENDOR_FROM_DATABASE=QinHeng Electronics
E: ID_MODEL_FROM_DATABASE=HL-340 USB-Serial adapter
E: ID_VENDOR=1a86
E: ID_VENDOR_ENC=1a86
E: ID_MODEL=USB_Serial
E: ID_MODEL_ENC=USB\x20Serial
E: ID_REVISION=0264
E: ID_SERIAL=1a86_USB_Serial
E: ID_TYPE=generic
E: ID_USB_INTERFACES=:ff0102:
E: ID_USB_INTERFACE_NUM=00
E: ID_USB_DRIVER=ch341
E: ID_USB_CLASS_FROM_DATABASE=Vendor Specific Class
E: ID_PATH=pci-0000:00:14.0-usb-0:2:1.0
E: ID_PATH_TAG=pci-0000_00_14_0-usb-0_2_1_0
E: ID_MM_CANDIDATE=1
E: DEVLINKS=/dev/serial/by-id/usb-1a86_USB_Serial-if00-port0 /dev/serial/by-path/pci-0000:00:14.0-usb-0:2:1.0-port0
E: TAGS=:systemd:
```

### minicom

```shell
$ sudo minicom -b 115200 -8 -D /dev/ttyUSB0 -t xterm
```

## Booting Raspberry Pi

### dmesg

```shell
$ dmesg
MMC:   mmc@7e202000: 0, mmcnr@7e300000: 1
Loading Environment from FAT... *** Warning - bad CRC, using default environment

In:    serial
Out:   vidconsole
Err:   vidconsole
Net:   No ethernet found.
starting USB...
Bus usb@7e980000: scanning bus usb@7e980000 for devices... 6 USB Device(s) found
       scanning usb for storage devices... 0 Storage Device(s) found
## Info: input data size = 6 = 0x6
Hit any key to stop autoboot:  0
switch to partitions #0, OK
mmc0 is current device
Scanning mmc 0:1...
Found U-Boot script /boot.scr
2569 bytes read in 4 ms (627 KiB/s)
## Executing script at 02400000
7533056 bytes read in 516 ms (13.9 MiB/s)
halfword at 0x00080000 (0x8b1f) != halfword at 0x02700000 (0x5a4d)
Total of 0 halfword(s) were the same
Copying kernel...
26433266 bytes read in 1805 ms (14 MiB/s)
Booting Ubuntu (with bootz) from mmc 0:...
Kernel image @ 0x080000 [ 0x000000 - 0x72f200 ]
## Flattened Device Tree blob at 02600000
   Booting using the fdt blob at 0x2600000
   Using Device Tree in place at 02600000, end 0260a2a7

Starting kernel ...


[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 5.4.0-1015-raspi (buildd@bos02-arm64-044) (gcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2)) #15-Ubuntu SMP Fri Jul 10 05:37:25 UTC 2020 (Ubuntu 5.4.0-1015.15-raspi 5.4.44)
[    0.000000] CPU: ARMv7 Processor [410fd034] revision 4 (ARMv7), cr=30c5383d
[    0.000000] CPU: div instructions available: patching division code
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
[    0.000000] OF: fdt: Machine model: Raspberry Pi 3 Model B Plus Rev 1.3
[    0.000000] earlycon: pl11 at MMIO32 0x000000003f201000 (options '')
[    0.000000] printk: bootconsole [pl11] enabled
[    0.000000] Memory policy: Data cache writealloc
[    0.000000] efi: Getting EFI parameters from FDT:
[    0.000000] efi: UEFI not found.
[    0.000000] Reserved memory: created CMA memory pool at 0x0000000037400000, size 64 MiB
[    0.000000] OF: reserved mem: initialized node linux,cma, compatible id shared-dma-pool
[    0.000000] On node 0 totalpages: 242688
[    0.000000]   DMA zone: 2304 pages used for memmap
[    0.000000]   DMA zone: 0 pages reserved
[    0.000000]   DMA zone: 196608 pages, LIFO batch:63
[    0.000000]   HighMem zone: 46080 pages, LIFO batch:15
[    0.000000] percpu: Embedded 21 pages/cpu s54284 r8192 d23540 u86016
[    0.000000] pcpu-alloc: s54284 r8192 d23540 u86016 alloc=21*4096
[    0.000000] pcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3
[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 240384
[    0.000000] Kernel command line:  coherent_pool=1M 8250.nr_uarts=1 snd_bcm2835.enable_compat_alsa=0 snd_bcm2835.enable_hdmi=1 snd_bcm2835.enable_headphones=1 bcm2708_fb.fbwidth=656 bcm2708_fb.fbheight=416 bcm2708_fb.fbswap=1 vc_mem.mem_base=0x3ec00000 vc_mem.mem_size=0x40000000  net.ifnames=0 dwc_otg.lpm_enable=0 console=ttyAMA0,115200 console=tty1 root=LABEL=writable rootfstype=ext4 rootwait fixrtc earlycon=pl011,mmio32,0x3f201000 quiet splash
[    0.000000] Dentry cache hash table entries: 131072 (order: 7, 524288 bytes, linear)
[    0.000000] Inode-cache hash table entries: 65536 (order: 6, 262144 bytes, linear)
[    0.000000] allocated 970752 bytes of page_ext
[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.000000] software IO TLB: mapped [mem 0x2b2c7000-0x2f2c7000] (64MB)
[    0.000000] Memory: 779940K/970752K available (12288K kernel code, 739K rwdata, 3788K rodata, 2048K init, 775K bss, 125276K reserved, 65536K cma-reserved, 118784K highmem)
[    0.000000] random: get_random_u32 called from kmem_cache_open+0x30/0x3a0 with crng_init=0
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[    0.000000] ftrace: allocating 38313 entries in 75 pages
[    0.000000] rcu: Hierarchical RCU implementation.
[    0.000000] 	Tasks RCU enabled.
[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
[    0.000000] NR_IRQS: 16, nr_irqs: 16, preallocated irqs: 16
[    0.000000] arch_timer: cp15 timer(s) running at 19.20MHz (phys).
[    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x46d987e47, max_idle_ns: 440795202767 ns
[    0.000007] sched_clock: 56 bits at 19MHz, resolution 52ns, wraps every 4398046511078ns
[    0.000018] Switching to timer-based delay loop, resolution 52ns
[    0.000293] Console: colour dummy device 80x30
[    0.000315] printk: console [tty1] enabled
[    0.000326] printk: bootconsole [pl11] disabled
[    0.000399] Calibrating delay loop (skipped), value calculated using timer frequency.. 38.40 BogoMIPS (lpj=76800)
[    0.000419] pid_max: default: 32768 minimum: 301
[    0.000739] LSM: Security Framework initializing
[    0.000818] Yama: becoming mindful.
[    0.000989] AppArmor: AppArmor initialized
[    0.001238] Mount-cache hash table entries: 2048 (order: 1, 8192 bytes, linear)
[    0.001259] Mountpoint-cache hash table entries: 2048 (order: 1, 8192 bytes, linear)
[    0.001371] *** VALIDATE tmpfs ***
[    0.002302] *** VALIDATE proc ***
[    0.002881] Disabling memory control group subsystem
[    0.002970] *** VALIDATE cgroup1 ***
[    0.002984] *** VALIDATE cgroup2 ***
[    0.003070] CPU: Testing write buffer coherency: ok
[    0.003684] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
[    0.004784] Setting up static identity map for 0x200000 - 0x200060
[    0.005011] rcu: Hierarchical SRCU implementation.
[    0.008666] EFI services will not be available.
[    0.009556] smp: Bringing up secondary CPUs ...
[    0.011003] CPU1: thread -1, cpu 1, socket 0, mpidr 80000001
[    0.013087] CPU2: thread -1, cpu 2, socket 0, mpidr 80000002
[    0.014977] CPU3: thread -1, cpu 3, socket 0, mpidr 80000003
[    0.015507] smp: Brought up 1 node, 4 CPUs
[    0.015524] SMP: Total of 4 processors activated (153.60 BogoMIPS).
[    0.015535] CPU: All CPU(s) started in HYP mode.
[    0.015543] CPU: Virtualization extensions available.
[    0.016871] devtmpfs: initialized
[    0.034574] VFP support v0.3: implementor 41 architecture 3 part 40 variant 3 rev 4
[    0.035209] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.035237] futex hash table entries: 1024 (order: 4, 65536 bytes, linear)
[    0.038953] pinctrl core: initialized pinctrl subsystem
[    0.039789] DMI not present or invalid.
[    0.040696] NET: Registered protocol family 16
[    0.045524] DMA: preallocated 1024 KiB pool for atomic coherent allocations
[    0.050547] audit: initializing netlink subsys (disabled)
[    0.050898] audit: type=2000 audit(0.048:1): state=initialized audit_enabled=0 res=1
[    0.051749] cpuidle: using governor ladder
[    0.051800] cpuidle: using governor menu
[    0.052877] No ATAGs?
[    0.053088] hw-breakpoint: found 5 (+1 reserved) breakpoint and 4 watchpoint registers.
[    0.053100] hw-breakpoint: maximum watchpoint size is 8 bytes.
[    0.053556] Serial: AMBA PL011 UART driver
[    0.056384] bcm2835-mbox 3f00b880.mailbox: mailbox enabled
[    0.072327] raspberrypi-firmware soc:firmware: Attached to firmware from 2020-06-01 13:25, variant start
[    0.076340] raspberrypi-firmware soc:firmware: Firmware hash is 6379679d1ec6a8c746d7e77e015f5b56b939976f
[    0.145767] bcm2835-dma 3f007000.dma: DMA legacy API manager, dmachans=0x1
[    0.151406] SCSI subsystem initialized
[    0.151730] libata version 3.00 loaded.
[    0.151987] usbcore: registered new interface driver usbfs
[    0.152051] usbcore: registered new interface driver hub
[    0.152209] usbcore: registered new device driver usb
[    0.152616] pps_core: LinuxPPS API ver. 1 registered
[    0.152627] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti <giometti@linux.it>
[    0.152654] PTP clock support registered
[    0.153079] EDAC MC: Ver: 3.0.0
[    0.155194] NetLabel: Initializing
[    0.155206] NetLabel:  domain hash size = 128
[    0.155215] NetLabel:  protocols = UNLABELED CIPSOv4 CALIPSO
[    0.155316] NetLabel:  unlabeled traffic allowed by default
[    0.156928] clocksource: Switched to clocksource arch_sys_counter
[    0.280208] *** VALIDATE bpf ***
[    0.280609] VFS: Disk quotas dquot_6.6.0
[    0.280730] VFS: Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
[    0.280876] *** VALIDATE ramfs ***
[    0.281706] AppArmor: AppArmor Filesystem Enabled
[    0.281967] simple-framebuffer 3eaf0000.framebuffer: framebuffer at 0x3eaf0000, 0x10a800 bytes, mapped to 0x(ptrval)
[    0.281985] simple-framebuffer 3eaf0000.framebuffer: format=a8r8g8b8, mode=656x416x32, linelength=2624
[    0.282663] Console: switching to colour frame buffer device 82x26
[    0.287218] simple-framebuffer 3eaf0000.framebuffer: fb0: simplefb registered!
[    0.301032] thermal_sys: Registered thermal governor 'fair_share'
[    0.301040] thermal_sys: Registered thermal governor 'bang_bang'
[    0.301054] thermal_sys: Registered thermal governor 'step_wise'
[    0.301064] thermal_sys: Registered thermal governor 'user_space'
[    0.301075] thermal_sys: Registered thermal governor 'power_allocator'
[    0.301835] NET: Registered protocol family 2
[    0.302808] tcp_listen_portaddr_hash hash table entries: 512 (order: 0, 6144 bytes, linear)
[    0.302856] TCP established hash table entries: 8192 (order: 3, 32768 bytes, linear)
[    0.302972] TCP bind hash table entries: 8192 (order: 4, 65536 bytes, linear)
[    0.303162] TCP: Hash tables configured (established 8192 bind 8192)
[    0.303344] UDP hash table entries: 512 (order: 2, 16384 bytes, linear)
[    0.303398] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes, linear)
[    0.303850] NET: Registered protocol family 1
[    0.303887] NET: Registered protocol family 44
[    0.303908] PCI: CLS 0 bytes, default 64
[    0.304205] Trying to unpack rootfs image as initramfs...
[    1.131743] Freeing initrd memory: 25816K
[    1.132706] kvm [1]: Error, CPU 0 not supported!
[    1.133864] hw perfevents: enabled with armv7_cortex_a7 PMU driver, 7 counters available
[    1.138321] Initialise system trusted keyrings
[    1.138409] Key type blacklist registered
[    1.138712] workingset: timestamp_bits=14 max_order=18 bucket_order=4
[    1.150449] zbud: loaded
[    1.152962] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.154567] fuse: init (API version 7.31)
[    1.154729] *** VALIDATE fuse ***
[    1.154746] *** VALIDATE fuse ***
[    1.220841] Key type asymmetric registered
[    1.220859] Asymmetric key parser 'x509' registered
[    1.221100] bounce: pool size: 64 pages
[    1.221176] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 242)
[    1.221506] io scheduler mq-deadline registered
[    1.227352] bcm2708_fb soc:fb: FB found 1 display(s)
[    1.232330] bcm2708_fb soc:fb: Registered framebuffer for display 0, size 656x416
[    1.234494] raspberrypi-clk firmware-clocks: CPU frequency range: min 600000000, max 1400000000
[    1.321309] Serial: 8250/16550 driver, 1 ports, IRQ sharing enabled
[    1.324178] bcm2835-rng 3f104000.rng: hwrng registered
[    1.324895] vc-mem: phys_addr:0x00000000 mem_base=0x3ec00000 mem_size:0x40000000(1024 MiB)
[    1.325749] vc-sm: Videocore shared memory driver
[    1.326291] gpiomem-bcm2835 3f200000.gpiomem: Initialised: Registers at 0x3f200000
[    1.807162] loop: module loaded
[    1.811092] spi-bcm2835 3f204000.spi: could not get clk: -517
[    1.813734] libphy: Fixed MDIO Bus: probed
[    1.813780] tun: Universal TUN/TAP device driver, 1.6
[    1.814305] PPP generic driver version 2.4.2
[    1.814622] usbcore: registered new interface driver lan78xx
[    1.814687] usbcore: registered new interface driver smsc95xx
[    1.814729] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[    1.814758] ehci-pci: EHCI PCI platform driver
[    1.814822] ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
[    1.814961] ohci-pci: OHCI PCI platform driver
[    1.815030] uhci_hcd: USB Universal Host Controller Interface driver
[    1.815189] dwc_otg: version 3.00a 10-AUG-2012 (platform bus)
[    2.015859] Core Release: 2.80a
[    2.015873] Setting default values for core params
[    2.015902] Finished setting default values for core params
[    2.216272] Using Buffer DMA mode
[    2.216283] Periodic Transfer Interrupt Enhancement - disabled
[    2.216292] Multiprocessor Interrupt Enhancement - disabled
[    2.216304] OTG VER PARAM: 0, OTG VER FLAG: 0
[    2.216323] Dedicated Tx FIFOs mode
[    2.216802] WARN::dwc_otg_hcd_init:1072: FIQ DMA bounce buffers: virt = f095c000 dma = 0x00000000f7514000 len=9024
[    2.216832] FIQ FSM acceleration enabled for :
               Non-periodic Split Transactions
               Periodic Split Transactions
               High-Speed Isochronous Endpoints
               Interrupt/Control Split Transaction hack enabled
[    2.216844] dwc_otg: Microframe scheduler enabled
[    2.216974] WARN::hcd_init_fiq:457: FIQ on core 1
[    2.216985] WARN::hcd_init_fiq:458: FIQ ASM at c09798a0 length 36
[    2.216996] WARN::hcd_init_fiq:496: MPHI regs_base at f0810000
[    2.217045] dwc_otg 3f980000.usb: DWC OTG Controller
[    2.217101] dwc_otg 3f980000.usb: new USB bus registered, assigned bus number 1
[    2.217151] dwc_otg 3f980000.usb: irq 56, io mem 0x00000000
[    2.217203] Init: Port Power? op_state=1
[    2.217212] Init: Power Port (0)
[    2.217594] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002, bcdDevice= 5.04
[    2.217610] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
[    2.217624] usb usb1: Product: DWC OTG Controller
[    2.217638] usb usb1: Manufacturer: Linux 5.4.0-1015-raspi dwc_otg_hcd
[    2.217651] usb usb1: SerialNumber: 3f980000.usb
[    2.218510] hub 1-0:1.0: USB hub found
[    2.218579] hub 1-0:1.0: 1 port detected
[    2.219476] dwc_otg: FIQ enabled
[    2.219486] dwc_otg: NAK holdoff enabled
[    2.219497] dwc_otg: FIQ split-transaction FSM enabled
[    2.219512] Module dwc_common_port init
[    2.220178] mousedev: PS/2 mouse device common for all mice
[    2.221023] i2c /dev entries driver
[    2.224747] bcm2835-wdt bcm2835-wdt: Broadcom BCM2835 watchdog timer
[    2.225079] device-mapper: uevent: version 1.0.3
[    2.225519] device-mapper: ioctl: 4.41.0-ioctl (2019-09-16) initialised: dm-devel@redhat.com
[    2.226972] cpufreq: cpufreq_online: CPU0: Running at unlisted freq: 600000 KHz
[    2.229503] cpufreq: cpufreq_online: CPU0: Unlisted initial frequency changed to: 700000 KHz
[    2.231927] sdhci: Secure Digital Host Controller Interface driver
[    2.231931] sdhci: Copyright(c) Pierre Ossman
[    2.232238] mmc-bcm2835 3f300000.mmcnr: could not get clk, deferring probe
[    2.232525] sdhost-bcm2835 3f202000.mmc: could not get clk, deferring probe
[    2.232623] sdhci-pltfm: SDHCI platform and OF driver helper
[    2.234444] ledtrig-cpu: registered to indicate activity on CPUs
[    2.234528] hidraw: raw HID events driver (C) Jiri Kosina
[    2.235106] vchiq: vchiq_init_state: slot_zero = (ptrval)
[    2.236227] [vc_sm_connected_init]: start
[    2.243196] [vc_sm_connected_init]: end - returning 0
[    2.244525] drop_monitor: Initializing network drop monitor service
[    2.245114] NET: Registered protocol family 10
[    2.278008] Segment Routing with IPv6
[    2.278094] NET: Registered protocol family 17
[    2.278271] Key type dns_resolver registered
[    2.278698] Registering SWP/SWPB emulation handler
[    2.278964] registered taskstats version 1
[    2.279027] Loading compiled-in X.509 certificates
[    2.297944] Loaded X.509 cert 'Build time autogenerated kernel key: 4dd5fe50b6cf317b0a0708a187be267691ab35d9'
[    2.298980] Key type ._fscrypt registered
[    2.298992] Key type .fscrypt registered
[    2.344834] cryptd: max_cpu_qlen set to 1000
[    2.425530] Indeed it is in host mode hprt0 = 00021501
[    2.511479] random: fast init done
[    2.525532] Key type big_key registered
[    2.596827] Key type encrypted registered
[    2.596859] AppArmor: AppArmor sha1 policy hashing enabled
[    2.596940] ima: No TPM chip found, activating TPM-bypass!
[    2.597001] ima: Allocated hash algorithm: sha1
[    2.597045] ima: No architecture policies found
[    2.597130] evm: Initialising EVM extended attributes:
[    2.597139] evm: security.selinux
[    2.597149] evm: security.SMACK64
[    2.597158] evm: security.SMACK64EXEC
[    2.597167] evm: security.SMACK64TRANSMUTE
[    2.597176] evm: security.SMACK64MMAP
[    2.597184] evm: security.apparmor
[    2.597193] evm: security.ima
[    2.597202] evm: security.capability
[    2.597212] evm: HMAC attrs: 0x1
[    2.610181] uart-pl011 3f201000.serial: cts_event_workaround enabled
[    2.610279] 3f201000.serial: ttyAMA0 at MMIO 0x3f201000 (irq = 81, base_baud = 0) is a PL011 rev2
[    2.616977] usb 1-1: new high-speed USB device number 2 using dwc_otg
[    2.620801] printk: console [ttyAMA0] enabled
[    2.620967] Indeed it is in host mode hprt0 = 00001101
[    2.625418] 3f215040.serial: ttyS0 at MMIO 0x0 (irq = 53, base_baud = 50000000) is a 16550
[    2.626362] bcm2835-power bcm2835-power: Broadcom BCM2835 power domains driver
[    2.632250] mmc-bcm2835 3f300000.mmcnr: mmc_debug:0 mmc_debug2:0
[    2.632267] mmc-bcm2835 3f300000.mmcnr: DMA channel allocated
[    2.674167] mmc1: queuing unknown CIS tuple 0x80 (2 bytes)
[    2.675803] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    2.677438] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    2.680389] mmc1: queuing unknown CIS tuple 0x80 (7 bytes)
[    2.681375] sdhost: log_buf @ (ptrval) (f7513000)
[    2.730319] mmc0: sdhost-bcm2835 loaded - DMA enabled (>1)
[    2.733495] hctosys: unable to open rtc device (rtc0)
[    2.734086] of_cfs_init
[    2.734238] of_cfs_init: OK
[    2.755038] Freeing unused kernel memory: 2048K
[    2.756470] Checked W+X mappings: passed, no W+X pages found
[    2.756484] Run /init as init process
[    2.789706] mmc0: host does not support reading read-only switch, assuming write-enable
[    2.792751] mmc0: new high speed SDXC card at address 5048
[    2.794113] mmcblk0: mmc0:5048 SD64G 58.2 GiB
[    2.797311] mmc1: new high speed SDIO card at address 0001
[    2.798079]  mmcblk0: p1 p2
[    2.829430] usb 1-1: New USB device found, idVendor=0424, idProduct=2514, bcdDevice= b.b3
[    2.829452] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[    2.830361] hub 1-1:1.0: USB hub found
[    2.830476] hub 1-1:1.0: 4 ports detected
[    2.888394] random: systemd-udevd: uninitialized urandom read (16 bytes read)
[    2.895121] random: systemd-udevd: uninitialized urandom read (16 bytes read)
[    2.895273] random: systemd-udevd: uninitialized urandom read (16 bytes read)
[    3.117020] usb 1-1.1: new high-speed USB device number 3 using dwc_otg
[    3.217441] usb 1-1.1: New USB device found, idVendor=0424, idProduct=2514, bcdDevice= b.b3
[    3.217462] usb 1-1.1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[    3.218478] hub 1-1.1:1.0: USB hub found
[    3.218601] hub 1-1.1:1.0: 3 ports detected
[    3.444994] usb 1-1.3: new high-speed USB device number 4 using dwc_otg
[    3.545503] usb 1-1.3: New USB device found, idVendor=214b, idProduct=7250, bcdDevice= 1.00
[    3.545524] usb 1-1.3: New USB device strings: Mfr=0, Product=1, SerialNumber=0
[    3.545538] usb 1-1.3: Product: USB2.0 HUB
[    3.546538] hub 1-1.3:1.0: USB hub found
[    3.546655] hub 1-1.3:1.0: 4 ports detected
[    3.837109] usb 1-1.3.1: new high-speed USB device number 5 using dwc_otg
[    3.942325] usb 1-1.3.1: New USB device found, idVendor=0bda, idProduct=8152, bcdDevice=20.00
[    3.942346] usb 1-1.3.1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[    3.942363] usb 1-1.3.1: Product: USB 10/100 LAN
[    3.942377] usb 1-1.3.1: Manufacturer: Realtek
[    3.942391] usb 1-1.3.1: SerialNumber: 00E04C3603B4
[    4.024998] usb 1-1.1.1: new high-speed USB device number 6 using dwc_otg
[    4.125626] usb 1-1.1.1: New USB device found, idVendor=0424, idProduct=7800, bcdDevice= 3.00
[    4.125647] usb 1-1.1.1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[    4.370378] usb_phy_generic phy: phy supply vcc not found, using dummy regulator
[    4.391205] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): No External EEPROM. Setting MAC Speed
[    4.392362] libphy: lan78xx-mdiobus: probed
[    4.420458] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): int urb period 64
[    8.044957] raid6: neonx8   gen()   615 MB/s
[    8.092964] raid6: neonx8   xor()   526 MB/s
[    8.140985] raid6: neonx4   gen()   617 MB/s
[    8.188959] raid6: neonx4   xor()   558 MB/s
[    8.237036] raid6: neonx2   gen()   509 MB/s
[    8.284925] raid6: neonx2   xor()   521 MB/s
[    8.332947] raid6: neonx1   gen()   322 MB/s
[    8.380954] raid6: neonx1   xor()   384 MB/s
[    8.429196] raid6: int32x8  gen()   172 MB/s
[    8.477018] raid6: int32x8  xor()   123 MB/s
[    8.525269] raid6: int32x4  gen()   166 MB/s
[    8.573115] raid6: int32x4  xor()   147 MB/s
[    8.621263] raid6: int32x2  gen()   139 MB/s
[    8.669066] raid6: int32x2  xor()   135 MB/s
[    8.717458] raid6: int32x1  gen()    94 MB/s
[    8.765053] raid6: int32x1  xor()   113 MB/s
[    8.765064] raid6: using algorithm neonx4 gen() 617 MB/s
[    8.765074] raid6: .... xor() 558 MB/s, rmw enabled
[    8.765084] raid6: using neon recovery algorithm
[    8.796888] xor: measuring software checksum speed
[    8.832932]    arm4regs  :   901.000 MB/sec
[    8.872929]    8regs     :   672.000 MB/sec
[    8.912925]    32regs    :   646.000 MB/sec
[    8.952927]    neon      :  1071.000 MB/sec
[    8.952938] xor: using function: neon (1071.000 MB/sec)
[    8.963906] async_tx: api initialized (async)
[    9.155335] uart-pl011 3f201000.serial: no DMA platform data
[    9.586364] Btrfs loaded, crc32c=crc32c-arm-ce
[   10.063046] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)
[   11.192055] systemd[1]: Inserted module 'autofs4'
[   11.283124] systemd[1]: systemd 245.4-4ubuntu3.2 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD +IDN2 -IDN +PCRE2 default-hierarchy=hybrid)
[   11.284193] systemd[1]: Detected architecture arm.
[   11.313059] systemd[1]: Set hostname to <ubuntu>.
[   12.639072] systemd[1]: /lib/systemd/system/dbus.socket:5: ListenStream= references a path below legacy directory /var/run/, updating /var/run/dbus/system_bus_socket → /run/dbus/system_bus_socket; please update the unit file accordingly.
[   13.235454] systemd[1]: Created slice system-modprobe.slice.
[   13.237368] systemd[1]: Created slice system-serial\x2dgetty.slice.
[   13.238965] systemd[1]: Created slice system-systemd\x2dfsck.slice.
[   13.240398] systemd[1]: Created slice User and Session Slice.
[   13.241061] systemd[1]: Started Forward Password Requests to Wall Directory Watch.
[   13.242688] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.
[   13.243562] systemd[1]: Reached target User and Group Name Lookups.
[   13.243802] systemd[1]: Reached target Slices.
[   13.243981] systemd[1]: Reached target Swap.
[   13.244724] systemd[1]: Listening on Device-mapper event daemon FIFOs.
[   13.245751] systemd[1]: Listening on LVM2 poll daemon socket.
[   13.246395] systemd[1]: Listening on multipathd control socket.
[   13.247248] systemd[1]: Listening on Syslog Socket.
[   13.248046] systemd[1]: Listening on fsck to fsckd communication Socket.
[   13.248573] systemd[1]: Listening on initctl Compatibility Named Pipe.
[   13.250173] systemd[1]: Listening on Journal Audit Socket.
[   13.251008] systemd[1]: Listening on Journal Socket (/dev/log).
[   13.251998] systemd[1]: Listening on Journal Socket.
[   13.253203] systemd[1]: Listening on Network Service Netlink Socket.
[   13.254109] systemd[1]: Listening on udev Control Socket.
[   13.254754] systemd[1]: Listening on udev Kernel Socket.
[   13.255751] systemd[1]: Condition check resulted in Huge Pages File System being skipped.
[   13.263359] systemd[1]: Mounting POSIX Message Queue File System...
[   13.273282] systemd[1]: Mounting Kernel Debug File System...
[   13.282984] systemd[1]: Mounting Kernel Trace File System...
[   13.299643] systemd[1]: Starting Journal Service...
[   13.310226] systemd[1]: Starting Set the console keyboard layout...
[   13.319821] systemd[1]: Starting Create list of static device nodes for the current kernel...
[   13.329178] systemd[1]: Starting Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling...
[   13.346165] systemd[1]: Starting Load Kernel Module drm...
[   13.352500] systemd[1]: Condition check resulted in Set Up Additional Binary Formats being skipped.
[   13.375192] systemd[1]: Starting Load Kernel Modules...
[   13.384679] systemd[1]: Starting Remount Root and Kernel File Systems...
[   13.394046] systemd[1]: Starting udev Coldplug all Devices...
[   13.403816] systemd[1]: Starting Uncomplicated firewall...
[   13.418342] systemd[1]: Mounted POSIX Message Queue File System.
[   13.420842] systemd[1]: Mounted Kernel Debug File System.
[   13.423531] systemd[1]: Mounted Kernel Trace File System.
[   13.431563] systemd[1]: Finished Create list of static device nodes for the current kernel.
[   13.484962] systemd[1]: Finished Load Kernel Modules.
[   13.512026] systemd[1]: Mounting FUSE Control File System...
[   13.536860] systemd[1]: Mounting Kernel Configuration File System...
[   13.579106] EXT4-fs (mmcblk0p2): re-mounted. Opts: (null)
[   13.591285] systemd[1]: Starting Apply Kernel Variables...
[   13.638933] systemd[1]: modprobe@drm.service: Succeeded.
[   13.641243] systemd[1]: Finished Load Kernel Module drm.
[   13.645516] systemd[1]: Finished Remount Root and Kernel File Systems.
[   13.662246] systemd[1]: Finished Uncomplicated firewall.
[   13.664186] systemd[1]: Mounted FUSE Control File System.
[   13.666012] systemd[1]: Mounted Kernel Configuration File System.
[   13.681202] systemd[1]: Condition check resulted in Rebuild Hardware Database being skipped.
[   13.681606] systemd[1]: Condition check resulted in Platform Persistent Storage Archival being skipped.
[   13.693209] systemd[1]: Starting Load/Save Random Seed...
[   13.711056] systemd[1]: Starting Create System Users...
[   13.769826] systemd[1]: Finished Apply Kernel Variables.
[   13.807169] systemd[1]: Finished Load/Save Random Seed.
[   13.819541] systemd[1]: Started Journal Service.
[   13.873788] systemd-journald[677]: Received client request to flush runtime journal.
[   13.894877] systemd-journald[677]: File /var/log/journal/a84f97a4ce7647ca8421d2a4eb7a3a66/system.journal corrupted or uncleanly shut down, renaming and replacing.
[   15.196761] vc_sm_cma: module is from the staging directory, the quality is unknown, you have been warned.
[   15.197143] vc_sm_cma: module verification failed: signature and/or required key missing - tainting kernel
[   15.198788] bcm2835_vc_sm_cma_probe: Videocore shared memory driver
[   15.198811] [vc_sm_connected_init]: start
[   15.211125] [vc_sm_connected_init]: installed successfully
[   15.310054] mc: Linux media interface: v0.10
[   15.420494] videodev: Linux video capture interface: v2.00
[   15.459447] snd_bcm2835: module is from the staging directory, the quality is unknown, you have been warned.
[   15.470398] bcm2835_audio bcm2835_audio: card created with 8 channels
[   15.635419] bcm2835_mmal_vchiq: module is from the staging directory, the quality is unknown, you have been warned.
[   15.637101] bcm2835_mmal_vchiq: module is from the staging directory, the quality is unknown, you have been warned.
[   15.766487] bcm2835_v4l2: module is from the staging directory, the quality is unknown, you have been warned.
[   15.781102] bcm2835_isp: module is from the staging directory, the quality is unknown, you have been warned.
[   15.783302] bcm2835_codec: module is from the staging directory, the quality is unknown, you have been warned.
[   15.808308] cfg80211: Loading compiled-in X.509 certificates for regulatory database
[   15.815612] bcm2835-isp bcm2835-isp: Device node output[0] registered as /dev/video13
[   15.816723] bcm2835-isp bcm2835-isp: Device node capture[0] registered as /dev/video14
[   15.816834] bcm2835-codec bcm2835-codec: Device registered as /dev/video10
[   15.818127] bcm2835-codec bcm2835-codec: Loaded V4L2 decode
[   15.819074] bcm2835-isp bcm2835-isp: Device node capture[1] registered as /dev/video15
[   15.819821] bcm2835-isp bcm2835-isp: Device node stats[2] registered as /dev/video16
[   15.819859] bcm2835-isp bcm2835-isp: Register output node 0 with media controller
[   15.819882] bcm2835-isp bcm2835-isp: Register capture node 1 with media controller
[   15.819921] bcm2835-isp bcm2835-isp: Register capture node 2 with media controller
[   15.819941] bcm2835-isp bcm2835-isp: Register capture node 3 with media controller
[   15.820218] bcm2835-isp bcm2835-isp: Loaded V4L2 bcm2835-isp
[   15.825684] bcm2835-codec bcm2835-codec: Device registered as /dev/video11
[   15.825841] bcm2835-codec bcm2835-codec: Loaded V4L2 encode
[   15.834062] cfg80211: Loaded X.509 cert 'sforshee: 00b28ddf47aef9cea7'
[   15.846858] bcm2835-codec bcm2835-codec: Device registered as /dev/video12
[   15.846910] bcm2835-codec bcm2835-codec: Loaded V4L2 isp
[   15.902197] usbcore: registered new interface driver r8152
[   15.981105] usb 1-1.3.1: reset high-speed USB device number 5 using dwc_otg
[   15.996524] brcmfmac: F1 signature read @0x18000000=0x15264345
[   16.014859] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   16.020671] usbcore: registered new interface driver cdc_ether
[   16.034064] usbcore: registered new interface driver brcmfmac
[   16.145261] r8152 1-1.3.1:1.0 eth1: v1.10.11
[   16.315613] Bluetooth: Core ver 2.22
[   16.315718] NET: Registered protocol family 31
[   16.315731] Bluetooth: HCI device and connection manager initialized
[   16.315761] Bluetooth: HCI socket layer initialized
[   16.315780] Bluetooth: L2CAP socket layer initialized
[   16.315830] Bluetooth: SCO socket layer initialized
[   16.331237] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   16.369245] brcmfmac: brcmf_c_preinit_dcmds: Firmware: BCM4345/6 wl0: Mar  2 2020 23:30:41 version 7.45.202 (r724630 CY) FWID 01-72f6ece2
[   17.501212] Under-voltage detected! (0x00050005)
[   17.731720] random: crng init done
[   17.731743] random: 7 urandom warning(s) missed due to ratelimiting
[   20.705137] alua: device handler registered
[   20.717937] emc: device handler registered
[   20.744120] rdac: device handler registered
[   20.986476] brcmfmac: brcmf_cfg80211_set_power_mgmt: power save enabled
[   27.215340] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[   30.415185] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready

[   39.451128] EXT4-fs (mmcblk0p2): resizing filesystem from 653754 to 15195899 blocks
[   40.117233] EXT4-fs (mmcblk0p2): resized filesystem to 15195899
```

### First login

The default passwords for the images are **ubuntu/ubuntu**.

```shell
Ubuntu 20.04.1 LTS ubuntu ttyAMA0

ubuntu login: ubuntu
Password:
You are required to change your password immediately (administrator enforced)
Changing password for ubuntu.
Current password:
New password:
Retype new password:
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-1015-raspi armv7l)

```

### UART

```shell
$ dmesg | grep -E "pl11|8250|uart|tty"
[    0.000000] earlycon: pl11 at MMIO32 0x000000003f201000 (options '')
[    0.000000] printk: bootconsole [pl11] enabled
[    0.000000] Kernel command line:  coherent_pool=1M 8250.nr_uarts=1 snd_bcm2835.enable_compat_alsa=0 snd_bcm2835.enable_hdmi=1 snd_bcm2835.enable_headphones=1 bcm2708_fb.fbwidth=656 bcm2708_fb.fbheight=416 bcm2708_fb.fbswap=1 vc_mem.mem_base=0x3ec00000 vc_mem.mem_size=0x40000000  net.ifnames=0 dwc_otg.lpm_enable=0 console=ttyAMA0,115200 console=tty1 root=LABEL=writable rootfstype=ext4 rootwait fixrtc earlycon=pl011,mmio32,0x3f201000 quiet splash
[    0.000315] printk: console [tty1] enabled
[    0.000326] printk: bootconsole [pl11] disabled
[    1.321309] Serial: 8250/16550 driver, 1 ports, IRQ sharing enabled
[    2.610181] uart-pl011 3f201000.serial: cts_event_workaround enabled
[    2.610279] 3f201000.serial: ttyAMA0 at MMIO 0x3f201000 (irq = 81, base_baud = 0) is a PL011 rev2
[    2.620801] printk: console [ttyAMA0] enabled
[    2.625418] 3f215040.serial: ttyS0 at MMIO 0x0 (irq = 53, base_baud = 50000000) is a 16550
[    9.155335] uart-pl011 3f201000.serial: no DMA platform data
[   13.237368] systemd[1]: Created slice system-serial\x2dgetty.slice.
```

### Setup ssh daemon

```shell
$ sudo vi /etc/ssh/sshd_config
    PermitRootLogin yes
    #PermitRootLogin prohibit-password

$ sudo /etc/init.d/ssh reload
Reloading ssh configuration (via systemctl): ssh.service.

$ sudo vi /etc/pam.d/sshd
   # session    optional   pam_motd.so motd=/run/motd.dynamic

$ sudo vi /etc/pam.d/login
   # session    optional     pam_motd.so  motd=/run/motd.dynamic
```

## System characteristics

### Dimension

![Raspberry Pi 3 B+ dimension](rpi_machine_3bplus.svg)

### uname

```shell
$ uname -snrmp
Linux ubuntu 5.4.0-1015-raspi armv7l armv7l

$ uname -a
Linux ubuntu 5.4.0-1015-raspi #15-Ubuntu SMP Fri Jul 10 05:37:25 UTC 2020 armv7l armv7l armv7l GNU/Linux
```

### /etc/os-release

```shell
$ ls -l /etc/os-release
lrwxrwxrwx 1 root root 21 Jul 15 08:59 /etc/os-release -> ../usr/lib/os-release

$ cat /usr/lib/os-release
NAME="Ubuntu"
VERSION="20.04.1 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.1 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal

$ file /bin/cat
/bin/cat: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-armhf.so.3, BuildID[sha1]=0c3fc79cd78926583bcc4a853829256f1bd826d8, for GNU/Linux 3.2.0, stripped

$ ldd /bin/cat
	linux-vdso.so.1 (0xbef51000)
	libc.so.6 => /lib/arm-linux-gnueabihf/libc.so.6 (0xb6ebd000)
	/lib/ld-linux-armhf.so.3 (0xb6fd2000)
```

### ps

```shell
$ ps axf
  PID TTY      STAT   TIME COMMAND
    2 ?        S      0:00 [kthreadd]
    3 ?        I<     0:00  \_ [rcu_gp]
    4 ?        I<     0:00  \_ [rcu_par_gp]
    7 ?        I      0:00  \_ [kworker/u8:0-events_unbound]
    8 ?        I<     0:00  \_ [mm_percpu_wq]
    9 ?        S      0:00  \_ [ksoftirqd/0]
   10 ?        I      0:01  \_ [rcu_sched]
   11 ?        S      0:00  \_ [migration/0]
   12 ?        S      0:00  \_ [idle_inject/0]
   13 ?        I      0:00  \_ [kworker/0:1-events]
   14 ?        S      0:00  \_ [cpuhp/0]
   15 ?        S      0:00  \_ [cpuhp/1]
   16 ?        S      0:00  \_ [idle_inject/1]
   17 ?        S      0:00  \_ [migration/1]
   18 ?        S      0:00  \_ [ksoftirqd/1]
   21 ?        S      0:00  \_ [cpuhp/2]
   22 ?        S      0:00  \_ [idle_inject/2]
   23 ?        S      0:00  \_ [migration/2]
   24 ?        S      0:00  \_ [ksoftirqd/2]
   26 ?        I<     0:00  \_ [kworker/2:0H-kblockd]
   27 ?        S      0:00  \_ [cpuhp/3]
   28 ?        S      0:00  \_ [idle_inject/3]
   29 ?        S      0:00  \_ [migration/3]
   30 ?        S      0:00  \_ [ksoftirqd/3]
   33 ?        S      0:00  \_ [kdevtmpfs]
   34 ?        I<     0:00  \_ [netns]
   35 ?        S      0:00  \_ [rcu_tasks_kthre]
   36 ?        S      0:00  \_ [kauditd]
   37 ?        S      0:00  \_ [khungtaskd]
   38 ?        S      0:00  \_ [oom_reaper]
   39 ?        I<     0:00  \_ [writeback]
   40 ?        S      0:00  \_ [kcompactd0]
   41 ?        SN     0:00  \_ [ksmd]
   78 ?        I      0:00  \_ [kworker/2:1-events]
  121 ?        I      0:00  \_ [kworker/1:1-events_freezable]
  137 ?        I<     0:00  \_ [kintegrityd]
  138 ?        I<     0:00  \_ [kblockd]
  139 ?        I<     0:00  \_ [blkcg_punt_bio]
  140 ?        I<     0:00  \_ [tpm_dev_wq]
  141 ?        I<     0:00  \_ [ata_sff]
  142 ?        I<     0:00  \_ [md]
  143 ?        I<     0:00  \_ [edac-poller]
  144 ?        I<     0:00  \_ [devfreq_wq]
  145 ?        S      0:00  \_ [watchdogd]
  147 ?        S      0:00  \_ [kswapd0]
  148 ?        S      0:00  \_ [ecryptfs-kthrea]
  151 ?        I<     0:00  \_ [kthrotld]
  152 ?        I<     0:00  \_ [dwc_otg]
  153 ?        I<     0:00  \_ [DWC Notificatio]
  155 ?        S<     0:00  \_ [vchiq-slot/0]
  156 ?        S<     0:00  \_ [vchiq-recy/0]
  157 ?        S<     0:00  \_ [vchiq-sync/0]
  158 ?        S      0:00  \_ [vchiq-keep/0]
  159 ?        S<     0:00  \_ [SMIO]
  160 ?        I<     0:00  \_ [ipv6_addrconf]
  171 ?        I<     0:00  \_ [kstrp]
  175 ?        I<     0:00  \_ [kworker/u9:0]
  178 ?        I      0:00  \_ [kworker/u8:2-events_power_efficient]
  179 ?        I      0:00  \_ [kworker/u8:3-events_power_efficient]
  182 ?        I<     0:00  \_ [cryptd]
  183 ?        I      0:00  \_ [kworker/1:2-events]
  202 ?        I      0:00  \_ [kworker/2:2-events]
  211 ?        I      0:00  \_ [kworker/1:3-events]
  212 ?        S      0:00  \_ [spi0]
  214 ?        I<     0:00  \_ [charger_manager]
  223 ?        I<     0:00  \_ [mmc_complete]
  224 ?        I<     0:00  \_ [kworker/1:1H-kblockd]
  226 ?        I<     0:00  \_ [kworker/0:1H-mmc_complete]
  252 ?        S      0:00  \_ [irq/166-usb-001]
  253 ?        I<     0:00  \_ [kworker/3:1H-kblockd]
  254 ?        I<     0:00  \_ [kworker/3:2H]
  261 ?        I<     0:00  \_ [kworker/2:2H-kblockd]
  262 ?        I<     0:00  \_ [kworker/1:2H]
  542 ?        I<     0:00  \_ [raid5wq]
  599 ?        S      0:00  \_ [jbd2/mmcblk0p2-]
  600 ?        I<     0:00  \_ [ext4-rsv-conver]
  632 ?        I      0:00  \_ [kworker/3:2-events]
  642 ?        I<     0:00  \_ [kworker/0:2H]
  690 ?        I      0:00  \_ [kworker/3:3-events]
  716 ?        S<     0:00  \_ [SMIO]
  720 ?        I<     0:00  \_ [mmal-vchiq]
  722 ?        I<     0:00  \_ [mmal-vchiq]
  723 ?        I<     0:00  \_ [mmal-vchiq]
  724 ?        I<     0:00  \_ [mmal-vchiq]
  734 ?        I<     0:00  \_ [cfg80211]
  735 ?        I<     0:00  \_ [brcmf_wq/mmc1:0]
  736 ?        S      0:00  \_ [brcmf_wdog/mmc1]
 1040 ?        I<     0:00  \_ [kaluad]
 1041 ?        I<     0:00  \_ [kmpath_rdacd]
 1042 ?        I<     0:00  \_ [kmpathd]
 1043 ?        I<     0:00  \_ [kmpath_handlerd]
 1173 ?        S      0:00  \_ [ext4lazyinit]
 1345 ?        I      0:00  \_ [kworker/0:3-events]
 1524 ?        S<     0:00  \_ [loop0]
 1942 ?        S<     0:00  \_ [loop1]
 2024 ?        S<     0:00  \_ [loop2]
 2554 ?        I<     0:00  \_ [kworker/3:0H]
 2556 ?        I<     0:00  \_ [kworker/1:0H]
 2557 ?        I      0:00  \_ [kworker/0:0-events]
 2558 ?        I<     0:00  \_ [kworker/0:0H]
 2652 ?        I<     0:00  \_ [kworker/2:1H]
    1 ?        Ss     0:27 /sbin/init fixrtc splash
  675 ?        S<s    0:01 /lib/systemd/systemd-journald
  701 ?        Ss     0:03 /lib/systemd/systemd-udevd
 1044 ?        SLsl   0:01 /sbin/multipathd -d -s
 1069 ?        Ssl    0:00 /lib/systemd/systemd-timesyncd
 1105 ?        Ss     0:00 /lib/systemd/systemd-networkd
 1107 ?        Ss     0:00 /lib/systemd/systemd-resolved
 1196 ?        Ssl    0:00 /usr/lib/accountsservice/accounts-daemon
 1197 ?        Ss     0:03 /usr/bin/dbus-daemon --system --address=systemd: --no
 1200 ?        Ssl    0:00 /usr/sbin/irqbalance --foreground
 1202 ?        Ss     0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-s
 1205 ?        Ssl    0:00 /usr/sbin/rsyslogd -n -iNONE
 1208 ?        Ss     0:01 /lib/systemd/systemd-logind
 1209 ?        Ss     0:00 /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant
 1241 ?        Ss     0:00 /usr/sbin/cron -f
 1246 ?        Ssl    0:00 /usr/bin/python3 /usr/share/unattended-upgrades/unatt
 1247 ?        Ss     0:00 /usr/sbin/atd -f
 1261 tty1     Ss+    0:00 /sbin/agetty -o -p -- \u --noclear tty1 linux
 1282 ?        Ssl    0:00 /usr/lib/policykit-1/polkitd --no-debug
 1808 ?        Ssl    0:15 /usr/lib/snapd/snapd
 2527 ?        Ss     0:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startu
 2553 ?        Ss     0:00 /bin/login -p --
 2660 ttyAMA0  S      0:00  \_ -bash
 2671 ttyAMA0  R+     0:00      \_ ps axf
 2593 ?        R      0:06 /usr/bin/python3 /usr/lib/ubuntu-release-upgrader/che
 2654 ?        Ss     0:03 /lib/systemd/systemd --user
 2655 ?        S      0:00  \_ (sd-pam)
```

### cpu

```shell
$ dmesg | grep -i cpu
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] CPU: ARMv7 Processor [410fd034] revision 4 (ARMv7), cr=30c5383d
[    0.000000] CPU: div instructions available: patching division code
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
[    0.000000] percpu: Embedded 21 pages/cpu s54284 r8192 d23540 u86016
[    0.000000] pcpu-alloc: s54284 r8192 d23540 u86016 alloc=21*4096
[    0.000000] pcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[    0.003064] CPU: Testing write buffer coherency: ok
[    0.003676] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
[    0.009532] smp: Bringing up secondary CPUs ...
[    0.010966] CPU1: thread -1, cpu 1, socket 0, mpidr 80000001
[    0.013066] CPU2: thread -1, cpu 2, socket 0, mpidr 80000002
[    0.014954] CPU3: thread -1, cpu 3, socket 0, mpidr 80000003
[    0.015484] smp: Brought up 1 node, 4 CPUs
[    0.015510] CPU: All CPU(s) started in HYP mode.
[    0.015519] CPU: Virtualization extensions available.
[    0.051726] cpuidle: using governor ladder
[    0.051776] cpuidle: using governor menu
[    1.132796] kvm [1]: Error, CPU 0 not supported!
[    1.235453] raspberrypi-clk firmware-clocks: CPU frequency range: min 600000000, max 1400000000
[    2.227784] cpufreq: cpufreq_online: CPU0: Running at unlisted freq: 600000 KHz
[    2.230324] cpufreq: cpufreq_online: CPU0: Unlisted initial frequency changed to: 700000 KHz
[    2.235309] ledtrig-cpu: registered to indicate activity on CPUs
[    2.350123] cryptd: max_cpu_qlen set to 1000
```

### memory

```shell
$ free -m
              total        used        free      shared  buff/cache   available
Mem:            852         149         145           3         558         680
Swap:             0           0           0

$ cat /proc/meminfo
MemTotal:         873340 kB
MemFree:          147616 kB
MemAvailable:     697004 kB
Buffers:           40816 kB
Cached:           497424 kB
SwapCached:            0 kB
Active:           313752 kB
Inactive:         273144 kB
Active(anon):      56808 kB
Inactive(anon):      140 kB
Active(file):     256944 kB
Inactive(file):   273004 kB
Unevictable:       15900 kB
Mlocked:           15900 kB
HighTotal:        184320 kB
HighFree:            272 kB
LowTotal:         689020 kB
LowFree:          147344 kB
SwapTotal:             0 kB
SwapFree:              0 kB
Dirty:               152 kB
Writeback:             0 kB
AnonPages:         64480 kB
Mapped:            78020 kB
Shmem:              3932 kB
KReclaimable:      34124 kB
Slab:              72528 kB
SReclaimable:      34124 kB
SUnreclaim:        38404 kB
KernelStack:        1344 kB
PageTables:         1540 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:      436668 kB
Committed_AS:     423140 kB
VmallocTotal:     245760 kB
VmallocUsed:        6816 kB
VmallocChunk:          0 kB
Percpu:             1872 kB
CmaTotal:          65536 kB
CmaFree:             136 kB
```

### disk

#### mmc

```shell
$ dmesg | grep mmc
[    2.233066] mmc-bcm2835 3f300000.mmcnr: could not get clk, deferring probe
[    2.233403] sdhost-bcm2835 3f202000.mmc: could not get clk, deferring probe
[    2.700785] mmc-bcm2835 3f300000.mmcnr: mmc_debug:0 mmc_debug2:0
[    2.700803] mmc-bcm2835 3f300000.mmcnr: DMA channel allocated
[    2.765220] mmc1: queuing unknown CIS tuple 0x80 (2 bytes)
[    2.766891] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    2.768551] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    2.771527] mmc1: queuing unknown CIS tuple 0x80 (7 bytes)
[    2.776729] mmc0: sdhost-bcm2835 loaded - DMA enabled (>1)
[    2.838151] mmc0: host does not support reading read-only switch, assuming write-enable
[    2.841244] mmc0: new high speed SDXC card at address 5048
[    2.843234] mmcblk0: mmc0:5048 SD64G 58.2 GiB
[    2.848012]  mmcblk0: p1 p2
[    2.865151] mmc1: new high speed SDIO card at address 0001
[   10.125543] EXT4-fs (mmcblk0p2): INFO: recovery required on readonly filesystem
[   10.125559] EXT4-fs (mmcblk0p2): write access will be enabled during recovery
[   10.228107] EXT4-fs (mmcblk0p2): recovery complete
[   10.230059] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)
[   13.573211] EXT4-fs (mmcblk0p2): re-mounted. Opts: (null)
[   39.451128] EXT4-fs (mmcblk0p2): resizing filesystem from 653754 to 15195899 blocks
[   40.117233] EXT4-fs (mmcblk0p2): resized filesystem to 15195899
```

#### blkid

```shell
$ blkid
/dev/mmcblk0p1: LABEL_FATBOOT="system-boot" LABEL="system-boot" UUID="09CD-6B98" TYPE="vfat" PARTUUID="cca9935b-01"
/dev/mmcblk0p2: LABEL="writable" UUID="e25d9784-3410-48b0-9928-acf20eecb840" TYPE="ext4" PARTUUID="cca9935b-02"
```

#### parted

```shell
$ sudo partprobe /dev/mmcblk0

$ sudo partx -uv /dev/mmcblk0
partition: none, disk: /dev/mmcblk0, lower: 0, upper: 0
/dev/mmcblk0: partition table type 'dos' detected
/dev/mmcblk0: partition #1 resized
/dev/mmcblk0: partition #2 resized

$ sudo parted /dev/mmcblk0 print
Model: SD SD64G (sd/mmc)
Disk /dev/mmcblk0: 62.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  269MB   268MB   primary  fat32        boot, lba
 2      269MB   62.5GB  62.2GB  primary  ext4
```

#### gdisk

```shell
$ sudo gdisk -l /dev/mmcblk0
GPT fdisk (gdisk) version 1.0.5

Partition table scan:
  MBR: MBR only
  BSD: not present
  APM: not present
  GPT: not present


***************************************************************
Found invalid GPT and valid MBR; converting MBR to GPT format
in memory.
***************************************************************

Disk /dev/mmcblk0: 122093568 sectors, 58.2 GiB
Sector size (logical/physical): 512/512 bytes
Disk identifier (GUID): 406FD7E9-35FF-41CB-8C2D-209C982E9E77
Partition table holds up to 128 entries
Main partition table begins at sector 2 and ends at sector 33
First usable sector is 34, last usable sector is 122093534
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          526335   256.0 MiB   0700  Microsoft basic data
   2          526336       122093534   58.0 GiB    8300  Linux filesystem
```

#### fdisk

```shell
$ sudo fdisk -l /dev/mmcblk0
Disk /dev/mmcblk0: 58.22 GiB, 62511906816 bytes, 122093568 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xcca9935b

Device         Boot  Start       End   Sectors  Size Id Type
/dev/mmcblk0p1 *      2048    526335    524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2      526336 122093534 121567199   58G 83 Linux
```

#### mounts

```shell
$ mount | grep ^/dev
/dev/mmcblk0p2 on / type ext4 (rw,relatime)
/dev/mmcblk0p1 on /boot/firmware type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,errors=remount-ro)
```

#### df

```shell
$ df -m | grep ^/dev/mmc
Filesystem     1M-blocks  Used Available Use% Mounted on
/dev/mmcblk0p2     58365  1854     54096   4% /
/dev/mmcblk0p1       253    57       196  23% /boot/firmware
```

### network

#### devices

```shell
$ ls /sys/class/net/
eth0  eth1  lo  wlan0

$ ip link show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether b8:27:eb:66:13:38 brd ff:ff:ff:ff:ff:ff
3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/ether 00:e0:4c:36:03:b4 brd ff:ff:ff:ff:ff:ff
4: wlan0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/ether b8:27:eb:33:46:6d brd ff:ff:ff:ff:ff:ff

$ dmesg | grep -Ei "eth0|lan78"
[    1.815497] usbcore: registered new interface driver lan78xx
[    4.393951] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): No External EEPROM. Setting MAC Speed
[    4.395160] libphy: lan78xx-mdiobus: probed
[    4.430973] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): int urb period 64
[   31.838397] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready

$ dmesg | grep -Ei "eth1|r8152"
[   16.012088] usbcore: registered new interface driver r8152
[   16.324027] r8152 1-1.3.1:1.0 eth1: v1.10.11

$ dmesg | grep -Ei "wlan0|brcmfmac"
[   16.242743] brcmfmac: F1 signature read @0x18000000=0x15264345
[   16.252672] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   16.268049] usbcore: registered new interface driver brcmfmac
[   16.549881] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   16.595297] brcmfmac: brcmf_c_preinit_dcmds: Firmware: BCM4345/6 wl0: Mar  2 2020 23:30:41 version 7.45.202 (r724630 CY) FWID 01-72f6ece2
[ 1728.603723] brcmfmac: brcmf_cfg80211_set_power_mgmt: power save enabled
[ 1913.722968] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready

$ modinfo brcmfmac
filename:       /lib/modules/5.4.0-1015-raspi/kernel/drivers/net/wireless/broadcom/brcm80211/brcmfmac/brcmfmac.ko
license:        Dual BSD/GPL
description:    Broadcom 802.11 wireless LAN fullmac driver.
author:         Broadcom Corporation
firmware:       brcm/brcmfmac43455-sdio.bin

$ sudo apt-get install -y --no-install-recommends rfkill wireless-tools

$ rfkill list
0: phy0: Wireless LAN
        Soft blocked: no
        Hard blocked: no

$ iw dev
phy#0
	Unnamed/non-netdev interface
		wdev 0x2
		addr ca:3b:a3:50:34:9c
		type P2P-device
		txpower 31.00 dBm
	Interface wlan0
		ifindex 4
		wdev 0x1
		addr b8:27:eb:33:46:6d
		ssid DONGSHENG-CMMC
		type managed
		channel 40 (5200 MHz), width: 80 MHz, center1: 5210 MHz
		txpower 31.00 dBm

$ iw reg get
global
country US: DFS-FCC
	(2402 - 2472 @ 40), (N/A, 30), (N/A)
	(5170 - 5250 @ 80), (N/A, 23), (N/A), AUTO-BW
	(5250 - 5330 @ 80), (N/A, 23), (0 ms), DFS, AUTO-BW
	(5490 - 5730 @ 160), (N/A, 23), (0 ms), DFS
	(5735 - 5835 @ 80), (N/A, 30), (N/A)
	(57240 - 63720 @ 2160), (N/A, 40), (N/A)

$ sudo ip link set dev wlan0 up
$ sudo iwlist wlan0 scan
```

#### ethtool

```
$ sudo ethtool -i eth0
driver: lan78xx
version:
firmware-version:
expansion-rom-version:
bus-info: usb-3f980000.usb-1.1.1
supports-statistics: yes
supports-test: no
supports-eeprom-access: yes
supports-register-dump: yes
supports-priv-flags: no

$ sudo ethtool -i eth1
driver: r8152
version: v1.10.11
firmware-version:
expansion-rom-version:
bus-info: usb-3f980000.usb-1.3.1
supports-statistics: yes
supports-test: no
supports-eeprom-access: no
supports-register-dump: no
supports-priv-flags: no

$ sudo ethtool -i wlan0
driver: brcmfmac
version: 7.45.202
firmware-version: 01-72f6ece2
expansion-rom-version:
bus-info: mmc1:0001:1
supports-statistics: no
supports-test: no
supports-eeprom-access: no
supports-register-dump: no
supports-priv-flags: no
```

#### wpa

```shell
# wpa_passphrase DONGSHENG-CMCC | sudo tee /etc/wpa_supplicant/wpa_supplicant.conf

$ sudo /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant

$ cat /etc/wpa_supplicant/wpa_supplicant.conf
ctrl_interface=DIR=/run/wpa_supplicant GROUP=netdev
update_config=1
country=US

network={
	ssid="my-ssid"
	psk="my-psk"
   scan_ssid=1
   key_mgmt=WPA-PSK
}

$ sudo wpa_supplicant -B -D brcmfmac -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
$ sudo wpa_supplicant -d -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
```

#### netplan

```shell
$ sudo vi /etc/netplan/50-cloud-init.yaml
network:
   version: 2
   bonds: {}
   bridges: {}
   ovs_ports: {}
   vlans: {}
   ethernets:
      eth0:
         optional: true
         dhcp4: true
      eth1:
         optional: true
         dhcp4: true
   wifis:
      wlan0:
         optional: true
         dhcp4: true
         access-points:
            "my-ssid":
               password: "my-psk"

$ sudo netplan apply
$ sudo netplan --debug apply
```

### USB

#### lsusb

```shell
$ lsusb -v
$ lsusb
Bus 001 Device 005: ID 0bda:8152 Realtek Semiconductor Corp. RTL8152 Fast Ethernet Adapter
Bus 001 Device 004: ID 214b:7250
Bus 001 Device 006: ID 0424:7800 Microchip Technology, Inc. (formerly SMSC)
Bus 001 Device 003: ID 0424:2514 Microchip Technology, Inc. (formerly SMSC) USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Microchip Technology, Inc. (formerly SMSC) USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```

#### usb-devices

```shell
$ usb-devices

T:  Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev#=  1 Spd=480 MxCh= 1
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=01 MxPS=64 #Cfgs=  1
P:  Vendor=1d6b ProdID=0002 Rev=05.04
S:  Manufacturer=Linux 5.4.0-1015-raspi dwc_otg_hcd
S:  Product=DWC OTG Controller
S:  SerialNumber=3f980000.usb
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=0mA
I:  If#=0x0 Alt= 0 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=00 Driver=hub

T:  Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#=  2 Spd=480 MxCh= 4
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=02 MxPS=64 #Cfgs=  1
P:  Vendor=0424 ProdID=2514 Rev=0b.b3
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA
I:  If#=0x0 Alt= 1 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=02 Driver=hub

T:  Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#=  3 Spd=480 MxCh= 3
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=02 MxPS=64 #Cfgs=  1
P:  Vendor=0424 ProdID=2514 Rev=0b.b3
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA
I:  If#=0x0 Alt= 1 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=02 Driver=hub

T:  Bus=01 Lev=03 Prnt=03 Port=00 Cnt=01 Dev#=  6 Spd=480 MxCh= 0
D:  Ver= 2.10 Cls=ff(vend.) Sub=00 Prot=ff MxPS=64 #Cfgs=  1
P:  Vendor=0424 ProdID=7800 Rev=03.00
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA
I:  If#=0x0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=ff Driver=lan78xx

T:  Bus=01 Lev=02 Prnt=02 Port=02 Cnt=02 Dev#=  4 Spd=480 MxCh= 4
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=01 MxPS=64 #Cfgs=  1
P:  Vendor=214b ProdID=7250 Rev=01.00
S:  Product=USB2.0 HUB
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=100mA
I:  If#=0x0 Alt= 0 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=00 Driver=hub

T:  Bus=01 Lev=03 Prnt=04 Port=00 Cnt=01 Dev#=  5 Spd=480 MxCh= 0
D:  Ver= 2.10 Cls=00(>ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=  2
P:  Vendor=0bda ProdID=8152 Rev=20.00
S:  Manufacturer=Realtek
S:  Product=USB 10/100 LAN
S:  SerialNumber=00E04C3603B4
C:  #Ifs= 1 Cfg#= 1 Atr=a0 MxPwr=100mA
I:  If#=0x0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=ff Prot=00 Driver=r8152
```

### hwloc

```shell
$ /usr/bin/hwloc-info
depth 0:           1 Machine (type #0)
 depth 1:          1 Package (type #1)
  depth 2:         4 Die (type #19)
   depth 3:        4 Core (type #2)
    depth 4:       4 PU (type #3)
Special depth -3:  1 NUMANode (type #13)
Special depth -6:  2 OSDev (type #16)

$ /usr/bin/lstopo
Machine (853MB total)
  Package L#0
    NUMANode L#0 (P#0 853MB)
    Die L#0 + Core L#0 + PU L#0 (P#0)
    Die L#1 + Core L#1 + PU L#1 (P#1)
    Die L#2 + Core L#2 + PU L#2 (P#2)
    Die L#3 + Core L#3 + PU L#3 (P#3)
  Block "mmcblk0"
  Net "wlan0"
```

### hwinfo

```shell
$ sudo /usr/sbin/hwinfo --arch --bios --cpu --memory --disk --block --netcard --network
02: None 00.0: 10103 CPU
  [Created at cpu.278]
  Unique ID: rdCR.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: ARM
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Platform: "BCM2835"
  Features: half,thumb,fastmult,vfp,edsp,neon,vfpv3,tls,vfpv4,idiva,idivt,vfpd32,lpae,evtstrm,crc32,
  BogoMips: 44.80
  Config Status: cfg=new, avail=yes, need=no, active=unknown

03: None 01.0: 10103 CPU
  [Created at cpu.278]
  Unique ID: wkFv.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: ARM
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Platform: "BCM2835"
  Features: half
  BogoMips: 44.80
  Config Status: cfg=new, avail=yes, need=no, active=unknown

04: None 02.0: 10103 CPU
  [Created at cpu.278]
  Unique ID: +rIN.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: ARM
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Platform: "BCM2835"
  Features: half
  BogoMips: 44.80
  Config Status: cfg=new, avail=yes, need=no, active=unknown

05: None 03.0: 10103 CPU
  [Created at cpu.278]
  Unique ID: 4zLr.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: ARM
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Platform: "BCM2835"
  Features: half
  BogoMips: 44.80
  Config Status: cfg=new, avail=yes, need=no, active=unknown

06: None 00.0: 10102 Main Memory
  [Created at memory.74]
  Unique ID: rdCR.CxwsZFjVASF
  Hardware Class: memory
  Model: "Main Memory"
  Memory Range: 0x00000000-0x354defff (rw)
  Memory Size: 832 MB
  Config Status: cfg=new, avail=yes, need=no, active=unknown

11: SDIO 00.0: 0282 WLAN controller
  [Created at pci.1939]
  Unique ID: 0DfK.f_UYNWgFjo0
  Parent ID: tTVG.VoJli79_k95
  SysFS ID: /devices/platform/soc/3f300000.mmcnr/mmc_host/mmc1/mmc1:0001/mmc1:0001:1
  SysFS BusID: mmc1:0001:1
  Hardware Class: network
  Model: "Broadcom BCM43430 WLAN card"
  Vendor: sdio 0x02d0 "Broadcom Corp."
  Device: sdio 0xa9a6 "BCM43430 WLAN card"
  Driver: "brcmfmac"
  Driver Modules: "brcmfmac", "brcmfmac", "brcmfmac"
  Device File: wlan0
  Features: WLAN
  HW Address: b8:27:eb:33:46:6d
  Permanent HW Address: b8:27:eb:33:46:6d
  Link detected: yes
  WLAN channels: 1 2 3 4 5 6 7 8 9 10 11 36 40 44 48 52 56 60 64 100 104 108 112 116 120 124 128 132 136 140 144 149
  WLAN frequencies: 2.412 2.417 2.422 2.427 2.432 2.437 2.442 2.447 2.452 2.457 2.462 5.18 5.2 5.22 5.24 5.26 5.28 5.3 5.32 5.5 5.52 5.54 5.56 5.58 5.6 5.62 5.64 5.66 5.68 5.7 5.72 5.745
  WLAN encryption modes: WEP40 WEP104 TKIP CCMP
  WLAN authentication modes: open sharedkey wpa-psk wpa-eap
  Module Alias: "sdio:c00v02D0dA9A6"
  Driver Info #0:
    Driver Status: brcmfmac is active
    Driver Activation Cmd: "modprobe brcmfmac"
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #8 (MMC Controller)

13: None 00.0: 10600 Disk
  [Created at block.245]
  Unique ID: HAKk.Fxp0d3BezAE
  Parent ID: 924w._NN+DZ1HDn4
  SysFS ID: /class/block/mmcblk0
  SysFS BusID: mmc0:5048
  SysFS Device Link: /devices/platform/soc/3f202000.mmc/mmc_host/mmc0/mmc0:5048
  Hardware Class: disk
  Model: "Disk"
  Driver: "sdhost-bcm2835", "mmcblk"
  Device File: /dev/mmcblk0
  Device Files: /dev/mmcblk0, /dev/disk/by-path/platform-3f202000.mmc, /dev/disk/by-id/mmc-SD64G_0xda7f8e63
  Device Number: block 179:0-179:31
  Geometry (Logical): CHS 1907712/4/16
  Size: 122093568 sectors a 512 bytes
  Capacity: 58 GB (62511906816 bytes)
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #9 (MMC Controller)

14: None 00.0: 11300 Partition
  [Created at block.434]
  Unique ID: l7UW.SE1wIdpsiiC
  Parent ID: HAKk.Fxp0d3BezAE
  SysFS ID: /class/block/mmcblk0/mmcblk0p1
  Hardware Class: partition
  Model: "Partition"
  Device File: /dev/mmcblk0p1
  Device Files: /dev/mmcblk0p1, /dev/disk/by-path/platform-3f202000.mmc-part1, /dev/disk/by-partuuid/cca9935b-01, /dev/disk/by-id/mmc-SD64G_0xda7f8e63-part1, /dev/disk/by-label/system-boot, /dev/disk/by-uuid/09CD-6B98
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #13 (Disk)

15: None 00.0: 11300 Partition
  [Created at block.434]
  Unique ID: CJka.SE1wIdpsiiC
  Parent ID: HAKk.Fxp0d3BezAE
  SysFS ID: /class/block/mmcblk0/mmcblk0p2
  Hardware Class: partition
  Model: "Partition"
  Device File: /dev/mmcblk0p2
  Device Files: /dev/mmcblk0p2, /dev/disk/by-id/mmc-SD64G_0xda7f8e63-part2, /dev/disk/by-label/writable, /dev/disk/by-path/platform-3f202000.mmc-part2, /dev/disk/by-partuuid/cca9935b-02, /dev/disk/by-uuid/e25d9784-3410-48b0-9928-acf20eecb840
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #13 (Disk)

16: USB 00.0: 0200 Ethernet controller
  [Created at usb.122]
  Unique ID: fzDf.UulhbgwZZxD
  Parent ID: dwDZ.V+vVO9032M2
  SysFS ID: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.3/1-1.3.1/1-1.3.1:1.0
  SysFS BusID: 1-1.3.1:1.0
  Hardware Class: network
  Model: "Realtek RTL8152 Fast Ethernet Adapter"
  Hotplug: USB
  Vendor: usb 0x0bda "Realtek Semiconductor Corp."
  Device: usb 0x8152 "RTL8152 Fast Ethernet Adapter"
  Revision: "20.00"
  Serial ID: "00E04C3603B4"
  Driver: "r8152"
  Driver Modules: "r8152"
  Device File: eth1
  Speed: 480 Mbps
  HW Address: 00:e0:4c:36:03:b4
  Permanent HW Address: 00:e0:4c:36:03:b4
  Link detected: no
  Module Alias: "usb:v0BDAp8152d2000dc00dsc00dp00icFFiscFFip00in00"
  Driver Info #0:
    Driver Status: r8152 is active
    Driver Activation Cmd: "modprobe r8152"
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #17 (Hub)

18: USB 00.0: 0200 Ethernet controller
  [Created at usb.122]
  Unique ID: Vl7j.8_I5RcIC_05
  Parent ID: lfzD.YCWTDwYJz_B
  SysFS ID: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.1/1-1.1.1/1-1.1.1:1.0
  SysFS BusID: 1-1.1.1:1.0
  Hardware Class: network
  Model: "Standard Microsystems Ethernet controller"
  Hotplug: USB
  Vendor: usb 0x0424 "Standard Microsystems Corp."
  Device: usb 0x7800
  Revision: "3.00"
  Driver: "lan78xx"
  Driver Modules: "lan78xx"
  Device File: eth0
  Speed: 480 Mbps
  HW Address: b8:27:eb:66:13:38
  Permanent HW Address: b8:27:eb:66:13:38
  Link detected: yes
  Module Alias: "usb:v0424p7800d0300dcFFdsc00dpFFicFFisc00ipFFin00"
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #20 (Hub)

22: None 00.0: 1070a WLAN
  [Created at net.126]
  Unique ID: AYEt.QXn1l67RSa1
  Parent ID: 0DfK.f_UYNWgFjo0
  SysFS ID: /class/net/wlan0
  SysFS Device Link: /devices/platform/soc/3f300000.mmcnr/mmc_host/mmc1/mmc1:0001/mmc1:0001:1
  Hardware Class: network interface
  Model: "WLAN network interface"
  Driver: "brcmfmac"
  Driver Modules: "brcmfmac", "brcmfmac", "brcmfmac"
  Device File: wlan0
  HW Address: b8:27:eb:33:46:6d
  Permanent HW Address: b8:27:eb:33:46:6d
  Link detected: yes
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #11 (WLAN controller)

23: None 00.0: 10701 Ethernet
  [Created at net.126]
  Unique ID: usDW.ndpeucax6V1
  Parent ID: Vl7j.8_I5RcIC_05
  SysFS ID: /class/net/eth0
  SysFS Device Link: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.1/1-1.1.1/1-1.1.1:1.0
  Hardware Class: network interface
  Model: "Ethernet network interface"
  Driver: "lan78xx"
  Driver Modules: "lan78xx"
  Device File: eth0
  HW Address: b8:27:eb:66:13:38
  Permanent HW Address: b8:27:eb:66:13:38
  Link detected: yes
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #18 (Ethernet controller)

24: None 00.0: 10700 Loopback
  [Created at net.126]
  Unique ID: ZsBS.GQNx7L4uPNA
  SysFS ID: /class/net/lo
  Hardware Class: network interface
  Model: "Loopback network interface"
  Device File: lo
  Link detected: yes
  Config Status: cfg=new, avail=yes, need=no, active=unknown

25: None 01.0: 10701 Ethernet
  [Created at net.126]
  Unique ID: L2Ua.ndpeucax6V1
  Parent ID: fzDf.UulhbgwZZxD
  SysFS ID: /class/net/eth1
  SysFS Device Link: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.3/1-1.3.1/1-1.3.1:1.0
  Hardware Class: network interface
  Model: "Ethernet network interface"
  Driver: "r8152"
  Driver Modules: "r8152"
  Device File: eth1
  HW Address: 00:e0:4c:36:03:b4
  Permanent HW Address: 00:e0:4c:36:03:b4
  Link detected: no
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #16 (Ethernet controller)
```

### hciconfig

```shell
hciconfig -a
hciconfig hci0 version
hciconfig hci0 features
```

### bluetoothctl

```shell
bluetoothctl version
bluetoothctl list
bluetoothctl show
bluetoothctl devices
bluetoothctl info 9C:28:F7:97:DF:48
```

### sysctl

```shell
$ sudo sysctl -a | grep ^abi | sort

$ sudo sysctl -a | grep ^fs | sort
fs.aio-max-nr = 65536
fs.aio-nr = 0
fs.binfmt_misc.status = enabled
fs.dir-notify-enable = 1
fs.epoll.max_user_watches = 233436
fs.inotify.max_queued_events = 16384
fs.inotify.max_user_instances = 128
fs.inotify.max_user_watches = 8192
fs.lease-break-time = 45
fs.leases-enable = 1
fs.pipe-max-size = 1048576
fs.pipe-user-pages-hard = 0
fs.pipe-user-pages-soft = 16384

$ sudo sysctl -a | grep ^kernel | sort
kernel.core_pattern = |/usr/share/apport/apport %p %s %c %d %P %E
kernel.core_pipe_limit = 0
kernel.core_uses_pid = 0
kernel.watchdog = 1
kernel.watchdog_cpumask = 0-3
kernel.watchdog_thresh = 10

$ sudo sysctl -a | grep ^net | sort
net.core.bpf_jit_enable = 1
net.core.bpf_jit_harden = 0
net.core.bpf_jit_kallsyms = 0
net.core.bpf_jit_limit = 3670016
net.core.busy_poll = 0
net.core.busy_read = 0
net.core.default_qdisc = fq_codel
net.core.dev_weight = 64
net.core.dev_weight_rx_bias = 1
net.core.dev_weight_tx_bias = 1
net.core.somaxconn = 4096

$ sudo sysctl -a | grep ^user | sort
user.max_cgroup_namespaces = 6093
user.max_inotify_instances = 128
user.max_inotify_watches = 8192
user.max_ipc_namespaces = 6093
user.max_mnt_namespaces = 6093
user.max_net_namespaces = 6093
user.max_pid_namespaces = 6093
user.max_user_namespaces = 6093
user.max_uts_namespaces = 6093

$ sudo sysctl -a | grep ^vm | sort
vm.admin_reserve_kbytes = 8192
vm.block_dump = 0
vm.compact_unevictable_allowed = 1
vm.dirty_background_bytes = 0
vm.dirty_background_ratio = 10
vm.dirty_bytes = 0
vm.dirty_expire_centisecs = 3000
vm.dirty_ratio = 20
vm.dirtytime_expire_seconds = 43200
vm.dirty_writeback_centisecs = 500
vm.extfrag_threshold = 500
vm.lowmem_reserve_ratio = 256   32      0       0
vm.max_map_count = 65530
vm.min_free_kbytes = 3252
vm.mmap_min_addr = 32768
vm.mmap_rnd_bits = 8
```

## Basic configuration

### OS configuration

### Install packages

```shell
sudo apt-get update; sudo apt-get dist-upgrade -y
sudo apt-get install -y --no-install-recommends hwinfo hwloc ; \
sudo apt-get install -y --no-install-recommends rfkill wireless-tools bluez
```

## Conclusion

It looks Ubuntu can’t found WiFi Adapter in Raspberry Pi 3 Model B Plus Rev 1.3, it’s really disappointing.
