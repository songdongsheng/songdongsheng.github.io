---
title: Ubuntu 20.04 arm64 on Raspberry Pi 3B+
description: Ubuntu 20.04 arm64 on Raspberry Pi 3B+
date: 2020-12-05 15:58:23
tags:
    - Operating system
    - Linux
categories: [Operating system, Linux]
permalink: ubuntu-20.04-arm64-on-raspberrypi-3b-plus
---

# Ubuntu 20.04 arm64 on Raspberry Pi 3B+

## Download Ubuntu image

### Reference

-   https://www.raspberrypi.org/documentation/configuration/uart.md
-   https://www.raspberrypi.org/documentation/usage/gpio/
-   https://www.debian.org/distrib/packages
-   http://manpages.ubuntu.com/manpages/focal/en/man5/netplan.5.html
-   http://manpages.ubuntu.com/manpages/focal/en/man8/netplan.8.html
-   https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz
-   https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz
-   https://cdimage.ubuntu.com/releases/20.10/release/ubuntu-20.10-preinstalled-server-arm64+raspi.img.xz
-   https://cdimage.ubuntu.com/releases/20.10/release/ubuntu-20.10-preinstalled-server-arm64+raspi.img.xz

### Download command

```shell
$ cat << EOF | aria2c -i -
https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz
https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz
EOF
```

### Integrity check

```shell
cat << EOF | sha256sum -c
aadc64a1d069c842e56a4289fe1a6b4b5a0af4efcf95bcce78eb2a80fe5270f4 ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz
bfd1eee56f7e346e1645666fc184af854c536b3ab4e1ce49d06c266f21b1ee46 ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz
EOF
```

## Write image to MicroSD card

### MicroSD card

```shell
$ dmesg -w
[    0.621922] mmc0: SDHCI controller on PCI [0000:03:00.0] using ADMA
[    0.851733] mmc0: new high speed SDXC card at address 5048
[    0.853303] mmcblk0: mmc0:5048 SD64G 58.2 GiB
```

### Write image

```shell
$ cat ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz \
        | xz -cd \
        | sudo /usr/bin/time -f "\nreal\t%es\nuser\t%Us\nsys\t%Ss\n" dd of=/dev/mmcblk0 bs=4M oflag=sync status=progress
0+49663 records in
0+49663 records out
3250824192 bytes (3.3 GB, 3.0 GiB) copied, 289.182 s, 11.2 MB/s
```

### parted

```shell
$ sudo partprobe /dev/mmcblk0

$ sudo partx -uv /dev/mmcblk0

$ sudo parted /dev/mmcblk0 print
Model: SD SD64G (sd/mmc)
Disk /dev/mmcblk0: 62.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  269MB   268MB   primary  fat32        boot, lba
 2      269MB   3251MB  2981MB  primary  ext4
```

### gdisk

```shell
$ sudo gdisk -l /dev/mmcblk0 2>/dev/null
GPT fdisk (gdisk) version 1.0.5

Partition table scan:
  MBR: MBR only
  BSD: not present
  APM: not present
  GPT: not present


***************************************************************
Found invalid GPT and valid MBR; converting MBR to GPT format
in memory.
***************************************************************

Disk /dev/mmcblk0: 122093568 sectors, 58.2 GiB
Sector size (logical/physical): 512/512 bytes
Disk identifier (GUID): 192B2178-C964-40D4-B213-7711265FEC24
Partition table holds up to 128 entries
Main partition table begins at sector 2 and ends at sector 33
First usable sector is 34, last usable sector is 122093534
Partitions will be aligned on 2048-sector boundaries
Total free space is 115746317 sectors (55.2 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          526335   256.0 MiB   0700  Microsoft basic data
   2          526336         6349231   2.8 GiB     8300  Linux filesystem
```

### fdisk

```shell
$ sudo fdisk -l /dev/mmcblk0
Disk /dev/mmcblk0: 58.22 GiB, 62511906816 bytes, 122093568 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xab86aefd

Device         Boot  Start     End Sectors  Size Id Type
/dev/mmcblk0p1 *      2048  526335  524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2      526336 6349231 5822896  2.8G 83 Linux
```

### filesystem label

```shell
$ sudo fsck.vfat -a /dev/mmcblk0p1
fsck.fat 4.1 (2017-01-24)
/dev/mmcblk0p1: 237 files, 121131/516190 clusters

$ sudo dosfslabel /dev/mmcblk0p1
system-boot

$ sudo e2fsck -p /dev/mmcblk0p2
writable: clean, 74810/182160 files, 488817/727862 blocks

$ sudo e2label /dev/mmcblk0p2
writable
```

### mmcblk

```shell
$ dmesg -w
[ 5632.885061] mmc0: new high speed SDXC card at address 5048
[ 5632.885363] mmcblk0: mmc0:5048 SD64G 58.2 GiB
[ 5632.909619] mmcblk0: p1 p2
[ 5633.244337] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)
```

### blkid

```shell
$ sudo blkid --info /dev/mmcblk0*
/dev/mmcblk0: MINIMUM_IO_SIZE="512" PHYSICAL_SECTOR_SIZE="512" LOGICAL_SECTOR_SIZE="512"
/dev/mmcblk0p1: MINIMUM_IO_SIZE="512" PHYSICAL_SECTOR_SIZE="512" LOGICAL_SECTOR_SIZE="512"
/dev/mmcblk0p2: MINIMUM_IO_SIZE="512" PHYSICAL_SECTOR_SIZE="512" LOGICAL_SECTOR_SIZE="512"
```

### df

```shell
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/mmcblk0p2  2.7G  1.8G  776M  70% /media/dongsheng/writable
/dev/mmcblk0p1  253M   60M  193M  24% /media/dongsheng/system-boot
```

### Boot configuration

```shell
$ cat /boot/firmware/cmdline.txt
net.ifnames=0 dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=LABEL=writable rootfstype=ext4 rootwait fixrtc earlycon=pl011,mmio32,0x3f201000

$ cat /boot/firmware/config.txt
[all]
arm_64bit=1
kernel=vmlinuz
cmdline=cmdline.txt
initramfs initrd.img followkernel

# Enable the audio output, I2C and SPI interfaces on the GPIO header
dtparam=audio=on
dtparam=i2c_arm=on
dtparam=spi=on

# Enable the serial pins
enable_uart=1
#dtoverlay=disable-bt
dtoverlay=miniuart-bt
core_freq=400
```

## UART with USB-TTL

### Pin Connectors

![Raspberry Pi 3 B+ Pins](raspberry_pi_pins.png)

### dmesg

```shell
$ dmesg -w
[ 7483.528344] usb 2-2: new full-speed USB device number 4 using xhci_hcd
[ 7483.685373] usb 2-2: New USB device found, idVendor=1a86, idProduct=7523, bcdDevice= 2.64
[ 7483.685378] usb 2-2: New USB device strings: Mfr=0, Product=2, SerialNumber=0
[ 7483.685380] usb 2-2: Product: USB Serial
[ 7483.713970] usbcore: registered new interface driver usbserial_generic
[ 7483.713978] usbserial: USB Serial support registered for generic
[ 7483.716746] usbcore: registered new interface driver ch341
[ 7483.716759] usbserial: USB Serial support registered for ch341-uart
[ 7483.716776] ch341 2-2:1.0: ch341-uart converter detected
[ 7483.718195] usb 2-2: ch341-uart converter now attached to ttyUSB0
```

### udev

```shell
cat /lib/udev/rules.d/60-serial.rules
    # /dev/serial/by-path/, /dev/serial/by-id/ for USB devices
    KERNEL!="ttyUSB[0-9]*|ttyACM[0-9]*", GOTO="serial_end"

$ /bin/udevadm info /dev/ttyUSB0
P: /devices/pci0000:00/0000:00:14.0/usb2/2-2/2-2:1.0/ttyUSB0/tty/ttyUSB0
N: ttyUSB0
L: 0
S: serial/by-id/usb-1a86_USB_Serial-if00-port0
S: serial/by-path/pci-0000:00:14.0-usb-0:2:1.0-port0
E: DEVPATH=/devices/pci0000:00/0000:00:14.0/usb2/2-2/2-2:1.0/ttyUSB0/tty/ttyUSB0
E: DEVNAME=/dev/ttyUSB0
E: MAJOR=188
E: MINOR=0
E: SUBSYSTEM=tty
E: USEC_INITIALIZED=2833769
E: ID_BUS=usb
E: ID_VENDOR_ID=1a86
E: ID_MODEL_ID=7523
E: ID_PCI_CLASS_FROM_DATABASE=Serial bus controller
E: ID_PCI_SUBCLASS_FROM_DATABASE=USB controller
E: ID_PCI_INTERFACE_FROM_DATABASE=XHCI
E: ID_VENDOR_FROM_DATABASE=QinHeng Electronics
E: ID_MODEL_FROM_DATABASE=HL-340 USB-Serial adapter
E: ID_VENDOR=1a86
E: ID_VENDOR_ENC=1a86
E: ID_MODEL=USB_Serial
E: ID_MODEL_ENC=USB\x20Serial
E: ID_REVISION=0264
E: ID_SERIAL=1a86_USB_Serial
E: ID_TYPE=generic
E: ID_USB_INTERFACES=:ff0102:
E: ID_USB_INTERFACE_NUM=00
E: ID_USB_DRIVER=ch341
E: ID_USB_CLASS_FROM_DATABASE=Vendor Specific Class
E: ID_PATH=pci-0000:00:14.0-usb-0:2:1.0
E: ID_PATH_TAG=pci-0000_00_14_0-usb-0_2_1_0
E: ID_MM_CANDIDATE=1
E: DEVLINKS=/dev/serial/by-id/usb-1a86_USB_Serial-if00-port0 /dev/serial/by-path/pci-0000:00:14.0-usb-0:2:1.0-port0
E: TAGS=:systemd:
```

### minicom

```shell
$ sudo minicom -b 115200 -8 -D /dev/ttyUSB0
```

## Booting Raspberry Pi

### dmesg

```shell
$ dmesg
MMC:   mmc@7e202000: 0, mmcnr@7e300000: 1
Loading Environment from FAT... *** Warning - bad CRC, using default environment

In:    serial
Out:   vidconsole
Err:   vidconsole
Net:   No ethernet found.
starting USB...
Bus usb@7e980000: scanning bus usb@7e980000 for devices... 6 USB Device(s) found
       scanning usb for storage devices... 0 Storage Device(s) found
## Info: input data size = 6 = 0x6
Hit any key to stop autoboot:  0
switch to partitions #0, OK
mmc0 is current device
Scanning mmc 0:1...
Found U-Boot script /boot.scr
2569 bytes read in 3 ms (835.9 KiB/s)
## Executing script at 02400000
8390521 bytes read in 363 ms (22 MiB/s)
Total of 1 halfword(s) were the same
Decompressing kernel...
Uncompressed size: 25907712 = 0x18B5200
29530201 bytes read in 2004 ms (14.1 MiB/s)
Booting Ubuntu (with booti) from mmc 0:...
## Flattened Device Tree blob at 02600000
   Booting using the fdt blob at 0x2600000
   Using Device Tree in place at 0000000002600000, end 000000000260a2a7

Starting kernel ...

[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd034]
[    0.000000] Linux version 5.4.0-1015-raspi (buildd@bos02-arm64-074) (gcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2)) #15-Ubuntu SMP Fri Jul 10 0)
[    0.000000] Machine model: Raspberry Pi 3 Model B Plus Rev 1.3
[    0.000000] earlycon: pl11 at MMIO32 0x000000003f201000 (options '')
[    0.000000] printk: bootconsole [pl11] enabled
[    2.054330] spi-bcm2835 3f204000.spi: could not get clk: -517
ext4
Thu Jan  1 00:00:10 UTC 1970
[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd034]
[    0.000000] Linux version 5.4.0-1015-raspi (buildd@bos02-arm64-074) (gcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2)) #15-Ubuntu SMP Fri Jul 10 0)
[    0.000000] Machine model: Raspberry Pi 3 Model B Plus Rev 1.3
[    0.000000] efi: Getting EFI parameters from FDT:
[    0.000000] efi: UEFI not found.
[    0.000000] Reserved memory: created CMA memory pool at 0x0000000037400000, size 64 MiB
[    0.000000] OF: reserved mem: initialized node linux,cma, compatible id shared-dma-pool
[    0.000000] On node 0 totalpages: 242688
[    0.000000]   DMA zone: 3792 pages used for memmap
[    0.000000]   DMA zone: 0 pages reserved
[    0.000000]   DMA zone: 242688 pages, LIFO batch:63
[    0.000000] percpu: Embedded 32 pages/cpu s92120 r8192 d30760 u131072
[    0.000000] pcpu-alloc: s92120 r8192 d30760 u131072 alloc=32*4096
[    0.000000] pcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3
[    0.000000] Detected VIPT I-cache on CPU0
[    0.000000] CPU features: detected: ARM erratum 845719
[    0.000000] CPU features: kernel page table isolation forced ON by KASLR
[    0.000000] CPU features: detected: Kernel page table isolation (KPTI)
[    0.000000] CPU features: detected: ARM erratum 843419
[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 238896
[    0.000000] Kernel command line:  coherent_pool=1M 8250.nr_uarts=1 snd_bcm2835.enable_compat_alsa=0 snd_bcm2835.enable_hdmi=1 snd_bcm2835.enh
[    0.000000] Dentry cache hash table entries: 131072 (order: 8, 1048576 bytes, linear)
[    0.000000] Inode-cache hash table entries: 65536 (order: 7, 524288 bytes, linear)
[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.000000] Memory: 829476K/970752K available (11772K kernel code, 1236K rwdata, 4244K rodata, 6144K init, 1072K bss, 75740K reserved, 65536)
[    0.000000] random: get_random_u64 called from kmem_cache_open+0x38/0x3e0 with crng_init=0
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[    0.000000] ftrace: allocating 38984 entries in 153 pages
[    0.000000] rcu: Hierarchical RCU implementation.
[    0.000000]  Tasks RCU enabled.
[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0
[    0.000000] arch_timer: cp15 timer(s) running at 19.20MHz (phys).
[    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x46d987e47, max_idle_ns: 440795202767 ns
[    0.000006] sched_clock: 56 bits at 19MHz, resolution 52ns, wraps every 4398046511078ns
[    0.000260] Console: colour dummy device 80x25
[    0.000287] printk: console [tty1] enabled
[    0.000347] Calibrating delay loop (skipped), value calculated using timer frequency.. 38.40 BogoMIPS (lpj=76800)
[    0.000365] pid_max: default: 32768 minimum: 301
[    0.000686] LSM: Security Framework initializing
[    0.000751] Yama: becoming mindful.
[    0.000881] AppArmor: AppArmor initialized
[    0.001161] Mount-cache hash table entries: 2048 (order: 2, 16384 bytes, linear)
[    0.001193] Mountpoint-cache hash table entries: 2048 (order: 2, 16384 bytes, linear)
[    0.001297] *** VALIDATE tmpfs ***
[    0.002208] *** VALIDATE proc ***
[    0.002828] Disabling memory control group subsystem
[    0.002919] *** VALIDATE cgroup1 ***
[    0.002933] *** VALIDATE cgroup2 ***
[    0.004826] ASID allocator initialised with 32768 entries
[    0.005072] rcu: Hierarchical SRCU implementation.
[    0.007837] EFI services will not be available.
[    0.009107] smp: Bringing up secondary CPUs ...
[    0.010429] Detected VIPT I-cache on CPU1
[    0.010499] CPU1: Booted secondary processor 0x0000000001 [0x410fd034]
[    0.012469] Detected VIPT I-cache on CPU2
[    0.012521] CPU2: Booted secondary processor 0x0000000002 [0x410fd034]
[    0.014254] Detected VIPT I-cache on CPU3
[    0.014302] CPU3: Booted secondary processor 0x0000000003 [0x410fd034]
[    0.014794] smp: Brought up 1 node, 4 CPUs
[    0.014807] SMP: Total of 4 processors activated.
[    0.014820] CPU features: detected: 32-bit EL0 Support
[    0.014834] CPU features: detected: CRC32 instructions
[    0.021015] CPU features: emulated: Privileged Access Never (PAN) using TTBR0_EL1 switching
[    0.021028] CPU: All CPU(s) started at EL2
[    0.021134] alternatives: patching kernel code
[    0.023645] devtmpfs: initialized
[    0.039386] Enabled cp15_barrier support
[    0.039421] Enabled setend support
[    0.040165] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.040194] futex hash table entries: 1024 (order: 4, 65536 bytes, linear)
[    0.043935] pinctrl core: initialized pinctrl subsystem
[    0.044950] DMI not present or invalid.
[    0.045954] NET: Registered protocol family 16
[    0.054411] DMA: preallocated 1024 KiB pool for atomic allocations
[    0.054453] audit: initializing netlink subsys (disabled)
[    0.054792] audit: type=2000 audit(0.052:1): state=initialized audit_enabled=0 res=1
[    0.055685] cpuidle: using governor ladder
[    0.055736] cpuidle: using governor menu
[    0.056607] hw-breakpoint: found 6 breakpoint and 4 watchpoint registers.
[    0.057083] Serial: AMBA PL011 UART driver
[    0.060033] bcm2835-mbox 3f00b880.mailbox: mailbox enabled
[    0.076378] raspberrypi-firmware soc:firmware: Attached to firmware from 2020-06-01 13:25, variant start
[    0.080391] raspberrypi-firmware soc:firmware: Firmware hash is 6379679d1ec6a8c746d7e77e015f5b56b939976f
[    0.146654] bcm2835-dma 3f007000.dma: DMA legacy API manager, dmachans=0x1
[    0.150165] iommu: Default domain type: Translated
[    0.152048] SCSI subsystem initialized
[    0.152435] libata version 3.00 loaded.
[    0.152716] usbcore: registered new interface driver usbfs
[    0.152779] usbcore: registered new interface driver hub
[    0.152969] usbcore: registered new device driver usb
[    0.153417] pps_core: LinuxPPS API ver. 1 registered
[    0.153428] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti <giometti@linux.it>
[    0.153456] PTP clock support registered
[    0.153901] EDAC MC: Ver: 3.0.0
[    0.155940] NetLabel: Initializing
[    0.155952] NetLabel:  domain hash size = 128
[    0.155961] NetLabel:  protocols = UNLABELED CIPSOv4 CALIPSO
[    0.156064] NetLabel:  unlabeled traffic allowed by default
[    0.157577] clocksource: Switched to clocksource arch_sys_counter
[    0.283228] *** VALIDATE bpf ***
[    0.283760] VFS: Disk quotas dquot_6.6.0
[    0.283890] VFS: Dquot-cache hash table entries: 512 (order 0, 4096 bytes)
[    0.284053] *** VALIDATE ramfs ***
[    0.284879] AppArmor: AppArmor Filesystem Enabled
[    0.285340] simple-framebuffer 3e513000.framebuffer: framebuffer at 0x3e513000, 0x6d8c00 bytes, mapped to 0x(____ptrval____)
[    0.285358] simple-framebuffer 3e513000.framebuffer: format=a8r8g8b8, mode=1824x984x32, linelength=7296
[    0.286145] Console: switching to colour frame buffer device 228x61
[    0.315614] simple-framebuffer 3e513000.framebuffer: fb0: simplefb registered!
[    0.329105] thermal_sys: Registered thermal governor 'fair_share'
[    0.329112] thermal_sys: Registered thermal governor 'bang_bang'
[    0.329126] thermal_sys: Registered thermal governor 'step_wise'
[    0.329136] thermal_sys: Registered thermal governor 'user_space'
[    0.329146] thermal_sys: Registered thermal governor 'power_allocator'
[    0.330022] NET: Registered protocol family 2
[    0.330984] tcp_listen_portaddr_hash hash table entries: 512 (order: 1, 8192 bytes, linear)
[    0.331047] TCP established hash table entries: 8192 (order: 4, 65536 bytes, linear)
[    0.331166] TCP bind hash table entries: 8192 (order: 5, 131072 bytes, linear)
[    0.331375] TCP: Hash tables configured (established 8192 bind 8192)
[    0.331650] UDP hash table entries: 512 (order: 2, 16384 bytes, linear)
[    0.331702] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes, linear)
[    0.332035] NET: Registered protocol family 1
[    0.332072] NET: Registered protocol family 44
[    0.332096] PCI: CLS 0 bytes, default 64
[    0.332458] Trying to unpack rootfs image as initramfs...
[    1.378972] Freeing initrd memory: 28836K
[    1.380898] hw perfevents: enabled with armv8_cortex_a53 PMU driver, 7 counters available
[    1.381102] kvm [1]: IPA Size Limit: 40bits
[    1.382500] kvm [1]: Hyp mode initialized successfully
[    1.387002] Initialise system trusted keyrings
[    1.387066] Key type blacklist registered
[    1.387445] workingset: timestamp_bits=46 max_order=18 bucket_order=0
[    1.398078] zbud: loaded
[    1.401076] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.402674] fuse: init (API version 7.31)
[    1.402822] *** VALIDATE fuse ***
[    1.402840] *** VALIDATE fuse ***
[    1.442720] Key type asymmetric registered
[    1.442740] Asymmetric key parser 'x509' registered
[    1.442862] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 242)
[    1.443271] io scheduler mq-deadline registered
[    1.448892] bcm2708_fb soc:fb: FB found 1 display(s)
[    1.468274] bcm2708_fb soc:fb: Registered framebuffer for display 0, size 1824x984
[    1.470592] raspberrypi-clk firmware-clocks: CPU frequency range: min 600000000, max 1400000000
[    1.556496] Serial: 8250/16550 driver, 1 ports, IRQ sharing enabled
[    1.559335] bcm2835-rng 3f104000.rng: hwrng registered
[    1.560029] vc-mem: phys_addr:0x00000000 mem_base=0x3ec00000 mem_size:0x40000000(1024 MiB)
[    1.561043] gpiomem-bcm2835 3f200000.gpiomem: Initialised: Registers at 0x3f200000
[    1.561452] cacheinfo: Unable to detect cache hierarchy for CPU 0
[    2.075477] loop: module loaded
[    2.079092] spi-bcm2835 3f204000.spi: could not get clk: -517
[    2.081685] libphy: Fixed MDIO Bus: probed
[    2.081738] tun: Universal TUN/TAP device driver, 1.6
[    2.082268] PPP generic driver version 2.4.2
[    2.082583] usbcore: registered new interface driver lan78xx
[    2.082660] usbcore: registered new interface driver smsc95xx
[    2.082704] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[    2.082736] ehci-pci: EHCI PCI platform driver
[    2.082806] ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
[    2.082829] ohci-pci: OHCI PCI platform driver
[    2.082895] uhci_hcd: USB Universal Host Controller Interface driver
[    2.083070] dwc_otg: version 3.00a 10-AUG-2012 (platform bus)
[    2.296973] Core Release: 2.80a
[    2.296988] Setting default values for core params
[    2.297019] Finished setting default values for core params
[    2.510643] Using Buffer DMA mode
[    2.510655] Periodic Transfer Interrupt Enhancement - disabled
[    2.510664] Multiprocessor Interrupt Enhancement - disabled
[    2.510677] OTG VER PARAM: 0, OTG VER FLAG: 0
[    2.510696] Dedicated Tx FIFOs mode
[    2.511598] WARN::dwc_otg_hcd_init:1072: FIQ DMA bounce buffers: virt = ffff8000105f6000 dma = 0x00000000f7510000 len=9024
[    2.511631] FIQ FSM acceleration enabled for :
               Non-periodic Split Transactions
               Periodic Split Transactions
               High-Speed Isochronous Endpoints
               Interrupt/Control Split Transaction hack enabled
[    2.511644] dwc_otg: Microframe scheduler enabled
[    2.511692] WARN::hcd_init_fiq:496: MPHI regs_base at ffff800010075000
[    2.511764] dwc_otg 3f980000.usb: DWC OTG Controller
[    2.511848] dwc_otg 3f980000.usb: new USB bus registered, assigned bus number 1
[    2.511901] dwc_otg 3f980000.usb: irq 9, io mem 0x00000000
[    2.511953] Init: Port Power? op_state=1
[    2.511963] Init: Power Port (0)
[    2.512356] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002, bcdDevice= 5.04
[    2.512372] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
[    2.512386] usb usb1: Product: DWC OTG Controller
[    2.512400] usb usb1: Manufacturer: Linux 5.4.0-1015-raspi dwc_otg_hcd
[    2.512413] usb usb1: SerialNumber: 3f980000.usb
[    2.513296] hub 1-0:1.0: USB hub found
[    2.513365] hub 1-0:1.0: 1 port detected
[    2.514366] dwc_otg: FIQ enabled
[    2.514377] dwc_otg: NAK holdoff enabled
[    2.514386] dwc_otg: FIQ split-transaction FSM enabled
[    2.514402] Module dwc_common_port init
[    2.515109] mousedev: PS/2 mouse device common for all mice
[    2.515718] i2c /dev entries driver
[    2.518763] bcm2835-wdt bcm2835-wdt: Broadcom BCM2835 watchdog timer
[    2.519067] device-mapper: uevent: version 1.0.3
[    2.519520] device-mapper: ioctl: 4.41.0-ioctl (2019-09-16) initialised: dm-devel@redhat.com
[    2.520997] cpufreq: cpufreq_online: CPU0: Running at unlisted freq: 600000 KHz
[    2.522326] cpufreq: cpufreq_online: CPU0: Unlisted initial frequency changed to: 700000 KHz
[    2.524383] sdhci: Secure Digital Host Controller Interface driver
[    2.524393] sdhci: Copyright(c) Pierre Ossman
[    2.525029] mmc-bcm2835 3f300000.mmcnr: could not get clk, deferring probe
[    2.525700] sdhost-bcm2835 3f202000.mmc: could not get clk, deferring probe
[    2.525926] sdhci-pltfm: SDHCI platform and OF driver helper
[    2.529004] ledtrig-cpu: registered to indicate activity on CPUs
[    2.529190] hidraw: raw HID events driver (C) Jiri Kosina
[    2.530608] vchiq: vchiq_init_state: slot_zero = (____ptrval____)
[    2.535891] drop_monitor: Initializing network drop monitor service
[    2.537232] NET: Registered protocol family 10
[    2.606018] Segment Routing with IPv6
[    2.606097] NET: Registered protocol family 17
[    2.606296] Key type dns_resolver registered
[    2.606930] registered taskstats version 1
[    2.606971] Loading compiled-in X.509 certificates
[    2.615324] Loaded X.509 cert 'Build time autogenerated kernel key: 3adb930cf2b588b24a16b9e880af77294eec0e1a'
[    2.615713] Key type ._fscrypt registered
[    2.615720] Key type .fscrypt registered
[    2.640941] cryptd: max_cpu_qlen set to 1000
[    2.721869] Indeed it is in host mode hprt0 = 00021501
[    2.800492] random: fast init done
[    2.913659] usb 1-1: new high-speed USB device number 2 using dwc_otg
[    2.913882] Indeed it is in host mode hprt0 = 00001101
[    2.948493] Key type big_key registered
[    3.054864] Key type encrypted registered
[    3.054908] AppArmor: AppArmor sha1 policy hashing enabled
[    3.054959] ima: No TPM chip found, activating TPM-bypass!
[    3.055008] ima: Allocated hash algorithm: sha1
[    3.055074] ima: No architecture policies found
[    3.055152] evm: Initialising EVM extended attributes:
[    3.055161] evm: security.selinux
[    3.055171] evm: security.SMACK64
[    3.055180] evm: security.SMACK64EXEC
[    3.055189] evm: security.SMACK64TRANSMUTE
[    3.055198] evm: security.SMACK64MMAP
[    3.055207] evm: security.apparmor
[    3.055217] evm: security.ima
[    3.055225] evm: security.capability
[    3.055235] evm: HMAC attrs: 0x1
[    3.070314] uart-pl011 3f201000.serial: cts_event_workaround enabled
[    3.070468] 3f201000.serial: ttyAMA0 at MMIO 0x3f201000 (irq = 66, base_baud = 0) is a PL011 rev2
[    3.076348] printk: console [ttyAMA0] enabled
[    3.081609] 3f215040.serial: ttyS0 at MMIO 0x0 (irq = 61, base_baud = 50000000) is a 16550
[    3.082710] bcm2835-power bcm2835-power: Broadcom BCM2835 power domains driver
[    3.089098] mmc-bcm2835 3f300000.mmcnr: mmc_debug:0 mmc_debug2:0
[    3.089117] mmc-bcm2835 3f300000.mmcnr: DMA channel allocated
[    3.115514] sdhost: log_buf @ (____ptrval____) (ebd38000)
[    3.138484] usb 1-1: New USB device found, idVendor=0424, idProduct=2514, bcdDevice= b.b3
[    3.138501] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[    3.139423] hub 1-1:1.0: USB hub found
[    3.139585] hub 1-1:1.0: 4 ports detected
[    3.154588] mmc1: queuing unknown CIS tuple 0x80 (2 bytes)
[    3.156280] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    3.157961] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    3.160948] mmc1: queuing unknown CIS tuple 0x80 (7 bytes)
[    3.167550] mmc0: sdhost-bcm2835 loaded - DMA enabled (>1)
[    3.170628] hctosys: unable to open rtc device (rtc0)
[    3.171340] of_cfs_init
[    3.171504] of_cfs_init: OK
[    3.208152] Freeing unused kernel memory: 6144K
[    3.226264] Checked W+X mappings: passed, no W+X pages found
[    3.226286] Run /init as init process
[    3.230254] mmc0: host does not support reading read-only switch, assuming write-enable
[    3.233343] mmc0: new high speed SDXC card at address 5048
[    3.236559] mmcblk0: mmc0:5048 SD64G 58.2 GiB
[    3.241905]  mmcblk0: p1 p2
[    3.251456] mmc1: new high speed SDIO card at address 0001
[    3.394817] random: systemd-udevd: uninitialized urandom read (16 bytes read)
[    3.403359] random: systemd-udevd: uninitialized urandom read (16 bytes read)
[    3.403437] random: systemd-udevd: uninitialized urandom read (16 bytes read)
[    3.425734] usb 1-1.1: new high-speed USB device number 3 using dwc_otg
[    3.526158] usb 1-1.1: New USB device found, idVendor=0424, idProduct=2514, bcdDevice= b.b3
[    3.526181] usb 1-1.1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[    3.527365] hub 1-1.1:1.0: USB hub found
[    3.527524] hub 1-1.1:1.0: 3 ports detected
[    3.761645] usb 1-1.2: new high-speed USB device number 4 using dwc_otg
[    3.862355] usb 1-1.2: New USB device found, idVendor=214b, idProduct=7250, bcdDevice= 1.00
[    3.862376] usb 1-1.2: New USB device strings: Mfr=0, Product=1, SerialNumber=0
[    3.862391] usb 1-1.2: Product: USB2.0 HUB
[    3.863513] hub 1-1.2:1.0: USB hub found
[    3.863683] hub 1-1.2:1.0: 4 ports detected
[    3.968215] random: crng init done
[    3.968229] random: 7 urandom warning(s) missed due to ratelimiting
[    4.149652] usb 1-1.2.1: new high-speed USB device number 5 using dwc_otg
[    4.251348] usb 1-1.2.1: New USB device found, idVendor=0bda, idProduct=8152, bcdDevice=20.00
[    4.251370] usb 1-1.2.1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[    4.251385] usb 1-1.2.1: Product: USB 10/100 LAN
[    4.251400] usb 1-1.2.1: Manufacturer: Realtek
[    4.251414] usb 1-1.2.1: SerialNumber: 00E04C3603B4
[    4.329685] usb 1-1.1.1: new high-speed USB device number 6 using dwc_otg
[    4.430387] usb 1-1.1.1: New USB device found, idVendor=0424, idProduct=7800, bcdDevice= 3.00
[    4.430410] usb 1-1.1.1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[    4.697441] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): No External EEPROM. Setting MAC Speed
[    4.699201] libphy: lan78xx-mdiobus: probed
[    4.722086] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): int urb period 64
[    5.118464] usb_phy_generic phy: phy supply vcc not found, using dummy regulator
[    9.053578] raid6: neonx8   gen()   722 MB/s
[    9.101597] raid6: neonx8   xor()   690 MB/s
[    9.149625] raid6: neonx4   gen()   709 MB/s
[    9.197583] raid6: neonx4   xor()   685 MB/s
[    9.245595] raid6: neonx2   gen()   518 MB/s
[    9.293608] raid6: neonx2   xor()   535 MB/s
[    9.341602] raid6: neonx1   gen()   313 MB/s
[    9.389635] raid6: neonx1   xor()   340 MB/s
[    9.437574] raid6: int64x8  gen()   548 MB/s
[    9.485610] raid6: int64x8  xor()   362 MB/s
[    9.533656] raid6: int64x4  gen()   462 MB/s
[    9.581652] raid6: int64x4  xor()   340 MB/s
[    9.629736] raid6: int64x2  gen()   294 MB/s
[    9.677580] raid6: int64x2  xor()   250 MB/s
[    9.725749] raid6: int64x1  gen()   175 MB/s
[    9.773586] raid6: int64x1  xor()   162 MB/s
[    9.773596] raid6: using algorithm neonx8 gen() 722 MB/s
[    9.773606] raid6: .... xor() 690 MB/s, rmw enabled
[    9.773617] raid6: using neon recovery algorithm
[    9.788230] xor: measuring software checksum speed
[    9.825579]    8regs     :  1164.000 MB/sec
[    9.865570]    32regs    :  1336.000 MB/sec
[    9.905571]    arm64_neon:  1154.000 MB/sec
[    9.905583] xor: using function: 32regs (1336.000 MB/sec)
[    9.912987] async_tx: api initialized (async)
[   10.062633] uart-pl011 3f201000.serial: no DMA platform data
[   10.432703] Btrfs loaded, crc32c=crc32c-generic
[   10.820526] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)
[   12.183534] systemd[1]: System time before build time, advancing clock.
[   12.261314] systemd[1]: Inserted module 'autofs4'
[   12.435956] systemd[1]: systemd 245.4-4ubuntu3.2 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRY)
[   12.438138] systemd[1]: Detected architecture arm64.
[   12.610732] systemd[1]: Set hostname to <ubuntu>.
[   12.611936] systemd[1]: Initializing machine ID from random generator.
[   12.612333] systemd[1]: Installed transient /etc/machine-id file.
[   14.000655] systemd[1]: /lib/systemd/system/dbus.socket:5: ListenStream= references a path below legacy directory /var/run/, updating /var/r.
[   14.452929] systemd[1]: Created slice system-modprobe.slice.
[   14.455816] systemd[1]: Created slice system-serial\x2dgetty.slice.
[   14.458069] systemd[1]: Created slice system-systemd\x2dfsck.slice.
[   14.459866] systemd[1]: Created slice User and Session Slice.
[   14.460685] systemd[1]: Started Forward Password Requests to Wall Directory Watch.
[   14.478248] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.
[   14.478872] systemd[1]: Reached target User and Group Name Lookups.
[   14.479051] systemd[1]: Reached target Slices.
[   14.479206] systemd[1]: Reached target Swap.
[   14.480209] systemd[1]: Listening on Device-mapper event daemon FIFOs.
[   14.481341] systemd[1]: Listening on LVM2 poll daemon socket.
[   14.482158] systemd[1]: Listening on multipathd control socket.
[   14.483165] systemd[1]: Listening on Syslog Socket.
[   14.484125] systemd[1]: Listening on fsck to fsckd communication Socket.
[   14.484710] systemd[1]: Listening on initctl Compatibility Named Pipe.
[   14.486764] systemd[1]: Listening on Journal Audit Socket.
[   14.487886] systemd[1]: Listening on Journal Socket (/dev/log).
[   14.489257] systemd[1]: Listening on Journal Socket.
[   14.490934] systemd[1]: Listening on Network Service Netlink Socket.
[   14.492064] systemd[1]: Listening on udev Control Socket.
[   14.492899] systemd[1]: Listening on udev Kernel Socket.
[   14.494128] systemd[1]: Condition check resulted in Huge Pages File System being skipped.
[   14.503724] systemd[1]: Mounting POSIX Message Queue File System...
[   14.515218] systemd[1]: Mounting Kernel Debug File System...
[   14.527339] systemd[1]: Mounting Kernel Trace File System...
[   14.542363] systemd[1]: Starting Journal Service...
[   14.553428] systemd[1]: Starting Set the console keyboard layout...
[   14.565065] systemd[1]: Starting Create list of static device nodes for the current kernel...
[   14.577044] systemd[1]: Starting Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling...
[   14.590422] systemd[1]: Starting Load Kernel Module drm...
[   14.595104] systemd[1]: Condition check resulted in Set Up Additional Binary Formats being skipped.
[   14.611843] systemd[1]: Starting Load Kernel Modules...
[   14.623516] systemd[1]: Starting Remount Root and Kernel File Systems...
[   14.636423] systemd[1]: Starting udev Coldplug all Devices...
[   14.659646] systemd[1]: Starting Uncomplicated firewall...
[   14.691981] systemd[1]: Mounted POSIX Message Queue File System.
[   14.699810] systemd[1]: Mounted Kernel Debug File System.
[   14.702881] systemd[1]: Mounted Kernel Trace File System.
[   14.710649] systemd[1]: Finished Create list of static device nodes for the current kernel.
[   14.735134] EXT4-fs (mmcblk0p2): re-mounted. Opts: (null)
[   14.774544] systemd[1]: Finished Load Kernel Modules.
[   14.788634] systemd[1]: Finished Remount Root and Kernel File Systems.
[   14.797202] systemd[1]: Finished Uncomplicated firewall.
[   14.804560] systemd[1]: modprobe@drm.service: Succeeded.
[   14.809244] systemd[1]: Finished Load Kernel Module drm.
[   14.824824] systemd[1]: Mounting FUSE Control File System...
[   14.862218] systemd[1]: Mounting Kernel Configuration File System...
[   14.867566] systemd[1]: Condition check resulted in Rebuild Hardware Database being skipped.
[   14.868171] systemd[1]: Condition check resulted in Platform Persistent Storage Archival being skipped.
[   14.894956] systemd[1]: Starting Load/Save Random Seed...
[   14.931144] systemd[1]: Starting Apply Kernel Variables...
[   14.955439] systemd[1]: Starting Create System Users...
[   14.974058] systemd[1]: Mounted FUSE Control File System.
[   14.976534] systemd[1]: Mounted Kernel Configuration File System.
[   15.003627] systemd[1]: Finished Load/Save Random Seed.
[   15.095931] systemd[1]: Finished Apply Kernel Variables.
[   15.149796] systemd[1]: Started Journal Service.
[   15.237001] systemd-journald[702]: Received client request to flush runtime journal.
[   16.877675] vc_sm_cma: module is from the staging directory, the quality is unknown, you have been warned.
[   16.879156] vc_sm_cma: module verification failed: signature and/or required key missing - tainting kernel
[   16.881833] bcm2835_vc_sm_cma_probe: Videocore shared memory driver
[   16.881858] [vc_sm_connected_init]: start
[   16.890942] [vc_sm_connected_init]: installed successfully
[   16.927634] mc: Linux media interface: v0.10
[   17.016274] videodev: Linux video capture interface: v2.00
[   17.094530] snd_bcm2835: module is from the staging directory, the quality is unknown, you have been warned.
[   17.105655] bcm2835_audio bcm2835_audio: card created with 4 channels
[   17.120526] bcm2835_audio bcm2835_audio: card created with 4 channels
[   17.168733] bcm2835_mmal_vchiq: module is from the staging directory, the quality is unknown, you have been warned.
[   17.168738] bcm2835_mmal_vchiq: module is from the staging directory, the quality is unknown, you have been warned.
[   17.207611] bcm2835_v4l2: module is from the staging directory, the quality is unknown, you have been warned.
[   17.209252] bcm2835_isp: module is from the staging directory, the quality is unknown, you have been warned.
[   17.222740] bcm2835-isp bcm2835-isp: Device node output[0] registered as /dev/video13
[   17.223384] bcm2835-isp bcm2835-isp: Device node capture[0] registered as /dev/video14
[   17.223898] bcm2835-isp bcm2835-isp: Device node capture[1] registered as /dev/video15
[   17.224326] bcm2835-isp bcm2835-isp: Device node stats[2] registered as /dev/video16
[   17.224367] bcm2835-isp bcm2835-isp: Register output node 0 with media controller
[   17.224414] bcm2835-isp bcm2835-isp: Register capture node 1 with media controller
[   17.224435] bcm2835-isp bcm2835-isp: Register capture node 2 with media controller
[   17.224453] bcm2835-isp bcm2835-isp: Register capture node 3 with media controller
[   17.224716] bcm2835-isp bcm2835-isp: Loaded V4L2 bcm2835-isp
[   17.238551] bcm2835_codec: module is from the staging directory, the quality is unknown, you have been warned.
[   17.252985] bcm2835-codec bcm2835-codec: Device registered as /dev/video10
[   17.253073] bcm2835-codec bcm2835-codec: Loaded V4L2 decode
[   17.261328] bcm2835-codec bcm2835-codec: Device registered as /dev/video11
[   17.261411] bcm2835-codec bcm2835-codec: Loaded V4L2 encode
[   17.269340] bcm2835-codec bcm2835-codec: Device registered as /dev/video12
[   17.269398] bcm2835-codec bcm2835-codec: Loaded V4L2 isp
[   17.358612] usbcore: registered new interface driver r8152
[   17.463917] cfg80211: Loading compiled-in X.509 certificates for regulatory database
[   17.464029] usbcore: registered new interface driver cdc_ether
[   17.465794] usb 1-1.2.1: reset high-speed USB device number 5 using dwc_otg
[   17.494112] cfg80211: Loaded X.509 cert 'sforshee: 00b28ddf47aef9cea7'
[   17.627952] r8152 1-1.2.1:1.0 eth1: v1.10.11
[   17.686213] brcmfmac: F1 signature read @0x18000000=0x15264345
[   17.699959] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   17.712716] usbcore: registered new interface driver brcmfmac
[   18.083763] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   18.116917] Bluetooth: Core ver 2.22
[   18.121182] NET: Registered protocol family 31
[   18.121208] Bluetooth: HCI device and connection manager initialized
[   18.121272] Bluetooth: HCI socket layer initialized
[   18.121295] Bluetooth: L2CAP socket layer initialized
[   18.121361] Bluetooth: SCO socket layer initialized
[   18.134898] brcmfmac: brcmf_c_preinit_dcmds: Firmware: BCM4345/6 wl0: Mar  2 2020 23:30:41 version 7.45.202 (r724630 CY) FWID 01-72f6ece2
[   19.197787] Under-voltage detected! (0x00050005)
[   21.729959] alua: device handler registered
[   21.740622] emc: device handler registered
[   21.752384] rdac: device handler registered
[   43.106274] EXT4-fs (mmcblk0p2): resizing filesystem from 727862 to 15195899 blocks
[   43.903500] EXT4-fs (mmcblk0p2): resized filesystem to 15195899
```

### First login

The default passwords for the images are **ubuntu/ubuntu**.

```shell
Ubuntu 20.04.1 LTS ubuntu ttyAMA0

ubuntu login: ubuntu
Password:
You are required to change your password immediately (administrator enforced)
Changing password for ubuntu.
Current password:
New password:
Retype new password:
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-1015-raspi aarch64)
```

### UART

```shell
$ dmesg | grep -E "pl11|8250|uart|tty"
[    0.000000] earlycon: pl11 at MMIO32 0x000000003f201000 (options '')
[    0.000000] printk: bootconsole [pl11] enabled
[    0.000000] Kernel command line:  coherent_pool=1M 8250.nr_uarts=1 snd_bcm2835.enable_compat_alsa=0 snd_bcm2835.enabh
[    0.000295] printk: console [tty1] enabled
[    0.000309] printk: bootconsole [pl11] disabled
[    1.568625] Serial: 8250/16550 driver, 1 ports, IRQ sharing enabled
[    2.824711] uart-pl011 3f201000.serial: cts_event_workaround enabled
[    2.824870] 3f201000.serial: ttyAMA0 at MMIO 0x3f201000 (irq = 66, base_baud = 0) is a PL011 rev2
[    2.837279] printk: console [ttyAMA0] enabled
[    2.842675] 3f215040.serial: ttyS0 at MMIO 0x0 (irq = 61, base_baud = 50000000) is a 16550
[    9.413998] uart-pl011 3f201000.serial: no DMA platform data
[   13.224799] systemd[1]: Created slice system-serial\x2dgetty.slice.
```

### Setup ssh daemon

```shell
$ sudo vi /etc/ssh/sshd_config
    PermitRootLogin yes
    #PermitRootLogin prohibit-password

$ sudo /etc/init.d/ssh reload
Reloading ssh configuration (via systemctl): ssh.service.

$ sudo vi /etc/pam.d/sshd
   # session    optional   pam_motd.so motd=/run/motd.dynamic

$ sudo vi /etc/pam.d/login
   # session    optional     pam_motd.so  motd=/run/motd.dynamic
```

## System characteristics

### Dimension

![Raspberry Pi 3 B+ dimension](rpi_machine_3bplus.svg)

### uname

```shell
$ uname -snrmp
Linux ubuntu 5.4.0-1022-raspi aarch64 aarch64

$ uname -a
Linux ubuntu 5.4.0-1022-raspi #25-Ubuntu SMP PREEMPT Thu Oct 15 13:31:49 UTC 2020 aarch64 aarch64 aarch64 GNU/Linux
```

### /etc/os-release

```shell
$ ls -l /etc/os-release
lrwxrwxrwx 1 root root 21 Aug 17 13:31 /etc/os-release -> ../usr/lib/os-release

$ cat /usr/lib/os-release
NAME="Ubuntu"
VERSION="20.04.1 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.1 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal

$ file /bin/cat
/bin/cat: ELF 64-bit LSB shared object, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID[sha1]=4fdc558fb1da46e60411d3c23414c4bf99b1265f, for GNU/Linux 3.7.0, stripped

$ ldd /bin/cat
	linux-vdso.so.1 (0x0000ffff82004000)
	libc.so.6 => /lib/aarch64-linux-gnu/libc.so.6 (0x0000ffff81e4a000)
	/lib/ld-linux-aarch64.so.1 (0x0000ffff81fd4000)
```

### ps

```shell
$ ps axf
    PID TTY      STAT   TIME COMMAND
      2 ?        S      0:00 [kthreadd]
      3 ?        I<     0:00  \_ [rcu_gp]
      4 ?        I<     0:00  \_ [rcu_par_gp]
      8 ?        I<     0:00  \_ [mm_percpu_wq]
      9 ?        S      0:00  \_ [ksoftirqd/0]
     10 ?        I      0:01  \_ [rcu_sched]
     11 ?        S      0:00  \_ [migration/0]
     12 ?        S      0:00  \_ [idle_inject/0]
     14 ?        S      0:00  \_ [cpuhp/0]
     15 ?        S      0:00  \_ [cpuhp/1]
     16 ?        S      0:00  \_ [idle_inject/1]
     17 ?        S      0:00  \_ [migration/1]
     18 ?        S      0:00  \_ [ksoftirqd/1]
     21 ?        S      0:00  \_ [cpuhp/2]
     22 ?        S      0:00  \_ [idle_inject/2]
     23 ?        S      0:00  \_ [migration/2]
     24 ?        S      0:00  \_ [ksoftirqd/2]
     25 ?        I      0:00  \_ [kworker/2:0-events]
     27 ?        S      0:00  \_ [cpuhp/3]
     28 ?        S      0:00  \_ [idle_inject/3]
     29 ?        S      0:00  \_ [migration/3]
     30 ?        S      0:00  \_ [ksoftirqd/3]
     33 ?        S      0:00  \_ [kdevtmpfs]
     34 ?        I<     0:00  \_ [netns]
     35 ?        S      0:00  \_ [rcu_tasks_kthre]
     37 ?        I      0:00  \_ [kworker/1:1-events]
     39 ?        S      0:00  \_ [kauditd]
     40 ?        S      0:00  \_ [khungtaskd]
     41 ?        S      0:00  \_ [oom_reaper]
     42 ?        I<     0:00  \_ [writeback]
     43 ?        S      0:00  \_ [kcompactd0]
     44 ?        SN     0:00  \_ [ksmd]
     46 ?        I      0:00  \_ [kworker/u8:1-events_power_efficient]
    138 ?        I<     0:00  \_ [kintegrityd]
    139 ?        I<     0:00  \_ [kblockd]
    140 ?        I<     0:00  \_ [blkcg_punt_bio]
    141 ?        I<     0:00  \_ [tpm_dev_wq]
    142 ?        I<     0:00  \_ [ata_sff]
    143 ?        I<     0:00  \_ [md]
    144 ?        I<     0:00  \_ [edac-poller]
    145 ?        I<     0:00  \_ [devfreq_wq]
    146 ?        S      0:00  \_ [watchdogd]
    147 ?        S      0:00  \_ [kswapd0]
    148 ?        S      0:00  \_ [ecryptfs-kthrea]
    151 ?        I<     0:00  \_ [kthrotld]
    152 ?        I<     0:00  \_ [dwc_otg]
    153 ?        I<     0:00  \_ [DWC Notificatio]
    154 ?        I      0:00  \_ [kworker/0:2-events]
    155 ?        S<     0:00  \_ [vchiq-slot/0]
    156 ?        S<     0:00  \_ [vchiq-recy/0]
    157 ?        S<     0:00  \_ [vchiq-sync/0]
    158 ?        I<     0:00  \_ [ipv6_addrconf]
    170 ?        I<     0:00  \_ [kstrp]
    174 ?        I<     0:00  \_ [kworker/u9:0]
    179 ?        I<     0:00  \_ [cryptd]
    180 ?        I      0:00  \_ [kworker/3:2-mm_percpu_wq]
    242 ?        S      0:00  \_ [spi0]
    244 ?        I<     0:00  \_ [charger_manager]
    247 ?        I<     0:00  \_ [mmc_complete]
    250 ?        I<     0:00  \_ [kworker/2:1H-mmc_complete]
    276 ?        S      0:00  \_ [irq/151-usb-001]
    282 ?        I<     0:00  \_ [kworker/3:1H-mmc_complete]
    284 ?        I<     0:01  \_ [kworker/1:1H-mmc_complete]
    290 ?        I<     0:00  \_ [kworker/0:2H-mmc_complete]
    570 ?        I<     0:00  \_ [raid5wq]
    627 ?        S      0:00  \_ [jbd2/mmcblk0p2-]
    628 ?        I<     0:00  \_ [ext4-rsv-conver]
    744 ?        S      0:00  \_ [vchiq-keep/0]
    745 ?        S<     0:00  \_ [SMIO]
    749 ?        I<     0:00  \_ [mmal-vchiq]
    750 ?        I<     0:00  \_ [mmal-vchiq]
    751 ?        I<     0:00  \_ [mmal-vchiq]
    752 ?        I<     0:00  \_ [mmal-vchiq]
    758 ?        I<     0:00  \_ [cfg80211]
    760 ?        I<     0:00  \_ [brcmf_wq/mmc1:0]
    761 ?        S      0:00  \_ [brcmf_wdog/mmc1]
   1071 ?        I<     0:00  \_ [kaluad]
   1072 ?        I<     0:00  \_ [kmpath_rdacd]
   1073 ?        I<     0:00  \_ [kmpathd]
   1074 ?        I<     0:00  \_ [kmpath_handlerd]
   1541 ?        S<     0:00  \_ [loop0]
   1961 ?        S<     0:00  \_ [loop1]
   2043 ?        S<     0:00  \_ [loop2]
   2580 ?        I<     0:00  \_ [kworker/2:0H]
   2694 ?        I      0:00  \_ [kworker/0:1-events]
   2701 ?        I      0:00  \_ [kworker/2:2-events]
   2705 ?        I      0:00  \_ [kworker/3:0-events]
   2739 ?        I<     0:00  \_ [kworker/1:0H]
   2740 ?        I<     0:00  \_ [kworker/3:2H]
   2741 ?        I<     0:00  \_ [kworker/0:1H]
   2743 ?        I      0:00  \_ [kworker/1:2-mm_percpu_wq]
   2753 ?        I      0:00  \_ [kworker/u8:0-events_power_efficient]
   2754 ?        I      0:00  \_ [kworker/0:0-events]
   2755 ?        I      0:00  \_ [kworker/3:1-mm_percpu_wq]
   2758 ?        I      0:00  \_ [kworker/2:1-events_freezable]
   2761 ?        I<     0:00  \_ [kworker/3:0H]
   2762 ?        I      0:00  \_ [kworker/2:3-events]
   2778 ?        I<     0:00  \_ [kworker/2:2H]
   2779 ?        I<     0:00  \_ [kworker/1:2H]
   2781 ?        I      0:00  \_ [kworker/1:0-events]
   2795 ?        I      0:00  \_ [kworker/u8:2-events_unbound]
      1 ?        Ss     0:25 /sbin/init fixrtc splash
    702 ?        S<s    0:01 /lib/systemd/systemd-journald
    729 ?        Ss     0:04 /lib/systemd/systemd-udevd
   1075 ?        SLsl   0:01 /sbin/multipathd -d -s
   1100 ?        Ssl    0:01 /lib/systemd/systemd-timesyncd
   1137 ?        Ss     0:00 /lib/systemd/systemd-networkd
   1139 ?        Ss     0:01 /lib/systemd/systemd-resolved
   1226 ?        Ssl    0:00 /usr/lib/accountsservice/accounts-daemon
   1227 ?        Ss     0:03 /usr/bin/dbus-daemon --system --address=systemd: --
   1230 ?        Ssl    0:00 /usr/sbin/irqbalance --foreground
   1232 ?        Ss     0:01 /usr/bin/python3 /usr/bin/networkd-dispatcher --run
   1235 ?        Ssl    0:00 /usr/sbin/rsyslogd -n -iNONE
   1238 ?        Ss     0:01 /lib/systemd/systemd-logind
   1239 ?        Ss     0:00 /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant
   1272 ?        Ss     0:00 /usr/sbin/cron -f
   1276 ?        Ssl    0:00 /usr/bin/python3 /usr/share/unattended-upgrades/una
   1278 ?        Ss     0:00 /usr/sbin/atd -f
   1304 tty1     Ss+    0:00 /sbin/agetty -o -p -- \u --noclear tty1 linux
   1310 ?        Ssl    0:00 /usr/lib/policykit-1/polkitd --no-debug
   1826 ?        Ssl    0:19 /usr/lib/snapd/snapd
   2553 ?        Ss     0:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 star
   2583 ?        Ss     0:00 /bin/login -p --
   2682 ttyAMA0  S      0:00  \_ -bash
   2797 ttyAMA0  R+     0:00      \_ ps axf
   2676 ?        Ss     0:02 /lib/systemd/systemd --user
   2677 ?        S      0:00  \_ (sd-pam)
```

### cpu

```shell
$ dmesg | grep -i cpu
[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd034]
[    0.000000] percpu: Embedded 32 pages/cpu s92120 r8192 d30760 u131072
[    0.000000] pcpu-alloc: s92120 r8192 d30760 u131072 alloc=32*4096
[    0.000000] pcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3
[    0.000000] Detected VIPT I-cache on CPU0
[    0.000000] CPU features: detected: ARM erratum 845719
[    0.000000] CPU features: kernel page table isolation forced ON by KASLR
[    0.000000] CPU features: detected: Kernel page table isolation (KPTI)
[    0.000000] CPU features: detected: ARM erratum 843419
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[    0.009272] smp: Bringing up secondary CPUs ...
[    0.010604] Detected VIPT I-cache on CPU1
[    0.010670] CPU1: Booted secondary processor 0x0000000001 [0x410fd034]
[    0.012701] Detected VIPT I-cache on CPU2
[    0.012757] CPU2: Booted secondary processor 0x0000000002 [0x410fd034]
[    0.014581] Detected VIPT I-cache on CPU3
[    0.014630] CPU3: Booted secondary processor 0x0000000003 [0x410fd034]
[    0.015156] smp: Brought up 1 node, 4 CPUs
[    0.015187] CPU features: detected: 32-bit EL0 Support
[    0.015202] CPU features: detected: CRC32 instructions
[    0.021521] CPU features: emulated: Privileged Access Never (PAN) using TTBR0_EL1 switching
[    0.021534] CPU: All CPU(s) started at EL2
[    0.057412] cpuidle: using governor ladder
[    0.057471] cpuidle: using governor menu
[    1.574435] cacheinfo: Unable to detect cache hierarchy for CPU 0
[    2.549153] cpufreq: cpufreq_online: CPU0: Running at unlisted freq: 600000 KHz
[    2.550545] cpufreq: cpufreq_online: CPU0: Unlisted initial frequency changed to: 700000 KHz
[    2.555778] ledtrig-cpu: registered to indicate activity on CPUs
[    2.660713] cryptd: max_cpu_qlen set to 1000
```

### memory

```shell
$ free -m
              total        used        free      shared  buff/cache   available
Mem:            908         259          14           3         635         624
Swap:             0           0           0

$ cat /proc/meminfo
MemTotal:         929988 kB
MemFree:           15444 kB
MemAvailable:     640460 kB
Buffers:          103424 kB
Cached:           492644 kB
SwapCached:            0 kB
Active:           499704 kB
Inactive:         217952 kB
Active(anon):     131608 kB
Inactive(anon):      240 kB
Active(file):     368096 kB
Inactive(file):   217712 kB
Unevictable:       17112 kB
Mlocked:           17112 kB
SwapTotal:             0 kB
SwapFree:              0 kB
Dirty:               744 kB
Writeback:             0 kB
AnonPages:        138700 kB
Mapped:           102852 kB
Shmem:              3980 kB
KReclaimable:      54348 kB
Slab:             106228 kB
SReclaimable:      54348 kB
SUnreclaim:        51880 kB
KernelStack:        2864 kB
PageTables:         2328 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:      464992 kB
Committed_AS:     557560 kB
VmallocTotal:   135290159040 kB
VmallocUsed:       11264 kB
VmallocChunk:          0 kB
Percpu:             2336 kB
CmaTotal:          65536 kB
CmaFree:            7416 kB
```

### disk

#### mmc

```shell
$ dmesg | grep mmc
[    2.553509] mmc-bcm2835 3f300000.mmcnr: could not get clk, deferring probe
[    2.553816] sdhost-bcm2835 3f202000.mmc: could not get clk, deferring probe
[    2.850835] mmc-bcm2835 3f300000.mmcnr: mmc_debug:0 mmc_debug2:0
[    2.850856] mmc-bcm2835 3f300000.mmcnr: DMA channel allocated
[    2.893770] mmc1: queuing unknown CIS tuple 0x80 (2 bytes)
[    2.895411] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    2.897064] mmc1: queuing unknown CIS tuple 0x80 (3 bytes)
[    2.900087] mmc1: queuing unknown CIS tuple 0x80 (7 bytes)
[    2.925168] mmc0: sdhost-bcm2835 loaded - DMA enabled (>1)
[    2.988888] mmc0: host does not support reading read-only switch, assuming write-enable
[    2.992217] mmc0: new high speed SDXC card at address 5048
[    2.992857] mmc1: new high speed SDIO card at address 0001
[    2.994317] mmcblk0: mmc0:5048 SD64G 58.2 GiB
[    3.000050]  mmcblk0: p1 p2
```

#### blkid

```shell
$ blkid
/dev/mmcblk0p1: LABEL_FATBOOT="system-boot" LABEL="system-boot" UUID="B726-57E2" TYPE="vfat" PARTUUID="ab86aefd-01"
/dev/mmcblk0p2: LABEL="writable" UUID="483efb12-d682-4daf-9b34-6e2f774b56f7" TYPE="ext4" PARTUUID="ab86aefd-02"
```

#### parted

```shell
$ sudo partprobe /dev/mmcblk0

$ sudo partx -uv /dev/mmcblk0
partition: none, disk: /dev/mmcblk0, lower: 0, upper: 0
/dev/mmcblk0: partition table type 'dos' detected
/dev/mmcblk0: partition #1 resized
/dev/mmcblk0: partition #2 resized

$ sudo parted /dev/mmcblk0 print
Model: SD SD64G (sd/mmc)
Disk /dev/mmcblk0: 62.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  269MB   268MB   primary  fat32        boot, lba
 2      269MB   62.5GB  62.2GB  primary  ext4
```

#### gdisk

```shell
$ sudo gdisk -l /dev/mmcblk0
GPT fdisk (gdisk) version 1.0.5

Partition table scan:
  MBR: MBR only
  BSD: not present
  APM: not present
  GPT: not present


***************************************************************
Found invalid GPT and valid MBR; converting MBR to GPT format
in memory.
***************************************************************

Disk /dev/mmcblk0: 122093568 sectors, 58.2 GiB
Sector size (logical/physical): 512/512 bytes
Disk identifier (GUID): A6CB8BCB-E18E-4A59-989E-0F8B76C7B445
Partition table holds up to 128 entries
Main partition table begins at sector 2 and ends at sector 33
First usable sector is 34, last usable sector is 122093534
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          526335   256.0 MiB   0700  Microsoft basic data
   2          526336       122093534   58.0 GiB    8300  Linux filesystem
```

#### fdisk

```shell
$ sudo fdisk -l /dev/mmcblk0
Disk /dev/mmcblk0: 58.22 GiB, 62511906816 bytes, 122093568 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xab86aefd

Device         Boot  Start       End   Sectors  Size Id Type
/dev/mmcblk0p1 *      2048    526335    524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2      526336 122093534 121567199   58G 83 Linux
```

#### mounts

```shell
$ mount | grep ^/dev
/dev/mmcblk0p2 on / type ext4 (rw,relatime)
/dev/mmcblk0p1 on /boot/firmware type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,errors=remount-ro)
```

#### df

```shell
$ df -m | grep ^/dev/mmc
/dev/mmcblk0p2     58394  2741     53239   5% /
/dev/mmcblk0p1       253    96       157  38% /boot/firmware
```

### network

#### devices

```shell
$ ls /sys/class/net/
eth0  eth1  lo  wlan0

$ ip link show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether b8:27:eb:66:13:38 brd ff:ff:ff:ff:ff:ff
3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DORMANT group default qlen 1000
    link/ether b8:27:eb:33:46:6d brd ff:ff:ff:ff:ff:ff
4: eth1: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000
    link/ether 00:e0:4c:36:03:b4 brd ff:ff:ff:ff:ff:ff

$ dmesg | grep -Ei "eth0|lan78"
[    2.110395] usbcore: registered new interface driver lan78xx
[    4.717191] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): No External EEPROM. Setting MAC Speed
[    4.719093] libphy: lan78xx-mdiobus: probed
[    4.743714] lan78xx 1-1.1.1:1.0 (unnamed net_device) (uninitialized): int urb period 64
[   27.317171] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready

$ dmesg | grep -Ei "eth1|r8152"
[ 1426.559659] usbcore: registered new interface driver r8152
[ 1426.804617] r8152 1-1.3.1:1.0 eth1: v1.10.11
[ 3748.647273] IPv6: ADDRCONF(NETDEV_CHANGE): eth1: link becomes ready
[ 3748.648626] r8152 1-1.3.1:1.0 eth1: carrier on

$ dmesg | grep -Ei "wlan0|brcmfmac"
[   15.450206] brcmfmac: F1 signature read @0x18000000=0x15264345
[   15.464369] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   15.475205] usbcore: registered new interface driver brcmfmac
[   15.802092] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[   15.831133] brcmfmac: brcmf_c_preinit_dcmds: Firmware: BCM4345/6 wl0: Mar  2 2020 23:30:41 version 7.45.202 (r724630 CY) FWID 01-72f6ece2

filename:       /lib/modules/5.4.0-1022-raspi/kernel/drivers/net/wireless/broadcom/brcm80211/brcmfmac/brcmfmac.ko
license:        Dual BSD/GPL
description:    Broadcom 802.11 wireless LAN fullmac driver.
author:         Broadcom Corporation
firmware:       brcm/brcmfmac43455-sdio.bin

$ sudo apt-get install -y rfkill wireless-tools

$ rfkill list
0: phy0: Wireless LAN
        Soft blocked: no
        Hard blocked: no

$ iw dev
phy#0
	Interface wlan0
		ifindex 3
		wdev 0x1
		addr b8:27:eb:33:46:6d
		type managed
		channel 36 (5180 MHz), width: 20 MHz, center1: 5180 MHz
		txpower 31.00 dBm

$ iw reg get
global
country US: DFS-FCC
	(2402 - 2472 @ 40), (N/A, 30), (N/A)
	(5170 - 5250 @ 80), (N/A, 23), (N/A), AUTO-BW
	(5250 - 5330 @ 80), (N/A, 23), (0 ms), DFS, AUTO-BW
	(5490 - 5730 @ 160), (N/A, 23), (0 ms), DFS
	(5735 - 5835 @ 80), (N/A, 30), (N/A)
	(57240 - 63720 @ 2160), (N/A, 40), (N/A)

$ sudo ip link set dev wlan0 up
$ sudo iwlist wlan0 scan
```

#### ethtool

```
$ sudo ethtool -i eth0
driver: lan78xx
version: 5.8.0-1008-raspi
firmware-version:
expansion-rom-version:
bus-info: usb-3f980000.usb-1.1.1
supports-statistics: yes
supports-test: no
supports-eeprom-access: yes
supports-register-dump: yes
supports-priv-flags: no

$ sudo ethtool -i eth1
driver: r8152
version: v1.10.11
firmware-version:
expansion-rom-version:
bus-info: usb-3f980000.usb-1.3.1
supports-statistics: yes
supports-test: no
supports-eeprom-access: no
supports-register-dump: no
supports-priv-flags: no

$ sudo ethtool -i wlan0
driver: brcmfmac
version: 7.45.202
firmware-version: 01-72f6ece2
expansion-rom-version:
bus-info: mmc1:0001:1
supports-statistics: no
supports-test: no
supports-eeprom-access: no
supports-register-dump: no
supports-priv-flags: no
```

#### wpa

```shell
# wpa_passphrase DONGSHENG-CMCC > /etc/wpa_supplicant/wpa_supplicant.conf

$ sudo /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant

$ cat /etc/wpa_supplicant/wpa_supplicant.conf
ctrl_interface=DIR=/run/wpa_supplicant GROUP=netdev
update_config=1
country=US

network={
	ssid="my-ssid"
	psk="my-psk"
   scan_ssid=1
   key_mgmt=WPA-PSK
}

$ sudo wpa_supplicant -B -D brcmfmac -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
$ sudo wpa_supplicant -d -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
```

#### netplan

```shell
$ sudo vi /etc/netplan/50-cloud-init.yaml
network:
   version: 2
   bonds: {}
   bridges: {}
   ovs_ports: {}
   vlans: {}
   ethernets:
      eth0:
         optional: true
         dhcp4: true
      eth1:
         optional: true
         dhcp4: true
   wifis:
      wlan0:
         optional: true
         dhcp4: true
         access-points:
            "my-ssid":
               password: "my-psk"

$ sudo netplan apply
$ sudo netplan --debug apply
```

### USB

#### lsusb

```shell
$ lsusb -v
$ lsusb
Bus 001 Device 006: ID 0bda:8152 Realtek Semiconductor Corp. RTL8152 Fast Ethernet Adapter
Bus 001 Device 005: ID 214b:7250
Bus 001 Device 004: ID 0424:7800 Microchip Technology, Inc. (formerly SMSC)
Bus 001 Device 003: ID 0424:2514 Microchip Technology, Inc. (formerly SMSC) USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Microchip Technology, Inc. (formerly SMSC) USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```

#### usb-devices

```shell
$ usb-devices

T:  Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev#=  1 Spd=480 MxCh= 1
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=01 MxPS=64 #Cfgs=  1
P:  Vendor=1d6b ProdID=0002 Rev=05.04
S:  Manufacturer=Linux 5.4.0-1022-raspi dwc_otg_hcd
S:  Product=DWC OTG Controller
S:  SerialNumber=3f980000.usb
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=0mA
I:  If#=0x0 Alt= 0 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=00 Driver=hub

T:  Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#=  2 Spd=480 MxCh= 4
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=02 MxPS=64 #Cfgs=  1
P:  Vendor=0424 ProdID=2514 Rev=0b.b3
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA
I:  If#=0x0 Alt= 1 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=02 Driver=hub

T:  Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#=  3 Spd=480 MxCh= 3
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=02 MxPS=64 #Cfgs=  1
P:  Vendor=0424 ProdID=2514 Rev=0b.b3
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA
I:  If#=0x0 Alt= 1 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=02 Driver=hub

T:  Bus=01 Lev=03 Prnt=03 Port=00 Cnt=01 Dev#=  4 Spd=480 MxCh= 0
D:  Ver= 2.10 Cls=ff(vend.) Sub=00 Prot=ff MxPS=64 #Cfgs=  1
P:  Vendor=0424 ProdID=7800 Rev=03.00
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA
I:  If#=0x0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=ff Driver=lan78xx

T:  Bus=01 Lev=02 Prnt=02 Port=02 Cnt=02 Dev#=  5 Spd=480 MxCh= 4
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=01 MxPS=64 #Cfgs=  1
P:  Vendor=214b ProdID=7250 Rev=01.00
S:  Product=USB2.0 HUB
C:  #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=100mA
I:  If#=0x0 Alt= 0 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=00 Driver=hub

T:  Bus=01 Lev=03 Prnt=05 Port=00 Cnt=01 Dev#=  6 Spd=480 MxCh= 0
D:  Ver= 2.10 Cls=00(>ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=  2
P:  Vendor=0bda ProdID=8152 Rev=20.00
S:  Manufacturer=Realtek
S:  Product=USB 10/100 LAN
S:  SerialNumber=00E04C3603B4
C:  #Ifs= 1 Cfg#= 1 Atr=a0 MxPwr=100mA
I:  If#=0x0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=ff Prot=00 Driver=r8152
```

### hwloc

```shell
$ /usr/bin/hwloc-info
depth 0:           1 Machine (type #0)
 depth 1:          1 Package (type #1)
  depth 2:         4 Die (type #19)
   depth 3:        4 Core (type #2)
    depth 4:       4 PU (type #3)
Special depth -3:  1 NUMANode (type #13)
Special depth -6:  2 OSDev (type #16)

$ /usr/bin/lstopo
Machine (908MB total)
  Package L#0
    NUMANode L#0 (P#0 908MB)
    Die L#0 + Core L#0 + PU L#0 (P#0)
    Die L#1 + Core L#1 + PU L#1 (P#1)
    Die L#2 + Core L#2 + PU L#2 (P#2)
    Die L#3 + Core L#3 + PU L#3 (P#3)
  Block "mmcblk0"
  Net "wlan0"
```

### hwinfo

```shell
$ sudo /usr/sbin/hwinfo --arch --bios --cpu --memory --disk --block --netcard --network
01: None 00.0: 10103 CPU
  [Created at cpu.343]
  Unique ID: rdCR.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: AArch64
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Features: fp,asimd,evtstrm,crc32,cpuid
  BogoMips: 38.40
  Config Status: cfg=new, avail=yes, need=no, active=unknown

02: None 00.0: 10103 CPU
  [Created at cpu.343]
  Unique ID: rdCR.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: AArch64
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Features: fp,asimd,evtstrm,crc32,cpuid
  BogoMips: 38.40
  Config Status: cfg=new, avail=yes, need=no, active=unknown

03: None 00.0: 10103 CPU
  [Created at cpu.343]
  Unique ID: rdCR.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: AArch64
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Features: fp,asimd,evtstrm,crc32,cpuid
  BogoMips: 38.40
  Config Status: cfg=new, avail=yes, need=no, active=unknown

04: None 00.0: 10103 CPU
  [Created at cpu.343]
  Unique ID: rdCR.j8NaKXDZtZ6
  Hardware Class: cpu
  Arch: AArch64
  Vendor: "ARM Limited"
  Model: 0.4.0 ""
  Platform: "BCM2835"
  Features: fp,asimd,evtstrm,crc32,cpuid
  BogoMips: 38.40
  Config Status: cfg=new, avail=yes, need=no, active=unknown

05: None 00.0: 10102 Main Memory
  [Created at memory.74]
  Unique ID: rdCR.CxwsZFjVASF
  Hardware Class: memory
  Model: "Main Memory"
  Memory Range: 0x00000000-0x38c30fff (rw)
  Memory Size: 896 MB
  Config Status: cfg=new, avail=yes, need=no, active=unknown

10: SDIO 00.0: 0282 WLAN controller
  [Created at pci.1939]
  Unique ID: 0DfK.f_UYNWgFjo0
  Parent ID: tTVG.VoJli79_k95
  SysFS ID: /devices/platform/soc/3f300000.mmcnr/mmc_host/mmc1/mmc1:0001/mmc1:0001:1
  SysFS BusID: mmc1:0001:1
  Hardware Class: network
  Model: "Broadcom BCM43430 WLAN card"
  Vendor: sdio 0x02d0 "Broadcom Corp."
  Device: sdio 0xa9a6 "BCM43430 WLAN card"
  Driver: "brcmfmac"
  Driver Modules: "brcmfmac", "brcmfmac", "brcmfmac"
  Device File: wlan0
  Features: WLAN
  HW Address: b8:27:eb:33:46:6d
  Permanent HW Address: b8:27:eb:33:46:6d
  Link detected: yes
  WLAN channels: 1 2 3 4 5 6 7 8 9 10 11 36 40 44 48 52 56 60 64 100 104 108 112 116 120 124 128 132 136 140 144 149
  WLAN frequencies: 2.412 2.417 2.422 2.427 2.432 2.437 2.442 2.447 2.452 2.457 2.462 5.18 5.2 5.22 5.24 5.26 5.28 5.3 5.32 5.5 5.52 5.54 5.56 5.58 5.6 5.62 5.64 5.66 5.68 5.7 5.72 5.745
  WLAN encryption modes: WEP40 WEP104 TKIP CCMP
  WLAN authentication modes: open sharedkey wpa-psk wpa-eap
  Module Alias: "sdio:c00v02D0dA9A6"
  Driver Info #0:
    Driver Status: brcmfmac is active
    Driver Activation Cmd: "modprobe brcmfmac"
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #8 (MMC Controller)

12: None 00.0: 10600 Disk
  [Created at block.245]
  Unique ID: HAKk.Fxp0d3BezAE
  Parent ID: 924w._NN+DZ1HDn4
  SysFS ID: /class/block/mmcblk0
  SysFS BusID: mmc0:5048
  SysFS Device Link: /devices/platform/soc/3f202000.mmc/mmc_host/mmc0/mmc0:5048
  Hardware Class: disk
  Model: "Disk"
  Driver: "sdhost-bcm2835", "mmcblk"
  Device File: /dev/mmcblk0
  Device Files: /dev/mmcblk0, /dev/disk/by-path/platform-3f202000.mmc, /dev/disk/by-id/mmc-SD64G_0xda7f8e63
  Device Number: block 179:0-179:31
  Drive status: no medium
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #7 (MMC Controller)

13: None 00.0: 11300 Partition
  [Created at block.434]
  Unique ID: l7UW.SE1wIdpsiiC
  Parent ID: HAKk.Fxp0d3BezAE
  SysFS ID: /class/block/mmcblk0/mmcblk0p1
  Hardware Class: partition
  Model: "Partition"
  Device File: /dev/mmcblk0p1
  Device Files: /dev/mmcblk0p1, /dev/disk/by-id/mmc-SD64G_0xda7f8e63-part1, /dev/disk/by-uuid/B726-57E2, /dev/disk/by-path/platform-3f202000.mmc-part1, /dev/disk/by-label/system-boot, /dev/disk/by-partuuid/ab86aefd-01
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #12 (Disk)

14: None 00.0: 11300 Partition
  [Created at block.434]
  Unique ID: CJka.SE1wIdpsiiC
  Parent ID: HAKk.Fxp0d3BezAE
  SysFS ID: /class/block/mmcblk0/mmcblk0p2
  Hardware Class: partition
  Model: "Partition"
  Device File: /dev/mmcblk0p2
  Device Files: /dev/mmcblk0p2, /dev/disk/by-uuid/483efb12-d682-4daf-9b34-6e2f774b56f7, /dev/disk/by-id/mmc-SD64G_0xda7f8e63-part2, /dev/disk/by-label/writable, /dev/disk/by-path/platform-3f202000.mmc-part2, /dev/disk/by-partuuid/ab86aefd-02
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #12 (Disk)

15: USB 00.0: 0200 Ethernet controller
  [Created at usb.122]
  Unique ID: Vl7j.8_I5RcIC_05
  Parent ID: lfzD.YCWTDwYJz_B
  SysFS ID: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.1/1-1.1.1/1-1.1.1:1.0
  SysFS BusID: 1-1.1.1:1.0
  Hardware Class: network
  Model: "Standard Microsystems Ethernet controller"
  Hotplug: USB
  Vendor: usb 0x0424 "Standard Microsystems Corp."
  Device: usb 0x7800
  Revision: "3.00"
  Driver: "lan78xx"
  Driver Modules: "lan78xx"
  Device File: eth0
  Speed: 480 Mbps
  HW Address: b8:27:eb:66:13:38
  Permanent HW Address: b8:27:eb:66:13:38
  Link detected: yes
  Module Alias: "usb:v0424p7800d0300dcFFdsc00dpFFicFFisc00ipFFin00"
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #16 (Hub)

17: USB 00.0: 0200 Ethernet controller
  [Created at usb.122]
  Unique ID: fzDf.UulhbgwZZxD
  Parent ID: dwDZ.V+vVO9032M2
  SysFS ID: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.3/1-1.3.1/1-1.3.1:1.0
  SysFS BusID: 1-1.3.1:1.0
  Hardware Class: network
  Model: "Realtek RTL8152 Fast Ethernet Adapter"
  Hotplug: USB
  Vendor: usb 0x0bda "Realtek Semiconductor Corp."
  Device: usb 0x8152 "RTL8152 Fast Ethernet Adapter"
  Revision: "20.00"
  Serial ID: "00E04C3603B4"
  Driver: "r8152"
  Driver Modules: "r8152"
  Device File: eth1
  Speed: 480 Mbps
  HW Address: 00:e0:4c:36:03:b4
  Permanent HW Address: 00:e0:4c:36:03:b4
  Link detected: no
  Module Alias: "usb:v0BDAp8152d2000dc00dsc00dp00icFFiscFFip00in00"
  Driver Info #0:
    Driver Status: r8152 is active
    Driver Activation Cmd: "modprobe r8152"
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #19 (Hub)

21: None 00.0: 10701 Ethernet
  [Created at net.126]
  Unique ID: usDW.ndpeucax6V1
  Parent ID: Vl7j.8_I5RcIC_05
  SysFS ID: /class/net/eth0
  SysFS Device Link: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.1/1-1.1.1/1-1.1.1:1.0
  Hardware Class: network interface
  Model: "Ethernet network interface"
  Driver: "lan78xx"
  Driver Modules: "lan78xx"
  Device File: eth0
  HW Address: b8:27:eb:66:13:38
  Permanent HW Address: b8:27:eb:66:13:38
  Link detected: yes
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #15 (Ethernet controller)

22: None 00.0: 1070a WLAN
  [Created at net.126]
  Unique ID: AYEt.QXn1l67RSa1
  Parent ID: 0DfK.f_UYNWgFjo0
  SysFS ID: /class/net/wlan0
  SysFS Device Link: /devices/platform/soc/3f300000.mmcnr/mmc_host/mmc1/mmc1:0001/mmc1:0001:1
  Hardware Class: network interface
  Model: "WLAN network interface"
  Driver: "brcmfmac"
  Driver Modules: "brcmfmac", "brcmfmac", "brcmfmac"
  Device File: wlan0
  HW Address: b8:27:eb:33:46:6d
  Permanent HW Address: b8:27:eb:33:46:6d
  Link detected: yes
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #10 (WLAN controller)

23: None 01.0: 10701 Ethernet
  [Created at net.126]
  Unique ID: L2Ua.ndpeucax6V1
  Parent ID: fzDf.UulhbgwZZxD
  SysFS ID: /class/net/eth1
  SysFS Device Link: /devices/platform/soc/3f980000.usb/usb1/1-1/1-1.3/1-1.3.1/1-1.3.1:1.0
  Hardware Class: network interface
  Model: "Ethernet network interface"
  Driver: "r8152"
  Driver Modules: "r8152"
  Device File: eth1
  HW Address: 00:e0:4c:36:03:b4
  Permanent HW Address: 00:e0:4c:36:03:b4
  Link detected: no
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #17 (Ethernet controller)

24: None 00.0: 10700 Loopback
  [Created at net.126]
  Unique ID: ZsBS.GQNx7L4uPNA
  SysFS ID: /class/net/lo
  Hardware Class: network interface
  Model: "Loopback network interface"
  Device File: lo
  Link detected: yes
  Config Status: cfg=new, avail=yes, need=no, active=unknown
```

### hciconfig

```shell
hciconfig -a
hciconfig hci0 version
hciconfig hci0 features
```

### bluetoothctl

```shell
bluetoothctl version
bluetoothctl list
bluetoothctl show
bluetoothctl devices
bluetoothctl info 9C:28:F7:97:DF:48
```

### sysctl

```shell
$ sudo sysctl -a | grep ^abi | sort
abi.cp15_barrier = 2
abi.setend = 2
abi.swp = 0
abi.tagged_addr_disabled = 0

$ sudo sysctl -a | grep ^fs | sort
fs.aio-max-nr = 65536
fs.aio-nr = 0
fs.binfmt_misc.status = enabled
fs.dir-notify-enable = 1
fs.epoll.max_user_watches = 183746
fs.inotify.max_queued_events = 16384
fs.inotify.max_user_instances = 128
fs.inotify.max_user_watches = 8192
fs.lease-break-time = 45
fs.leases-enable = 1
fs.pipe-max-size = 1048576
fs.pipe-user-pages-hard = 0
fs.pipe-user-pages-soft = 16384

$ sudo sysctl -a | grep ^kernel | sort
kernel.core_pattern = |/usr/share/apport/apport %p %s %c %d %P %E
kernel.core_pipe_limit = 0
kernel.core_uses_pid = 0
kernel.watchdog = 1
kernel.watchdog_cpumask = 0-3
kernel.watchdog_thresh = 10

$ sudo sysctl -a | grep ^net | sort
net.core.bpf_jit_enable = 1
net.core.bpf_jit_harden = 0
net.core.bpf_jit_kallsyms = 0
net.core.bpf_jit_limit = 33554432
net.core.busy_poll = 0
net.core.busy_read = 0
net.core.default_qdisc = fq_codel
net.core.dev_weight = 64
net.core.dev_weight_rx_bias = 1
net.core.dev_weight_tx_bias = 1
net.core.somaxconn = 4096

$ sudo sysctl -a | grep ^user | sort
user.max_cgroup_namespaces = 3248
user.max_inotify_instances = 128
user.max_inotify_watches = 8192
user.max_ipc_namespaces = 3248
user.max_mnt_namespaces = 3248
user.max_net_namespaces = 3248
user.max_pid_namespaces = 3248
user.max_user_namespaces = 3248
user.max_uts_namespaces = 3248

$ sudo sysctl -a | grep ^vm | sort
vm.admin_reserve_kbytes = 8192
vm.dirty_background_bytes = 0
vm.dirty_background_ratio = 10
vm.dirty_bytes = 0
vm.dirty_expire_centisecs = 3000
vm.dirty_ratio = 20
vm.dirty_writeback_centisecs = 500
vm.dirtytime_expire_seconds = 43200
vm.extfrag_threshold = 500
vm.lowmem_reserve_ratio = 256   256     32      0
vm.max_map_count = 65530
vm.min_free_kbytes = 3788
vm.mmap_min_addr = 32768
vm.mmap_rnd_bits = 18
vm.mmap_rnd_compat_bits = 11
```

## Basic configuration

### OS configuration

### Install packages

```shell
sudo apt-get update; sudo apt-get dist-upgrade -y
sudo apt-get install -y --no-install-recommends hwinfo hwloc ; \
sudo apt-get install -y --no-install-recommends rfkill wireless-tools bluez
```

## Conclusion

It looks Ubuntu can’t found WiFi Adapter in Raspberry Pi 3 Model B Plus Rev 1.3, it’s really disappointing.
