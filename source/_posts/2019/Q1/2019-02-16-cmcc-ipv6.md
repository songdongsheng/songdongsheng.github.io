---
title: CMCC IPv6
excerpt: CMCC IPv6
date: 2019-02-16 15:47:05
tags:
  - IP
  - IPv6
categories: [Programming, IP]
---

# CMCC IPv6

广州移动已经支持 IPv6，但是需要自己配置。此外，你使用的无线路由器也需要支持 IPv6 (广州移动光猫内置的 WiFi 虽然测速只有 30M，但是支持 IPv6)，或者退而求其次，支持路由模式。

现在无线路由器已经是阻断 IPv6 进入家庭的最后一个拦路虎。常见的家用路由器大多数不支持 IPv6，国内厂家只有华为和小米支持 IPv6，像腾达、TP-Link 和水星都不支持 IPv6。当然，等你看到本文时，情况可能有所改变，详见厂家的说明书。

现在有 2 种 IPv6 的配置方案：

1. PPP 模式，即路由模式。配置光猫的 INTERNET 连接模式为 PPP，协议为 IPv4/v6，再配置 LAN 侧地址，启用 DHCP 服务。外置路由器的 WAN 接到光猫的 LAN 侧，使用路由模式接入公网。
2. Bridge 模式，即桥接模式。配置光猫的 INTERNET 连接模式为 Bridge，协议为 IPv4/v6。外置路由器的 WAN 接到光猫的 LAN 侧，使用 PPPoE 拨号模式接入公网。

第一种方案简便易行，即使你的无线路由器不支持 IPv6，也可以同时接入 IPv4 和 IPv6 网络。但是你的无线路由器的访问控制等高级功能就基本废弃了。

第二种方案需要采购支持 IPv6 的中高端无线路由器，但是它的网络延迟小，是对网络延迟敏感的高端用户的必然选择，例如重度游戏玩家，高频交易用户等。

## 配置光猫

登录光猫管理界面，打开“网络->宽带配置”页面，在链接名称的下拉框中，选择类似“6_INTERNET_R_VIF_41”的项目，截图保存后删除。

然后在链接名称的下拉框中，选择“新建WAN连接”，IP协议版本选择“IPv4/v6”，根据你的实际情况选择“PPP”或者“Bridge”模式，VLAN 模式和 VLAN ID 根据截图保存的信息填写。在“PPP”模式中，MTU 填写 1492，用户名和密码根据安装的业务单填写，全局地址获取方式选择“AutoConfigured(SLAAC)”，网关获取方式选择“自适应”，DNS 获取方式和前缀获取方式填写“DHCPv6”。

![PPP 模式，即路由模式](settings-ppp.jpg)
![Bridge 模式，即桥接模式](settings-bridge.jpg)

## IPv6 状态

登录光猫管理界面，打开“状态->网络侧信息->IPv6连接信息”页面，可以看到当前的 IPv6 连接信息。一般光猫地址是 “/64”，前缀是 “/60”，与国外的 “/56”，乃至 “/48” 相比，可见我国 IPv6 地址的紧缺。

![IPv6 状态](status-ipv6.jpg)

## 配置路由器

1. 如果你的无线路由器支持 IPv6，那么根据配置向导的指示，填写用户名和密码，其它使用默认值即可。
2. 如果你的无线路由器不支持 IPv6，但是支持路由模式，就忍痛把它当普通路由器使用，忘记那些高级功能吧。
3. 如果你的无线路由器既不支持 IPv6 又不支持路由模式，那么就把它扔了吧:-)，或者启用光猫内置的无线路由器，体验一下最高 30M 网速的 IPv6 网络。

## 漫游 IPv6

广州移动的 IPv6 网络延迟还是比 IPv4 大得多，亟需改进。从路由跟踪结果来看，IPv6 比 IPv4 少了 4 跳，但是路由不同，延迟大了近 90 ms，还有很大的优化空间。

### RTT of IPv4

    C:\>ping -4 ipv6.com

    正在 Ping ipv6.com [192.185.167.252] 具有 32 字节的数据:
    来自 192.185.167.252 的回复: 字节=32 时间=248ms TTL=42
    来自 192.185.167.252 的回复: 字节=32 时间=294ms TTL=43
    来自 192.185.167.252 的回复: 字节=32 时间=245ms TTL=43
    来自 192.185.167.252 的回复: 字节=32 时间=246ms TTL=41

    192.185.167.252 的 Ping 统计信息:
        数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
    往返行程的估计时间(以毫秒为单位):
        最短 = 245ms，最长 = 294ms，平均 = 258ms

### RTT of IPv6

    C:\>ping -6 ipv6.com

    正在 Ping ipv6.com [2604:7c00:18:e::2] 具有 32 字节的数据:
    来自 2604:7c00:18:e::2 的回复: 时间=333ms
    来自 2604:7c00:18:e::2 的回复: 时间=329ms
    来自 2604:7c00:18:e::2 的回复: 时间=330ms
    来自 2604:7c00:18:e::2 的回复: 时间=330ms

    2604:7c00:18:e::2 的 Ping 统计信息:
        数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
    往返行程的估计时间(以毫秒为单位):
        最短 = 329ms，最长 = 333ms，平均 = 330ms
