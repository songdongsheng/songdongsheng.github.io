<!DOCTYPE html>
<html lang=zh>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="keywords" content="">
  
    <link rel="icon" href="">
  
    
  <title>OpenSSH Login with GnuPG (OpenPGP) Keys | 上下未形，何由考之？冥昭瞢暗，誰能極之？馮翼惟象，何以識之？</title>
  <meta name="description" content="">
  
<link rel="stylesheet" href="/style.css">

  
<link rel="stylesheet" href="/lib/jquery.fancybox.min.css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>上下未形，何由考之？冥昭瞢暗，誰能極之？馮翼惟象，何以識之？</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
      <section class="content markdown-body">
        <h1>
          OpenSSH Login with GnuPG (OpenPGP) Keys
        </h1>
        <div class='post-meta'>
          <i class="fa fa-calendar"
            aria-hidden="true"></i> <time>
            2024/07/14</time>
          
          | <i class="fa fa-folder-open-o"
            aria-hidden="true"></i>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/Utility/">Utility</a>/ <a class="article-category-link" href="/categories/Utility/Security/">Security</a>
  </div>



          
          
          |
          
          <i class="fa fa-tags"
            aria-hidden="true"></i>
          
          
  <a href="/tags/#Windows" class='tag'>Windows</a>

  <a href="/tags/#Security" class='tag'>Security</a>

  <a href="/tags/#Linux" class='tag'>Linux</a>


          
        </div>
        <h1 id="OpenSSH-Login-with-GnuPG-Keys"><a href="#OpenSSH-Login-with-GnuPG-Keys" class="headerlink" title="OpenSSH Login with GnuPG Keys"></a>OpenSSH Login with GnuPG Keys</h1><p>Many people don’t know that they can use <strong>OpenPGP</strong> (<strong>GnuPG</strong>) keys to log in to the <strong>OpenSSH</strong> server. Instead, they generate two sets of keys and use them independently. Using <strong>OpenPGP</strong> keys to log in to the <strong>OpenSSH</strong> server can make our lives more convenient and more secure. Let’s start our journey.</p>
<h2 id="What-You-Need"><a href="#What-You-Need" class="headerlink" title="What You Need"></a>What You Need</h2><ul>
<li><code>GnuPG 2.1.9</code> or later</li>
</ul>
<h2 id="Password-Generator"><a href="#Password-Generator" class="headerlink" title="Password Generator"></a>Password Generator</h2><p>Using secure passwords is one of the best security practices. It is recommended to use <code>apg</code> or <code>pwgen</code> as a password generator:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dpkg -l | grep -E <span class="string">&#x27;apg|pwgen&#x27;</span></span><br><span class="line">ii  apg                                        2.2.3.dfsg.1-5                        amd64        Automated Password Generator - Standalone version</span><br><span class="line">ii  pwgen                                      2.08-2                                amd64        Automatic Password generation</span><br></pre></td></tr></table></figure>

<p>Usage:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ apg -a 1 -M SNCL -m 8 -x 8 -n 8</span><br><span class="line">(8tY~&gt;Cp</span><br><span class="line">p4d<span class="variable">$MYNH</span></span><br><span class="line"><span class="string">&#x27;-xTtA5:</span></span><br><span class="line"><span class="string">X3hS6vH&amp;</span></span><br><span class="line"><span class="string">~0r5uXwJ</span></span><br><span class="line"><span class="string">v~r&quot;6oQG</span></span><br><span class="line"><span class="string">FF&amp;*0f8(</span></span><br><span class="line"><span class="string">;ykb0LZQ</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ pwgen -1 -s -B -y -n -c 8 8</span><br><span class="line">X3h^Y/ve</span><br><span class="line">e\E=w&lt;7v</span><br><span class="line">;b7AwVub</span><br><span class="line">@\mC!3q;</span><br><span class="line">4oA<span class="string">&#x27;`-Hv</span></span><br><span class="line"><span class="string">#=otwp9F</span></span><br><span class="line"><span class="string">N4:#P[=:</span></span><br><span class="line"><span class="string">@Ftm=~3`</span></span><br></pre></td></tr></table></figure>

<h2 id="Generate-Key"><a href="#Generate-Key" class="headerlink" title="Generate Key"></a>Generate Key</h2><p>Note that variable <code>PP</code> is the sample password, and <code>KF</code> is the generated master key fingerprint. Please replace them with your own corresponding password and master key fingerprint respectively.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PP=<span class="string">&#x27;Vx@e0l6y&#x27;</span></span><br><span class="line">gpg --quick-gen-key --batch --passphrase=<span class="string">&quot;<span class="variable">$&#123;PP&#125;</span>&quot;</span> <span class="string">&quot;X25519 User &lt;x25519@example.com&gt;&quot;</span> Ed25519 cert 1y</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">KF=<span class="string">&#x27;EE84D73B6CEC596BDEB56EEF2F9DE5D06993DEF0&#x27;</span></span><br><span class="line">gpg --quick-add-key --batch --passphrase=<span class="string">&quot;<span class="variable">$&#123;PP&#125;</span>&quot;</span> --pinentry-mode loopback <span class="variable">$&#123;KF&#125;</span> ed25519 sign 1y</span><br><span class="line">gpg --quick-add-key --batch --passphrase=<span class="string">&quot;<span class="variable">$&#123;PP&#125;</span>&quot;</span> --pinentry-mode loopback <span class="variable">$&#123;KF&#125;</span> cv25519 encrypt 1y</span><br><span class="line">gpg --quick-add-key --batch --passphrase=<span class="string">&quot;<span class="variable">$&#123;PP&#125;</span>&quot;</span> --pinentry-mode loopback <span class="variable">$&#123;KF&#125;</span> ed25519 auth 1y</span><br></pre></td></tr></table></figure>

<h2 id="List-Key"><a href="#List-Key" class="headerlink" title="List Key"></a>List Key</h2><p>Let’s view the OpenPGP Keys we just generated:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ gpg -K <span class="variable">$&#123;KF&#125;</span> --with-keygrip</span><br><span class="line">sec   ed25519/2F9DE5D06993DEF0 2024-07-13 [C] [expires: 2025-07-13]</span><br><span class="line">      Key fingerprint = EE84 D73B 6CEC 596B DEB5  6EEF 2F9D E5D0 6993 DEF0</span><br><span class="line">uid                 [ultimate] X25519 User &lt;x25519@example.com&gt;</span><br><span class="line">ssb   ed25519/A9E9E2021A84B4FB 2024-07-13 [S] [expires: 2025-07-13]</span><br><span class="line">ssb   cv25519/140347FF8E0A799F 2024-07-13 [E] [expires: 2025-07-13]</span><br><span class="line">ssb   ed25519/DCA34AA211A525C3 2024-07-13 [A] [expires: 2025-07-13]</span><br></pre></td></tr></table></figure>

<p>Note that the purpose of the subkey <code>DCA34AA211A525C3</code> contains the letter <code>A</code> (<code>auth</code>), indicating that it can be used for authentication, such as logging into an OpenSSH server.</p>
<h2 id="Export-SSH-Key"><a href="#Export-SSH-Key" class="headerlink" title="Export SSH Key"></a>Export SSH Key</h2><p>Let’s export the public key that the OpenSSH server needs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --export-ssh-key <span class="string">&quot;<span class="variable">$&#123;KF&#125;</span>&quot;</span></span><br><span class="line">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMpjycTr1bb3jNBU/AdtsKjDX1Kz79pZsvz4kHnGM5wg openpgp:0x11A525C3</span><br></pre></td></tr></table></figure>

<p>Note that the comment part <code>11A525C3</code> of this public key is the last 8 hexadecimal characters of the subkey <code>DCA34AA211A525C3</code>.</p>
<h2 id="Update-x2F-ssh-x2F-authorized-keys-in-OpenSSH-Server"><a href="#Update-x2F-ssh-x2F-authorized-keys-in-OpenSSH-Server" class="headerlink" title="Update ~&#x2F;.ssh&#x2F;authorized_keys in OpenSSH Server"></a>Update ~&#x2F;.ssh&#x2F;authorized_keys in OpenSSH Server</h2><p>The method of uploading the public key to the OpenSSH server depends on the configuration and deployment of the server. For common OpenSSH servers, it is usually directly added to the file <code>~/.ssh/authorized_keys</code> in the user directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMpjycTr1bb3jNBU/AdtsKjDX1Kz79pZsvz4kHnGM5wg openpgp:0x11A525C3&#x27;</span> &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<h2 id="Update-x2F-gnupg-x2F-sshcontrol"><a href="#Update-x2F-gnupg-x2F-sshcontrol" class="headerlink" title="Update ~&#x2F;.gnupg&#x2F;sshcontrol"></a>Update ~&#x2F;.gnupg&#x2F;sshcontrol</h2><p>In order to let the local <code>gpg-agent</code> know that this OpenPGP subkey can be used for OpenSSH authentication, we need to add its <code>keygrip</code> to the file <code>~/.gnupg/sshcontrol</code>.</p>
<p>Execute the following command to find the <code>keygrip</code> of this subkey:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gpg -K --with-keygrip <span class="variable">$&#123;KF&#125;</span></span><br><span class="line">sec   ed25519/2F9DE5D06993DEF0 2024-07-13 [C] [expires: 2025-07-13]</span><br><span class="line">      Key fingerprint = EE84 D73B 6CEC 596B DEB5  6EEF 2F9D E5D0 6993 DEF0</span><br><span class="line">      Keygrip = DFF57AE620812596C463FDC4110E15A56ED5ACE2</span><br><span class="line">uid                 [ultimate] X25519 User &lt;x25519@example.com&gt;</span><br><span class="line">ssb   ed25519/A9E9E2021A84B4FB 2024-07-13 [S] [expires: 2025-07-13]</span><br><span class="line">      Keygrip = 1682922D586DDDFC461E73A7E5C91E7EF0BBA748</span><br><span class="line">ssb   cv25519/140347FF8E0A799F 2024-07-13 [E] [expires: 2025-07-13]</span><br><span class="line">      Keygrip = 038AA856070E9097CACB1939427393D1E0125E40</span><br><span class="line">ssb   ed25519/DCA34AA211A525C3 2024-07-13 [A] [expires: 2025-07-13]</span><br><span class="line">      Keygrip = 8C1FC82074A83ED40D851259694BBFB92B94A344</span><br></pre></td></tr></table></figure>

<p>We can see that the <code>Keygrip</code> of subkey <code>DCA34AA211A525C3</code> is <code>8C1FC82074A83ED40D851259694BBFB92B94A344</code>, let’s add it to the file <code>~/.gnupg/sshcontrol</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;8C1FC82074A83ED40D851259694BBFB92B94A344&#x27;</span> &gt;&gt; ~/.gnupg/sshcontrol</span><br></pre></td></tr></table></figure>

<h2 id="Update-x2F-gnupg-x2F-gpg-agent-conf"><a href="#Update-x2F-gnupg-x2F-gpg-agent-conf" class="headerlink" title="Update ~&#x2F;.gnupg&#x2F;gpg-agent.conf"></a>Update ~&#x2F;.gnupg&#x2F;gpg-agent.conf</h2><p>This step is optional and updates the file <code>~/.gnupg/gpg-agent.conf</code> to change the <code>TTL</code> of the key and to display the fingerprint of the SSH key using <code>SHA256</code> instead of <code>MD5</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">default-cache-ttl 1800</span><br><span class="line">default-cache-ttl-ssh 1800</span><br><span class="line">disable-scdaemon</span><br><span class="line">enable-putty-support</span><br><span class="line">enable-ssh-support</span><br><span class="line">ssh-fingerprint-digest SHA256</span><br></pre></td></tr></table></figure>

<h2 id="Update-x2F-ssh-x2F-config"><a href="#Update-x2F-ssh-x2F-config" class="headerlink" title="Update ~&#x2F;.ssh&#x2F;config"></a>Update ~&#x2F;.ssh&#x2F;config</h2><p>This step is also optional, because when <code>gpg-agent</code> is not started, <strong>OpenSSH</strong> cannot use public key authentication, so we use a feature of the OpenSSH client configuration to automatically execute the command <code>gpg-connect-agent</code>, which in turn uses a feature that automatically starts <code>gpg-agent</code> when it finds that it is not started:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/.ssh/config</span><br><span class="line"><span class="comment"># Linux</span></span><br><span class="line">Match host * <span class="built_in">exec</span> <span class="string">&quot;gpg-connect-agent UPDATESTARTUPTTY /bye&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">Match host * <span class="built_in">exec</span> <span class="string">&quot;gpg-connect-agent UPDATESTARTUPTTY /bye &gt;NUL 2&gt;&amp;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>Note that although this step is optional, it executes <code>UPDATESTARTUPTTY</code>, which ensures that <code>gpg-agent</code> pops up the <strong>password input box</strong> in the current window and does not find the wrong window. This is particularly useful on <strong>Linux</strong> systems, especially when using terminal multiplexers such as <strong>tmux</strong>.</p>
<h2 id="Update-x2F-bashrc"><a href="#Update-x2F-bashrc" class="headerlink" title="Update ~&#x2F;.bashrc"></a>Update ~&#x2F;.bashrc</h2><p>For example, in the file <code>~/.bashrc</code>, <code>~/.bash_profile</code> or <code>~/.profile</code>, in the interactive login section, configure the environment variable <code>GPG_TTY</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GPG_TTY=`<span class="built_in">tty</span>`</span><br><span class="line"><span class="comment"># gpg-connect-agent UPDATESTARTUPTTY /bye</span></span><br><span class="line"><span class="comment"># ssh-add -l</span></span><br></pre></td></tr></table></figure>

<p>If you do not want to log in again, you can execute the following command to make it take effect:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>or:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> GPG_TTY=`<span class="built_in">tty</span>`</span><br></pre></td></tr></table></figure>

<h2 id="Try-OpenSSH-Login"><a href="#Try-OpenSSH-Login" class="headerlink" title="Try OpenSSH Login"></a>Try OpenSSH Login</h2><p>Now that everything is done, let’s try logging into OpenSSH using our GnuPG key:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ssh &lt;user&gt;@example.com</span><br><span class="line"></span><br><span class="line">┌──────────────────────────────────────────────────────┐</span><br><span class="line">│ Please enter the passphrase <span class="keyword">for</span> the ssh key          │</span><br><span class="line">│ SHA256:ZbVC8wNc1vdBSNDh7+xfupzc0bDUEElJZ3EyGxuzUVU   │</span><br><span class="line">│                                                      │</span><br><span class="line">│                                                      │</span><br><span class="line">│ Passphrase: ________________________________________ │</span><br><span class="line">│                                                      │</span><br><span class="line">│       &lt;OK&gt;                              &lt;Cancel&gt;     │</span><br><span class="line">└──────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>Enter the password we provided when generating the <strong>OpenPGP</strong> key, and we are logged in to the remote <strong>OpenSSH</strong> server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Using username <span class="string">&quot;root&quot;</span>.</span><br><span class="line">Authenticating with public key <span class="string">&quot;(none)&quot;</span> from agent</span><br></pre></td></tr></table></figure>

<p>Careful people will notice that the successful login message contains a strange public key identifier <strong>“(none)”</strong>. This is because gpg does not generate a comment for the public key. For more information, see <a target="_blank" rel="noopener" href="https://dev.gnupg.org/T2760">T2760 - Populate comment field when exporting authentication key for SSH</a>.</p>
<h2 id="Mapping-of-OpenPGP-Keys-and-SSH-Fingerprints"><a href="#Mapping-of-OpenPGP-Keys-and-SSH-Fingerprints" class="headerlink" title="Mapping of OpenPGP Keys and SSH Fingerprints"></a>Mapping of OpenPGP Keys and SSH Fingerprints</h2><p>Sometimes we have many keys available for SSH login, and we may not be able to find the <strong>OpenPGP key</strong> corresponding to the <strong>SSH fingerprint</strong>. In this case, the following script is very useful:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">gpg_keys=$(gpg -K --list-options show-usage | grep -E <span class="string">&#x27;(^sec|^ssb)&#x27;</span> | awk <span class="string">&#x27;$4 ~ /A/ &#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$gpg_keys</span>; <span class="keyword">do</span></span><br><span class="line">    fingerprint=$(<span class="built_in">echo</span> <span class="variable">$key</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;/&#x27;</span> -f2)</span><br><span class="line"></span><br><span class="line">    gpg_ssh_fingerprint=$(gpg --export-ssh-key <span class="variable">$fingerprint</span>! | ssh-keygen -lf - | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">    ssh_keys=$(ssh-add -l | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ssh_key <span class="keyword">in</span> <span class="variable">$ssh_keys</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$gpg_ssh_fingerprint</span>&quot;</span> == <span class="string">&quot;<span class="variable">$ssh_key</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;OpenPGP <span class="variable">$key</span> -&gt; SSH <span class="variable">$ssh_key</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OpenPGP rsa2048/0401AA2046D397FF -&gt; SSH SHA256:Oa8egR/Az0cyo44IjvkrzHKownGgo59LctsMmEBNXyo</span><br><span class="line">OpenPGP ed25519/CB7D373D4F999240 -&gt; SSH SHA256:ZbVC8wNc1vdBSNDh7+xfupzc0bDUEElJZ3EyGxuzUVU</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Delete-Key"><a href="#Delete-Key" class="headerlink" title="Delete Key"></a>Delete Key</h2><p>Now that the test is complete, let’s delete the OpenPGP test key we just generated:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --delete-key --batch --<span class="built_in">yes</span> <span class="variable">$&#123;KF&#125;</span></span><br></pre></td></tr></table></figure>

<p>In addition, don’t forget to delete the records we added in the file <code>~/.gnupg/sshcontrol</code> and the file <code>~/.ssh/authorized_keys</code>. The changes to other files can be retained. Of course, if you want to delete <strong>GnuPG</strong> as well, you also need to delete the records we added in the file <code>~/.ssh/config</code>.</p>
<h2 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h2><p>The pursuit of <strong>security</strong>, <strong>reliability</strong> and <strong>simplicity</strong> has always been one of our goals. Let’s start by using <strong>OpenPGP</strong> keys and <strong>GnuPG</strong> to log in to the <strong>OpenSSH</strong> server!</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.gnupg.org/download/">https://www.gnupg.org/download/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnupg.org/documentation/manuals/gnupg/">https://www.gnupg.org/documentation/manuals/gnupg/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnupg.org/documentation/manuals/gnupg/OpenPGP-Key-Management.html">https://www.gnupg.org/documentation/manuals/gnupg/OpenPGP-Key-Management.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnupg.org/documentation/manuals/gnupg/Operational-GPG-Commands.html">https://www.gnupg.org/documentation/manuals/gnupg/Operational-GPG-Commands.html</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.gnupg.org/T2859">TOFU not affected by Key deletion - https://dev.gnupg.org/T2859</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/PowerShell/Win32-OpenSSH/releases/">https://github.com/PowerShell/Win32-OpenSSH/releases/</a></li>
<li><a target="_blank" rel="noopener" href="https://cheatsheets.chaospixel.com/gnupg/">https://cheatsheets.chaospixel.com/gnupg/</a></li>
</ul>

      </section>
    </article>
    
    
  </div>
  <aside>
    
    <div class="toc-container">
      <h1>
        catalog
      </h1>
      <div class="content">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenSSH-Login-with-GnuPG-Keys"><span class="toc-number">1.</span> <span class="toc-text">OpenSSH Login with GnuPG Keys</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-You-Need"><span class="toc-number">1.1.</span> <span class="toc-text">What You Need</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Password-Generator"><span class="toc-number">1.2.</span> <span class="toc-text">Password Generator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generate-Key"><span class="toc-number">1.3.</span> <span class="toc-text">Generate Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#List-Key"><span class="toc-number">1.4.</span> <span class="toc-text">List Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Export-SSH-Key"><span class="toc-number">1.5.</span> <span class="toc-text">Export SSH Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-x2F-ssh-x2F-authorized-keys-in-OpenSSH-Server"><span class="toc-number">1.6.</span> <span class="toc-text">Update ~&#x2F;.ssh&#x2F;authorized_keys in OpenSSH Server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-x2F-gnupg-x2F-sshcontrol"><span class="toc-number">1.7.</span> <span class="toc-text">Update ~&#x2F;.gnupg&#x2F;sshcontrol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-x2F-gnupg-x2F-gpg-agent-conf"><span class="toc-number">1.8.</span> <span class="toc-text">Update ~&#x2F;.gnupg&#x2F;gpg-agent.conf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-x2F-ssh-x2F-config"><span class="toc-number">1.9.</span> <span class="toc-text">Update ~&#x2F;.ssh&#x2F;config</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-x2F-bashrc"><span class="toc-number">1.10.</span> <span class="toc-text">Update ~&#x2F;.bashrc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Try-OpenSSH-Login"><span class="toc-number">1.11.</span> <span class="toc-text">Try OpenSSH Login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping-of-OpenPGP-Keys-and-SSH-Fingerprints"><span class="toc-number">1.12.</span> <span class="toc-text">Mapping of OpenPGP Keys and SSH Fingerprints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Delete-Key"><span class="toc-number">1.13.</span> <span class="toc-text">Delete Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wrapping-Up"><span class="toc-number">1.14.</span> <span class="toc-text">Wrapping Up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.15.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
      </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy;
      2024 | Powered by <a href="https://hexo.io"
        target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath"
        target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

<script src="/lib/ScrollMagic.min.js"></script>


<script src="/lib/lodash.min.js"></script>

<script>
  document.body.addEventListener('touchstart', function () { });

  // 文章图片预览
  $("article img").each(function () {
    var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
    $(this).wrapAll(strA);
  });

  // 目录联动
  let tocLinkList = $('.toc-link')

  let controller = new ScrollMagic.Controller({
    globalSceneOptions: {
      triggerHook: 0.01
    }
  })

  tocLinkList.each(function (index, elem) {
    let href = $(this).attr("href");
    let nextHref = tocLinkList.eq(index + 1).attr("href");
    let height = href && nextHref ? $(nextHref).offset().top - $(href).offset().top : 0

    new ScrollMagic.Scene({ triggerElement: href })
      .duration(height)
      .setClassToggle(".toc [href='" + href + "']", 'active')
      .addTo(controller)
  })

  window.addEventListener('load', function () {
    // 目录联动 图片加载完成后从新计算
    tocLinkList.each(function (index, elem) {
      let href = $(this).attr("href");
      let nextHref = tocLinkList.eq(index + 1).attr("href");
      let height = href && nextHref ? $(nextHref).offset().top - $(href).offset().top : 0

      new ScrollMagic.Scene({ triggerElement: href })
        .duration(height)
        .setClassToggle(".toc [href='" + href + "']", 'active')
        .addTo(controller)
    })
  })
</script>

<script src="/lib/jquery.fancybox.min.js"></script>



</body>
</html>
